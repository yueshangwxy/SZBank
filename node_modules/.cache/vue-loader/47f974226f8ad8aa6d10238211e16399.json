{"remainingRequest":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\eladmin-system\\src\\views\\system\\auth\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\eladmin-system\\src\\views\\system\\auth\\index.vue","mtime":1650418877001},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport request from '@/utils/request'\r\nimport qs from 'qs'\r\n\r\nexport default {\r\n  name: 'Auth',\r\n  dicts: ['DATA_AUTH_TYPE'],\r\n  data() {\r\n    return {\r\n      authActiveName: 'role',\r\n      menuActiveName: 'admin',\r\n\r\n      currentType: 'role',\r\n      currentId: '',\r\n      currentRoleLevel: null,\r\n      menuTreeDefaultProps: {\r\n        children: 'children',\r\n        label: 'name'\r\n      },\r\n      deptTab: {\r\n        query: {\r\n          name: '',\r\n          id: ''\r\n        },\r\n        data: [],\r\n        loading: false\r\n      },\r\n      roleTab: {\r\n        query: {\r\n          blurry: ''\r\n        },\r\n        data: [],\r\n        loading: true,\r\n        total: 0, page: 0, size: 10\r\n      },\r\n      userTab: {\r\n        query: {\r\n          blurry: ''\r\n        },\r\n        data: [],\r\n        loading: true,\r\n        total: 0, page: 0, size: 10\r\n      },\r\n\r\n      adminTab: {\r\n        menuLoading: false,\r\n        data: [],\r\n        loading: false,\r\n        operators: [],\r\n        strictly: true\r\n      },\r\n      menuIds: [],\r\n      strictly: true\r\n    }\r\n  }\r\n  ,\r\n  mounted() {\r\n    this.toQueryRole()\r\n    // this.getAdminmenus()\r\n  },\r\n  methods: {\r\n    authHandleClick(tab, event) {\r\n      if (tab.name === 'dept') {\r\n        this.currentType = 'dept'\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        this.toQueryDept()\r\n      } else if (tab.name === 'role') {\r\n        this.currentType = 'role'\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        this.toQueryRole()\r\n      } else if (tab.name === 'user') {\r\n        this.currentType = 'user'\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        this.toQueryUser()\r\n      }\r\n    },\r\n\r\n    menuHandleClick(tab, event) {\r\n      // this.getAdminmenus()\r\n    },\r\n\r\n    // 机构权限配置\r\n    toQueryDept() {\r\n      var _this = this\r\n      _this.deptTab.loading = true\r\n      // _this.deptTab.data = [];\r\n      request({\r\n        url: '/api/dept' + '?' + qs.stringify(_this.deptTab.query, {indices: false}),\r\n        method: 'get'\r\n      }).then(res => {\r\n        _this.deptTab.data = res.content\r\n        _this.deptTab.loading = false\r\n        //  console.log(_this.deptTab.data)\r\n      })\r\n    },\r\n    onSelectDept(currentRow, oldCurrentRow) {\r\n      // console.log(currentRow,oldCurrentRow)\r\n      if (currentRow) {\r\n        this.adminTab.strictly = true\r\n        this.currentId = currentRow.id\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        request({\r\n          url: '/auths/menus' + '?' + qs.stringify({type: 'dept', id: currentRow.id}, {indices: false}),\r\n          method: 'get'\r\n        }).then(res => {\r\n          this.adminTab.data = res\r\n          this.adminTab.loading = false\r\n          this.adminTab.strictly = false\r\n        })\r\n      }\r\n    },\r\n\r\n    // 角色权限配置\r\n    toQueryRole() {\r\n      var _this = this\r\n      _this.roleTab.loading = true\r\n      const sort = 'level,asc'\r\n      this.params = {page: this.roleTab.page, size: this.roleTab.size, sort: sort}\r\n      this.params['blurry'] = _this.roleTab.query.blurry\r\n      request({\r\n        url: '/api/roles' + '?' + qs.stringify(_this.params, {indices: false}),\r\n        method: 'get'\r\n      }).then(res => {\r\n        // console.log(res.content)\r\n        _this.roleTab.data = res.content\r\n        _this.roleTab.total = res.totalElements\r\n        _this.roleTab.loading = false\r\n      })\r\n    },\r\n    onSelectRole(currentRow, oldCurrentRow) {\r\n      if (currentRow) {\r\n        this.currentId = currentRow.id\r\n        this.adminTab.strictly = true\r\n        // this.adminTab.loading = true\r\n        this.currentRoleLevel = currentRow.level\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        request({\r\n          url: '/auths/menus/role/' + currentRow.id,\r\n          method: 'get'\r\n        }).then(res => {\r\n          console.log('======get role auths::', res)\r\n          this.adminTab.data = res.auths\r\n          this.adminTab.operators = res.operators\r\n          this.adminTab.strictly = false\r\n        })\r\n      }\r\n    },\r\n    rolePageChange(e) {\r\n      this.roleTab.page = e - 1\r\n      this.toQueryRole()\r\n    },\r\n    roleSizeChange(e) {\r\n      this.roleTab.page = 0\r\n      this.roleTab.size = e\r\n      this.toQueryRole()\r\n    }\r\n    ,\r\n\r\n    // 用户权限配置\r\n    toQueryUser() {\r\n      var _this = this\r\n      _this.userTab.loading = true\r\n      const sort = 'id,desc'\r\n      this.params = {page: this.userTab.page, size: this.userTab.size, sort: sort}\r\n      this.params['blurry'] = _this.userTab.query.blurry\r\n      request({\r\n        url: '/api/users' + '?' + qs.stringify(_this.params, {indices: false}),\r\n        method: 'get'\r\n      }).then(res => {\r\n        // console.log(res.content)\r\n        _this.userTab.data = res.content\r\n        _this.userTab.total = res.totalElements\r\n        _this.userTab.loading = false\r\n      })\r\n    },\r\n    onSelectUser(currentRow, oldCurrentRow) {\r\n      // console.log(currentRow,oldCurrentRow)\r\n      if (currentRow) {\r\n        this.adminTab.strictly = true\r\n        this.currentId = currentRow.id\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        request({\r\n          url: '/auth/menus' + '?' + qs.stringify({type: 'user', id: currentRow.id}, {indices: false}),\r\n          method: 'get'\r\n        }).then(res => {\r\n          this.adminTab.data = res.auths\r\n          this.adminTab.this.adminTab.strictly = false\r\n        })\r\n      }\r\n    }\r\n    ,\r\n    userPageChange(e) {\r\n      this.userTab.page = e - 1\r\n      this.toQueryUser()\r\n    },\r\n    userSizeChange(e) {\r\n      this.userTab.page = 0\r\n      this.userTab.size = e\r\n      this.toQueryUser()\r\n    },\r\n\r\n    // 加载admin菜单\r\n    /* getAdminmenus() {\r\n      var _this = this\r\n      request({\r\n        url: '/api/menus/tree',\r\n        method: 'get'\r\n      }).then(res => {\r\n        _this.adminTab.data = res\r\n        _this.adminTab.loading = false\r\n      })\r\n    },*/\r\n    doSaveAdminMenus() {\r\n      this.adminTab.menuLoading = true\r\n      // var _this = this\r\n      const menus = []\r\n      /* this.$refs.adminMenuTree.getHalfCheckedNodes().forEach(function(data, index) {\r\n        menus.push({id:data.id,auth:data.dataAuthType})\r\n      })*/\r\n      // 得到已选中的 key 值\r\n      console.log('=====getCheckedKeys========', menus, this.$refs.adminMenuTree.getCheckedNodes(false, true))\r\n      this.$refs.adminMenuTree.getCheckedNodes(false, true).forEach(function (data, index) {\r\n        menus.push({resourceId: data.id, authorizeType: '03', dataAuthType: data.dataAuthType})\r\n      })\r\n      request({\r\n        url: '/auths/menus/' + this.currentType + '/' + this.currentId,\r\n        method: 'post',\r\n        data: menus\r\n      }).then(res => {\r\n        this.adminTab.menuLoading = false\r\n        this.$notify({\r\n          title: '保存成功',\r\n          type: 'success',\r\n          duration: 2500\r\n        })\r\n      })\r\n    }\r\n  }\r\n}\r\n",null]}