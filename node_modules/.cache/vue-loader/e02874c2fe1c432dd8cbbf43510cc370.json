{"remainingRequest":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\category\\categoryNew.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\category\\categoryNew.vue","mtime":1646296195727},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport crudIndCategory from '@/api/indicators/indCategory'\r\nimport CRUD, {crud, form, header, presenter} from \"@crud/crud\";\r\nimport {isSuperAdmin, getTenants} from '@/api/indUserApply/indTenant'\r\n\r\nconst defaultCrud = CRUD({\r\n  title: '指标信息',\r\n  url: crudIndCategory.url,\r\n  sort: 'id,desc',\r\n  crudMethod: {...crudIndCategory.crud}\r\n})\r\nconst defaultForm = {\r\n  parentName: null,\r\n  categoryName: null,\r\n  categoryType: null,\r\n  id: null,\r\n  parentId: null,\r\n  prefix: null,\r\n  operType: null,\r\n  level: 1\r\n}\r\nexport default {\r\n  name: 'IndCategory',\r\n  // components: { pagination, crudOperation, rrOperation, udOperation },\r\n  mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\r\n  data() {\r\n    return {\r\n      type: '0',\r\n      parentId: '0',\r\n      isTop: false,\r\n      dialogVisible: false,\r\n      dialogTitle: '',\r\n      filterText: '',\r\n      activeName: 'defaultCategory',\r\n      defaultProps: {children: 'children', label: 'name'},\r\n      //treeData: [{id: '0',categoryType: this.type, categoryName: '全部类别',children: [],parentName: null,parentId: null, prefix: null, level: 0}],\r\n      treeData: [],\r\n      permission: {\r\n        add: ['admin', 'indCategory:add'],\r\n        edit: ['admin', 'indCategory:edit'],\r\n        del: ['admin', 'indCategory:del'],\r\n        selfAdd: ['admin', 'indCategory:selfAdd'],\r\n        selfEdit: ['admin', 'indCategory:selfEdit'],\r\n        selfDel: ['admin', 'indCategory:selfDel']\r\n      },\r\n      rules: {\r\n        id: [\r\n          {required: true, message: '分类ID不能为空', trigger: 'blur'}\r\n        ],\r\n        categoryName: [\r\n          {required: true, message: '分类名称不能为空', trigger: 'blur'}\r\n        ]\r\n      },\r\n      tenantArr: [],\r\n      superAdminFlag: false,\r\n    }\r\n  },\r\n  props: {\r\n    canOpr: true,\r\n    height: {\r\n      type: String,\r\n      default: '489'\r\n    }\r\n  },\r\n  watch: {\r\n    filterText(val) {\r\n      this.$refs.tree.filter(val)\r\n    }\r\n  },\r\n  mounted() {\r\n    // console.log('=====category---mounted....')\r\n    this.superAdminFlag = isSuperAdmin();\r\n    this.init()\r\n    this.getTenants()\r\n  },\r\n  methods: {\r\n    // 获取数据前设置好接口地址\r\n    /*  [CRUD.HOOK.beforeRefresh]() {\r\n        return true\r\n    },*/\r\n    filterNode(value, treeData) {\r\n      if (!value) return true\r\n      return treeData.categoryName.indexOf(value) !== -1\r\n    },\r\n    handleTabClick(tab, event) {\r\n      console.log(\"tab===>, \" + tab)\r\n      this.type = tab.index;\r\n      //this.treeData[0].categoryType = tab.index;\r\n      //this.treeData[0].children = []\r\n      this.init();\r\n      //this.handleNodeClick(this.treeData[0]);\r\n    },\r\n    // 点击事件\r\n    handleNodeClick(data) {\r\n      this.$emit('node-click', data)\r\n    },\r\n    handleAdd(data) {\r\n      this.form.level = parseInt(data.level) + 1\r\n      this.dialogVisible = true\r\n      this.dialogTitle = \"新增指标分类\"\r\n      this.form.categoryType = this.type\r\n      //this.form.categoryName = data.categoryName\r\n      this.form.categoryName = null\r\n      this.form.tenant = data.tenant\r\n      this.form.operType = \"add\"\r\n      if (data.id > 0) {\r\n        this.form.prefix = data.prefix\r\n      }\r\n      if (data.level == '0') {\r\n        this.form.parentName = null\r\n        this.form.parentId = '0'\r\n        this.isTop = true;\r\n      } else {\r\n        this.form.parentName = data.categoryName\r\n        this.form.parentId = data.id\r\n        this.isTop = false;\r\n      }\r\n    },\r\n    handleEdit(data) {\r\n      this.dialogVisible = true\r\n      this.dialogTitle = \"修改指标分类\"\r\n      this.form.categoryType = data.categoryType\r\n      this.form.categoryName = data.categoryName\r\n\r\n      this.form.id = data.id\r\n\r\n      this.form.operType = \"edit\"\r\n      this.form.prefix = data.prefix\r\n      this.form.tenant = data.tenant\r\n      this.form.level = data.level\r\n      if (data.parentId == '0') {\r\n        this.form.parentId = '0'\r\n        this.form.parentName = null\r\n        this.isTop = true;\r\n      } else {\r\n        this.form.parentId = data.parentId\r\n        this.form.parentName = data.parentName\r\n        this.isTop = false;\r\n      }\r\n    },\r\n    handleRemove(node, data) {\r\n      const $this = this\r\n      this.$confirm('确定要删除该节点及其所有子节点吗?', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        crudIndCategory.crud.del([data.id]).then(res => {\r\n          if (res.code !== 0) {\r\n            $this.$message({\r\n              type: 'error',\r\n              message: '删除失败,' + res.msg\r\n            })\r\n          } else {\r\n            $this.$message({\r\n              type: 'success',\r\n              message: '删除成功 '\r\n            })\r\n          }\r\n          $this.init()\r\n\r\n          // this.crud.notify(this.dict.label.user_status[val] + '成功', CRUD.NOTIFICATION_TYPE.SUCCESS)\r\n        }).catch(() => {\r\n          console.log('删除异常')\r\n          $this.$message({\r\n            type: 'error',\r\n            message: '删除失败 '\r\n          })\r\n        })\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    init() {\r\n      let _self = this;\r\n      crudIndCategory.tree(this.type, this.parentId).then(res => {\r\n        console.log('======crudIndCategory.init======', res.toString())\r\n        //this.treeData[0].categoryType = this.type;\r\n        //this.treeData[0].children = res.data\r\n        this.treeData = res.data\r\n        // this.crud.notify(this.dict.label.user_status[val] + '成功', CRUD.NOTIFICATION_TYPE.SUCCESS)\r\n        //刷新上层页面\r\n        this.$emit('reloadIndFirstType');\r\n      }).catch(() => {\r\n        console.log('')\r\n        // data.enabled = !data.enabled\r\n      })\r\n    },\r\n    cancel() {\r\n      this.dialogVisible = false\r\n    },\r\n    submit() {\r\n      if (this.form.operType === \"add\") {\r\n        this.addCategory();\r\n      } else {\r\n        this.editCategory();\r\n      }\r\n    },\r\n    addCategory() {\r\n      const $this = this;\r\n      if (this.superAdminFlag && this.superAdminFlag && this.isTop && this.form.tenant == null) {\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '请选择所属租户'\r\n        })\r\n        return\r\n      }\r\n      if (this.form.categoryName == null) {\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '分类名称不能为空'\r\n        })\r\n        return\r\n      }\r\n      if (this.form.categoryType == 0 && this.form.prefix == null) {\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '前缀不能为空'\r\n        })\r\n        return\r\n      }\r\n      crudIndCategory.crud.add({\r\n        categoryName: this.form.categoryName,\r\n        categoryType: this.form.categoryType,\r\n        prefix: this.form.prefix != null ? this.form.prefix.toUpperCase() : null,\r\n        parentId: this.form.parentId,\r\n        tenant: this.form.tenant,\r\n        level: this.form.level\r\n      }).then(res => {\r\n        if (res.code === 0) {\r\n          $this.$message({\r\n            type: 'success',\r\n            message: '添加成功 '\r\n          })\r\n          $this.init()\r\n          this.form.categoryName = null\r\n          this.form.categoryType = null\r\n          this.form.prefix = null\r\n          this.form.parentId = null\r\n          this.dialogVisible = false\r\n        } else {\r\n          $this.$message({\r\n            type: 'error',\r\n            message: res.msg\r\n          })\r\n        }\r\n\r\n      }).catch(() => {\r\n        console.log('新增异常')\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '添加失败 '\r\n        })\r\n      })\r\n    },\r\n    editCategory() {\r\n      const $this = this\r\n      if (this.superAdminFlag && this.superAdminFlag && this.isTop && this.form.tenant == null) {\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '请选择所属租户'\r\n        })\r\n        return\r\n      }\r\n      if (this.form.categoryName == null) {\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '分类名称不能为空'\r\n        })\r\n        return\r\n      }\r\n      if (this.form.categoryType == 0 && this.form.prefix == null) {\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '前缀不能为空'\r\n        })\r\n        return\r\n      }\r\n      crudIndCategory.crud.edit({\r\n        categoryName: this.form.categoryName,\r\n        categoryType: this.form.categoryType,\r\n        prefix: this.form.prefix != null ? this.form.prefix.toUpperCase() : null,\r\n        id: this.form.id,\r\n        parentId: this.form.parentId,\r\n        tenant: this.form.tenant,\r\n        level: this.form.level\r\n      }).then(res => {\r\n        if (res.code === 0) {\r\n          $this.$message({\r\n            type: 'success',\r\n            message: '修改成功 '\r\n          })\r\n          $this.init()\r\n          this.form.categoryName = null\r\n          this.form.categoryType = null\r\n          this.form.prefix = null\r\n          this.form.parentId = null\r\n          this.dialogVisible = false\r\n        } else {\r\n          $this.$message({\r\n            type: 'error',\r\n            message: res.msg\r\n          })\r\n        }\r\n      }).catch(() => {\r\n        $this.$message({\r\n          type: 'error',\r\n          message: '修改失败 '\r\n        })\r\n      })\r\n      /*this.$prompt('输入节点名称', '提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        inputValue: data.categoryName\r\n        // inputPattern: /[\\w!#$%&'*+/=?^_`{|}~-]+(?:\\.[\\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\\w](?:[\\w-]*[\\w])?\\.)+[\\w](?:[\\w-]*[\\w])?/,\r\n        // inputErrorMessage: '邮箱格式不正确'\r\n      }).then(() => {\r\n\r\n      }).catch(() => {\r\n        this.$message({\r\n          type: 'info',\r\n          message: '修改失败'\r\n        })\r\n      })*/\r\n    },\r\n    getTenants() {\r\n      getTenants().then(data => {\r\n        if (data != null && data.code == '0000') {\r\n          this.tenantArr = data.data\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n",null]}