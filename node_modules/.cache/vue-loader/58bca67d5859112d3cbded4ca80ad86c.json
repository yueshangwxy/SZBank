{"remainingRequest":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\resultCheck.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\resultCheck.vue","mtime":1644369310617},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {getCheckList, saveCheckData, deleteCheckData, getResultDepts} from '@/api/indicators/indResultSubscribe'\nimport qs from 'qs'\nimport CRUD, {presenter, header, form, crud} from '@crud/crud'\nimport rrOperation from '@crud/RR.operation'\nimport crudOperation from '@crud/CRUD.operation'\nimport pagination from '@crud/Pagination'\nimport crudIndAtomInfo, {\n    getColumnByTabel,\n    getDimensions,\n    getGenAndDerivedInd,\n    getAllInds,\n    getGenInd,\n    getTablesById, bizNameIsContract, approveDetailByBusinessKey, abolish,startProcess,delAtom,getHisList\n} from '@/api/indicators/indAtomInfo'\nimport Treeselect from '@riophae/vue-treeselect'\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\n\nString.prototype.replaceAll = function(s1,s2){\n  return this.replace(new RegExp(s1,\"gm\"),s2);\n}\nconst defaultCrud = CRUD({\n    title: '指标加工结果校验',\n    url:  'v1/indicators/result/atom/getCheckList',\n    loading : true,\n    crudMethod: {getCheckList }\n})\n\nconst defaultForm = {\n    name: null,\n    checkData:null\n}\n\n\nexport default {\n    name: \"resultCheck\",\n    components: {pagination,  crudOperation,  rrOperation, Treeselect},\n    mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\n    dicts: ['IND_CURRENCY', 'IE_FREQUENCY'],\n    data() {\n        return {\n            permission: {\n                add: ['admin', 'resultCheck:add'],\n                edit: ['admin', 'resultCheck:edit'],\n                del: ['admin', 'resultCheck:del']\n            },\n            activeName: 'first',\n            showDetailDialog: false,\n            detailDialogTitle : '新增|编辑',\n            firstDisabled : false,\n            secondDisabled : false,\n            resultDepts: [],\n\n            checkForm : { formulaOne : '', formulaOneExp : '' ,formulaTwo : '', formulaTwoExp : '', name : '', code : ''},\n            showIndDefRule: false,\n            value: [],\n            valueLable : [],\n            transferData: [],\n            renderFunc(h, option) {\n                return <span>{ option.label }</span>;\n            },\n            genAndDerivedIndArr: [],\n            compareSymbolArr: [\n                {id:\"0\", value: \">\"},\n                {id:\"1\", value: \">=\"},\n                {id:\"2\", value: \"<\"},\n                {id:\"3\", value: \"<=\"},\n                {id:\"4\", value: \"=\"},\n                {id:\"5\", value: \"≠\"}\n            ],\n\n            showIndDefRuleTwo : false,\n            valueTwo: [],\n            valueLableTwo : [],\n\n            valueFix : [],\n            valueLableFix : [],\n            showIndDefRuleFix : false,\n\n            fixRules: {\n                code: [\n                    { required: true, message: '指标不能为空', trigger: 'blur' }\n                ],\n                fixOrgCode: [\n                    { required: true, message: '机构不能为空', trigger: 'blur' }\n                ],\n                fixCurrency: [\n                    { required: true, message: '币种不能为空', trigger:  'blur' }\n                ],\n                fixIndFrequency: [\n                    { required: true, message: '指标频率不能为空', trigger:  'blur' }\n                ],\n                compareSymbol: [\n                    { required: true, message: '比较符不能为空', trigger: 'blur'}\n                ],\n                fixVal: [\n                    { required: true, message: '定量值是数值且不能为空', trigger: 'blur' }\n                ]\n            },\n            //是否显示错误信息\n            ruleTipShow:{\n                formulaOne:false,\n                formulaOrgCode:false,\n                formulaCurrency:false,\n                formulaIndFrequency:false,\n                formulaCompareSymbol:false,\n                formulaTwo:false,\n            },\n            formulaRules: {\n                formulaOne: [\n                    { required: true, message: '计算公式不能为空', trigger: 'blur' }\n                ],\n                formulaOrgCode: [\n                    { required: true, message: '机构不能为空', trigger: 'blur' }\n                ],\n                formulaCurrency: [\n                    { required: true, message: '币种不能为空', trigger:  'blur' }\n                ],\n                formulaIndFrequency: [\n                    { required: true, message: '指标频率不能为空', trigger:  'blur' }\n                ],\n                formulaCompareSymbol: [\n                    { required: true, message: '比较符不能为空', trigger: 'blur'}\n                ],\n                formulaTwo: [\n                    { required: true, message: '计算公式不能为空', trigger: 'blur' }\n                ]\n            }\n\n\n\n        }\n    },\n    created() {\n        //this.crud.optShow.del=false\n        //this.crud.optShow.edit=false\n        //this.initDimInfos()\n        //this.initDimValuesChildren()\n       // this.initDimValues()\n        //this.initClassifications()\n        this.initGenAndDerivedInd()\n        //this.initIndFirstType()\n        //this.getDepts();\n        this.getResultDepts();\n        this.resetQuery()\n    },\n    methods :{\n      resetQuery(){\n        this.crud.resetQuery(false);\n        this.crud.refresh()\n      },\n        [CRUD.HOOK.beforeRefresh]() {\n            this.crud.optShow.del = true\n            this.crud.optShow.add = true\n            this.crud.optShow.edit = true\n            return true\n        },\n\n\n        [CRUD.HOOK.beforeToAdd]() {\n            this.showDetailDialog = true;\n\n            this.activeName = 'first'\n            this.firstDisabled = false;\n            this.secondDisabled = false;\n\n        },\n        [CRUD.HOOK.beforeToEdit]() {\n\n            this.$nextTick(() => {\n                this.$refs.fixForm.clearValidate();\n            })\n            /*this.$nextTick(() => {\n                this.$refs.formulaForm.clearValidate();\n            })*/\n\n\n            this.showDetailDialog = true;\n            this.valueLable = [];\n            this.valueLableTwo = [];\n            if(this.crud.selections[0].check_type == '0') {\n                //定量\n                this.activeName = 'first'\n                this.firstDisabled = false;\n                this.secondDisabled = true;\n\n                this.checkForm.checkType = this.crud.selections[0].check_type\n                this.checkForm.id = this.crud.selections[0].id\n                this.checkForm.code = this.crud.selections[0].ie_code\n                this.checkForm.name = this.crud.selections[0].ie_name\n                this.checkForm.compareSymbol = this.crud.selections[0].compare_symbol\n                this.checkForm.fixVal = this.crud.selections[0].fix_val\n\n                this.checkForm.fixCurrency = this.crud.selections[0].ind_currency\n                this.checkForm.fixOrgCode = this.crud.selections[0].ind_dept_code\n                this.checkForm.fixIndFrequency = this.crud.selections[0].ind_frequency\n\n            } else if (this.crud.selections[0].check_type == '1') {\n                this.activeName = 'second'\n                this.firstDisabled = true;\n                this.secondDisabled = false;\n\n                this.checkForm.checkType = this.crud.selections[0].check_type\n                this.checkForm.id = this.crud.selections[0].id\n                //this.checkForm.code = this.crud.selections[0].ie_code\n                this.checkForm.formulaOne = this.crud.selections[0].ie_name\n                this.checkForm.formulaCompareSymbol = this.crud.selections[0].compare_symbol\n                this.checkForm.formulaTwo = this.crud.selections[0].fix_val\n\n                this.checkForm.formulaOneExp = this.crud.selections[0].formula_one_exp\n                this.checkForm.formulaTwoExp = this.crud.selections[0].formula_two_exp\n\n                this.checkForm.formulaCurrency = this.crud.selections[0].ind_currency\n                this.checkForm.formulaOrgCode = this.crud.selections[0].ind_dept_code\n                this.checkForm.formulaIndFrequency = this.crud.selections[0].ind_frequency\n            }\n        },\n        [CRUD.HOOK.beforeDelete]() {\n            var selectIds = \"\";\n            for (let items of this.crud.selections) {\n                if (items.id != '') {\n                    selectIds += items.id + \",\";\n                }\n            }\n\n            deleteCheckData(qs.stringify({ids : selectIds})).then(res => {\n                if (res.code == '0') {\n                    this.$message({\n                        type: 'success',\n                        message: '操作成功 '\n                    })\n                }\n                this.crud.refresh();\n            })\n\n            return false;\n        },\n        closeApproveDetailDialog() {\n            this.showDetailDialog = false\n            this.activeName = 'first'\n            this.checkForm = { }\n        },\n        handleClick(tab, event) {\n            console.log(\"=====\" + tab, event);\n        },\n        saveCheckForm(){\n            var checkParam = {};\n            checkParam.id = this.checkForm.id\n            if (this.activeName == 'first') {\n\n                checkParam.code = this.checkForm.code\n                checkParam.name = this.checkForm.name\n                checkParam.compareSymbol = this.checkForm.compareSymbol\n                checkParam.fixVal = this.checkForm.fixVal\n                checkParam.checkType = '0'\n\n                checkParam.indDeptCode = this.checkForm.fixOrgCode\n                checkParam.indCurrency = this.checkForm.fixCurrency\n                checkParam.indFrequency = this.checkForm.fixIndFrequency\n            } else {\n                checkParam.formulaOne = this.checkForm.formulaOne\n                checkParam.formulaOneExp = this.checkForm.formulaOneExp\n                checkParam.formulaTwo = this.checkForm.formulaTwo\n                checkParam.formulaTwoExp = this.checkForm.formulaTwoExp\n                checkParam.formulaCompareSymbol = this.checkForm.formulaCompareSymbol\n                checkParam.checkType = '1'\n\n                checkParam.indDeptCode = this.checkForm.formulaOrgCode\n                checkParam.indCurrency = this.checkForm.formulaCurrency\n                checkParam.indFrequency = this.checkForm.formulaIndFrequency\n            }\n\n            if (this.activeName == 'first') {\n                this.$refs[\"fixForm\"].validate(valid => {\n                    if (!valid) {\n                        return\n                    }\n                    saveCheckData(qs.stringify(checkParam)).then(res => {\n                        if (res.code == '0') {\n                            this.$message({\n                                type: 'success',\n                                message: '操作成功 '\n                            })\n                        } else {\n                            this.$message({\n                                type: 'error',\n                                message: '操作失败 ' + res.msg\n                            })\n                        }\n                        this.closeApproveDetailDialog();\n                        this.crud.refresh()\n                    })\n                })\n            } else {\nconsole.log(\"checkParam\",checkParam)\n\n                this.ruleTipShow={\n                    formulaOne:false,\n                    formulaOrgCode:false,\n                    formulaCurrency:false,\n                    formulaIndFrequency:false,\n                    formulaCompareSymbol:false,\n                    formulaTwo:false,\n                }\n\n                let flag=true;//校验是否通过\n                if(!checkParam.formulaOne){\n                    this.ruleTipShow.formulaOne=true;\n                    flag=false;\n                }\n                if(!checkParam.indDeptCode){\n                    this.ruleTipShow.formulaOrgCode=true;\n                    flag=false;\n                }\n                if(!checkParam.indCurrency){\n                    this.ruleTipShow.formulaCurrency=true;\n                    flag=false;\n                }\n                if(!checkParam.indFrequency){\n                    this.ruleTipShow.formulaIndFrequency=true;\n                    flag=false;\n                }\n                if(!checkParam.formulaCompareSymbol){\n                    this.ruleTipShow.formulaCompareSymbol=true;\n                    flag=false;\n                }\n                if(!checkParam.formulaTwo){\n                    this.ruleTipShow.formulaTwo=true;\n                    flag=false;\n                }\n\n                if(flag){\n\n                    //合规行校验\n                    var formulaFlag = this.checkFormulaExp(checkParam.formulaOne);\n\n                    if (!formulaFlag) {\n                        this.$message({\n                            type: 'error',\n                            message: '计算公式1配置错误'\n                        })\n                        return;\n                    }\n\n                    checkParam.formulaOneExp = this.setFormulaExp(this.checkForm.formulaOne);\n                    if (checkParam.formulaOneExp != null) {\n                        if (checkParam.formulaOneExp.indexOf(\"[\") >=0 || checkParam.formulaOneExp.indexOf(\"]\") >= 0) {\n                            this.$message({\n                                type: 'error',\n                                message: '计算公式1指标名称不能修改'\n                            })\n                            return;\n                        }\n                        checkParam.formulaOneExp = checkParam.formulaOneExp.replaceAll(\"#\",\"[\");\n                        checkParam.formulaOneExp = checkParam.formulaOneExp.replaceAll(\";\",\"]\");\n                    }\n\n\n                    //计算公式2\n\n                    var formulaFlagTwo = this.checkFormulaExp(checkParam.formulaTwo);\n\n                    if (!formulaFlagTwo) {\n                        this.$message({\n                            type: 'error',\n                            message: '计算公式2配置错误'\n                        })\n                        return;\n                    }\n\n                    checkParam.formulaTwoExp = this.setFormulaExp(this.checkForm.formulaTwo);\n                    if (checkParam.formulaTwoExp != null) {\n                        if (checkParam.formulaTwoExp.indexOf(\"[\") >=0 || checkParam.formulaTwoExp.indexOf(\"]\") >= 0) {\n                            this.$message({\n                                type: 'error',\n                                message: '计算公式2指标名称不能修改'\n                            })\n                            return;\n                        }\n                        checkParam.formulaTwoExp = checkParam.formulaTwoExp.replaceAll(\"#\",\"[\");\n                        checkParam.formulaTwoExp = checkParam.formulaTwoExp.replaceAll(\";\",\"]\");\n                    }\n\n                    //调用接口\n                     saveCheckData(qs.stringify(checkParam)).then(res => {\n                         if (res.code == '0') {\n                             this.$message({\n                                 type: 'success',\n                                 message: '操作成功 '\n                             })\n                         } else {\n                             this.$message({\n                                 type: 'error',\n                                 message: '操作失败 ' + res.msg\n                             })\n                         }\n                         this.closeApproveDetailDialog();\n                         this.crud.refresh()\n                     })\n                } else {\n                    return;\n                }\n            }\n        },\n        onInput(){\n            this.$forceUpdate();\n        },\n        clearFormulaOne(){\n            this.checkForm.formulaOne = '' ;\n            this.checkForm.formulaOneExp = '' ;\n            this.$forceUpdate()\n        },\n        indDefRulePlus() {\n            if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = ''\n            }\n            if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = ''\n            }\n\n            this.checkForm.formulaOne += ' + '\n            //this.checkForm.formulaOneExp += ' + '\n            this.$forceUpdate()\n        },\n        // 指标规则-号按钮\n        indDefRuleSubtraction() {\n            if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = ''\n            }\n            if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = ''\n            }\n            this.checkForm.formulaOne += ' - '\n           // this.checkForm.formulaOneExp += ' - '\n            this.$forceUpdate()\n        },\n        // 指标规则×号按钮\n        indDefRuleMultiplication() {\n            if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = ''\n            }\n            if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = ''\n            }\n            this.checkForm.formulaOne += ' * '\n          //  this.checkForm.formulaOneExp += ' * '\n            this.$forceUpdate()\n        },\n        // 指标规则/号按钮\n        indDefRuleDivision() {\n            if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = ''\n            }\n            if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = ''\n            }\n            this.checkForm.formulaOne += ' / '\n          //  this.checkForm.formulaOneExp += ' / '\n            this.$forceUpdate()\n        },\n        indDefRuleLP(){\n            if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = ''\n            }\n            if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = ''\n            }\n            this.checkForm.formulaOne += ' ( '\n        //    this.checkForm.formulaOneExp += ' ( '\n            this.$forceUpdate()\n        },\n        indDefRuleRP(){\n            if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = ''\n            }\n            if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = ''\n            }\n            this.checkForm.formulaOne += ' ) '\n        //    this.checkForm.formulaOneExp += ' ) '\n            this.$forceUpdate()\n        },\n        // 衍生指标编辑指标口径规则\n        showIndDefRuleDialog() {\n            // this.formulaOneExp = ''\n            this.value = []\n            this.showIndDefRule = true\n        },\n        // 关闭衍生指标编辑指标口径规则\n        closeIndDefRuleDialog() {\n            this.showIndDefRule = false\n        },\n        handleChange(value, direction, movedKeys) {\n            // valueLable\n            //this.transferData[0].label\n            this.valueLable = [];\n            this.value.map(item =>{\n                var targetObj = this.transferData.filter(function(itemObj){\n                    return itemObj.key == item;\n                })\n                this.valueLable.push(targetObj[0].label)\n            })\n\n        },\n        initGenAndDerivedInd() {\n            getAllInds().then(data => {\n                this.genAndDerivedIndArr = data.data\n                for (let i = 0; i < this.genAndDerivedIndArr.length; i++) {\n                    this.transferData.push({key: this.genAndDerivedIndArr[i].bizCode, label: this.genAndDerivedIndArr[i].bizName})\n                }\n            })\n        },\n        // 选择指标进行规则拼接\n        selectInd() {\n            /*if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = '';\n            }*/\n\n\n            /*if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = '';\n            }*/\n\n\n            /*if (this.valueLable.length > 0 ) {\n                this.checkForm.formulaOne += ' [' + this.valueLable[0] + '] '\n            }*/\n\n            if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\n                this.checkForm.formulaOne = ''\n            }\n            if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\n                this.checkForm.formulaOneExp = ''\n            }\n\n            if (this.value.length > 0 ) {\n                for (var i = 0; i < this.value.length; i++) {\n                    var name =  ' [' + this.valueLable[i] + '] ';\n                    var code = ' [' + this.value[i] + '] ';\n                    this.checkForm.formulaOne += name\n                }\n                //this.checkForm.formulaOneExp += ' [' + this.value[0] + '] '\n            }\n\n            this.showIndDefRule = false\n        },\n\n\n        clearFormulaTwo(){\n            this.checkForm.formulaTwo = '' ;\n            this.checkForm.formulaTwoExp = '' ;\n            this.$forceUpdate()\n        },\n        indDefRulePlusTwo() {\n            if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\n                this.checkForm.formulaTwo = ''\n            }\n            if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\n                this.checkForm.formulaTwoExp = ''\n            }\n\n            this.checkForm.formulaTwo += ' + '\n            this.checkForm.formulaTwoExp += ' + '\n            this.$forceUpdate()\n        },\n        // 指标规则-号按钮\n        indDefRuleSubtractionTwo() {\n            if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\n                this.checkForm.formulaTwo = ''\n            }\n            if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\n                this.checkForm.formulaTwoExp = ''\n            }\n            this.checkForm.formulaTwo += ' - '\n            this.checkForm.formulaTwoExp += ' - '\n            this.$forceUpdate()\n        },\n        // 指标规则×号按钮\n        indDefRuleMultiplicationTwo() {\n            if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\n                this.checkForm.formulaTwo = ''\n            }\n            if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\n                this.checkForm.formulaTwoExp = ''\n            }\n            this.checkForm.formulaTwo += ' * '\n            this.checkForm.formulaTwoExp += ' * '\n            this.$forceUpdate()\n        },\n        // 指标规则/号按钮\n        indDefRuleDivisionTwo() {\n            if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\n                this.checkForm.formulaTwo = ''\n            }\n            if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\n                this.checkForm.formulaTwoExp = ''\n            }\n            this.checkForm.formulaTwo += ' / '\n            this.checkForm.formulaTwoExp += ' / '\n            this.$forceUpdate()\n        },\n        indDefRuleLPTwo(){\n            if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\n                this.checkForm.formulaTwo = ''\n            }\n            if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\n                this.checkForm.formulaTwoExp = ''\n            }\n            this.checkForm.formulaTwo += ' ( '\n            this.checkForm.formulaTwoExp += ' ( '\n            this.$forceUpdate()\n        },\n        indDefRuleRPTwo(){\n            if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\n                this.checkForm.formulaTwo = ''\n            }\n            if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\n                this.checkForm.formulaTwoExp = ''\n            }\n            this.checkForm.formulaTwo += ' ) '\n            this.checkForm.formulaTwoExp += ' ) '\n            this.$forceUpdate()\n        },\n        // 衍生指标编辑指标口径规则\n        showIndDefRuleDialogTwo() {\n            // this.formulaOneExp = ''\n            this.valueTwo = []\n            this.showIndDefRuleTwo = true\n        },\n        // 关闭衍生指标编辑指标口径规则\n        closeIndDefRuleDialogTwo() {\n            this.showIndDefRuleTwo = false\n        },\n        handleChangeTwo(value, direction, movedKeys) {\n            // valueLable\n            //this.transferData[0].label\n            this.valueLableTwo = [];\n            this.valueTwo.map(item =>{\n                var targetObj = this.transferData.filter(function(itemObj){\n                    return itemObj.key == item;\n                })\n                this.valueLableTwo.push(targetObj[0].label)\n            })\n\n        },\n        // 选择指标进行规则拼接\n        selectIndTwo() {\n            if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\n                this.checkForm.formulaTwo = ''\n            }\n            if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\n                this.checkForm.formulaTwoExp = ''\n            }\n\n            if (this.valueTwo.length > 0 ) {\n                for (var i = 0; i < this.valueTwo.length; i++) {\n                    var name =  ' [' + this.valueLableTwo[i] + '] ';\n                    var code = ' [' + this.valueTwo[i] + '] ';\n                    this.checkForm.formulaTwo += name\n                }\n            }\n\n            this.showIndDefRuleTwo = false\n        },\n        // 衍生指标编辑指标口径规则\n        showIndDefRuleDialogFix() {\n            // this.formulaOneExp = ''\n            this.valueFix = []\n            this.showIndDefRuleFix = true\n        },\n        closeIndDefRuleDialogFix() {\n            this.showIndDefRuleFix = false\n        },\n        handleChangeFix(value, direction, movedKeys) {\n            //this.transferData[0].label\n            this.valueLableFix = [];\n            this.valueFix.map(item =>{\n                var targetObj = this.transferData.filter(function(itemObj){\n                    return itemObj.key == item;\n                })\n                this.valueLableFix.push(targetObj[0].label)\n            })\n\n        },\n        // 选择指标进行规则拼接\n        selectIndFix() {\n            if (this.valueFix.length > 0 ) {\n                this.checkForm.name = ' [' + this.valueLableFix[0] + '] '\n                this.checkForm.code = this.valueFix[0]\n            }\n\n            this.showIndDefRuleFix = false\n        },\n        selectFixInd(id){\n            var targetObj = this.transferData.filter(function(itemObj){\n                return itemObj.key == id;\n            })\n            this.checkForm.name = targetObj[0].label;\n        },\n        getResultDepts() {\n            getResultDepts().then(res => {\n                this.resultDepts = res.content\n            })\n        },\n        checkFormulaExp(formulaStr){\n            //公式前端校验\n            var formulaTmp = formulaStr.replaceAll(\" \",\"\");\n            do {\n                if (formulaTmp.lastIndexOf(\"]\") < (formulaTmp.length - 1)) {\n                    var suf = formulaTmp.charAt(formulaTmp.lastIndexOf(\"]\")+1);\n                    if (suf != '+' && suf != '-' && suf != '*' && suf != '/' && suf != ')' ) {\n                        return false;\n                    }\n                }\n\n                if (formulaTmp.lastIndexOf(\"[\") > 0 ) {\n                    var pre = formulaTmp.charAt(formulaTmp.lastIndexOf(\"[\") - 1);\n                    if (pre != '+' && pre != '-' && pre != '*' && pre != '/' && pre != '(' ) {\n                        return false;\n                    }\n                }\n\n                formulaTmp = formulaTmp.replace(formulaTmp.substring(formulaTmp.lastIndexOf(\"[\"), formulaTmp.lastIndexOf(\"]\") + 1),\"1\")\n\n            } while (formulaTmp.lastIndexOf(\"]\") > 0 );\n\n            return true;\n\n        },\n        setFormulaExp(formulaStr){\n            var formulaExp = formulaStr;\n            do {\n                var pre = formulaExp.lastIndexOf(\"[\");\n                var suf = formulaExp.lastIndexOf(\"]\");\n\n                //指标名称\n                var indName = formulaExp.substring(pre, suf + 1);\n                var indCode = '';\n                //指标编码\n                var targetObj = this.transferData.filter(function(itemObj){\n                    return indName.indexOf(itemObj.label) >= 0;\n                })\n                if (targetObj[0] == null) {\n                    return '[]';\n                }\n                indCode = targetObj[0].key;\n                formulaExp = formulaExp.replace(indName, '#' + indCode + ';')\n            } while (formulaExp.lastIndexOf(\"]\") > 0 );\n            return formulaExp;\n        }\n\n\n    }\n\n\n}\n",null]}