{"remainingRequest":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\indicator\\notice.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\indicator\\notice.vue","mtime":1647917138769},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1647917137429}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport crudSysNotice, {topNotice} from '../../../api/indicators/notice'\r\nimport CRUD, {presenter, header, form, crud} from '@crud/crud'\r\nimport rrOperation from '@crud/RR.operation'\r\nimport crudOperation from '@crud/CRUD.operation'\r\nimport udOperation from '@crud/UD.operation'\r\nimport pagination from '@crud/Pagination'\r\nimport {quillEditor} from \"vue-quill-editor\";\r\nimport quillConfig from \"../../../api/indicators/quill-config\";\r\nimport $ from 'jquery';\r\n// crud交由presenter持有\r\nconst defaultCrud = CRUD({title: '公告管理', url: crudSysNotice.url, sort: 'sortNo', crudMethod: {...crudSysNotice.crud}})\r\nconst defaultForm = {\r\n  id: null,\r\n  title: null,\r\n  content: null,\r\n  effectDateFrom: null,\r\n  effectDateTo: null,\r\n  sortNo: 1,\r\n  crtUserCode: null,\r\n  crtDate: null\r\n}\r\n\r\n\r\nexport default {\r\n  name: 'SysNotice',\r\n  components: {pagination, crudOperation, rrOperation, udOperation, quillEditor},\r\n  mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\r\n\r\n  data() {\r\n    const checkDateFrom = (rule, value, cb) => {\r\n      if (this.form.effectDateFrom == null || this.form.effectDateTo == null) {\r\n        return cb();\r\n      }\r\n      this.$refs['form'].clearValidate(['effectDateTo']);\r\n      if (this.form.effectDateFrom > this.form.effectDateTo) {\r\n        return cb(\"开始日期要小于结束日期\");\r\n      }\r\n      return cb();\r\n    };\r\n    const checkDateTo = (rule, value, cb) => {\r\n      if (this.form.effectDateFrom == null || this.form.effectDateTo == null) {\r\n        return cb();\r\n      }\r\n      this.$refs['form'].clearValidate(['effectDateFrom']);\r\n      if (this.form.effectDateFrom > this.form.effectDateTo) {\r\n        return cb(\"结束日期要大于开始日期\");\r\n      }\r\n      return cb();\r\n    };\r\n    return {\r\n      contentQuillOption: {\r\n        placeholder: \"请输入公告内容\",\r\n        theme: 'snow',\r\n        modules: quillConfig.contentModules\r\n      },\r\n      titleQuillOption: {\r\n        placeholder: \"请输入公告标题\",\r\n        theme: 'snow',\r\n        modules: quillConfig.titleModules\r\n      },\r\n      permission: {\r\n        add: ['admin', 'sysNotice:add'],\r\n        edit: ['admin', 'sysNotice:edit'],\r\n        del: ['admin', 'sysNotice:del']\r\n      },\r\n\r\n      rules: {\r\n        title: [\r\n          {required: true, message: '标题不能为空', trigger: 'blur'}\r\n        ],\r\n        content: [\r\n          {required: true, message: '内容不能为空', trigger: 'blur'}\r\n        ],\r\n        effectDateFrom: [\r\n          {required: true, message: '开始日期不能为空', trigger: 'blur'},\r\n          {validator: checkDateFrom, trigger: 'blur'}\r\n        ],\r\n        effectDateTo: [\r\n          {required: true, message: '结束日期不能为空', trigger: 'blur'},\r\n          {validator: checkDateTo, trigger: 'blur'}\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.crud.resetQuery(false);\r\n    this.query.type = 1;\r\n    //this.crud.refresh();\r\n  },\r\n  mounted() {\r\n    //this.query.type= 1;\r\n    //this.crud.refresh();\r\n  },\r\n  methods: {\r\n    // 获取数据前设置好接口地址\r\n    [CRUD.HOOK.beforeRefresh]() {\r\n      this.query.type = 1;\r\n      return true\r\n    },\r\n    toDelete(data) {\r\n      //批量删除\r\n      this.$confirm('确认删除公告?', '删除公告', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        this.crud.doDelete(data);\r\n      })\r\n    },\r\n    topNotice(id, sortNo) {\r\n      if (sortNo == 1) {\r\n        this.$confirm('确认是否取消置顶?', '取消置顶', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          topNotice(id, sortNo).then(res => {\r\n            if (res.code == 0) {\r\n              this.$notify({\r\n                title: '取消置顶成功',\r\n                type: 'success',\r\n                duration: 2500\r\n              })\r\n            }\r\n          })\r\n        }).catch(() => {\r\n        })\r\n      } else {\r\n        this.$confirm('确认是否置顶?', '置顶', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'warning'\r\n        }).then(() => {\r\n          topNotice(id, sortNo).then(res => {\r\n            if (res.code == 0) {\r\n              this.$notify({\r\n                title: '置顶成功',\r\n                type: 'success',\r\n                duration: 2500\r\n              })\r\n            }\r\n          })\r\n        }).catch(() => {\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n",null]}