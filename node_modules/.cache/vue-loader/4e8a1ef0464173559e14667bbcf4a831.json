{"remainingRequest":"D:\\SZBank\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\SZBank\\src\\views\\indicators\\portalHome\\workSheet\\processApprove.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\SZBank\\src\\views\\indicators\\portalHome\\workSheet\\processApprove.vue","mtime":1656042563778},{"path":"D:\\SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\SZBank\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\SZBank\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport ThemeSelect from \"@portal/components/ThemeSelect\";\r\nexport default {\r\n  components: {\r\n    ThemeSelect,\r\n  },\r\n  data() {\r\n    return {\r\n      // basicinfo\r\n      basicinfo: {\r\n        tableName: \"\",\r\n        chineseName: \"\",\r\n        owner: \"\",\r\n        tenantCode: \"\",\r\n        project: \"\",\r\n        driverType: \"\",\r\n        myCrtTime: \"\",\r\n        myUpdTime: \"\",\r\n        online: \"是\",\r\n        catalogue1: \"\",\r\n        catalogue2: \"\",\r\n        catalogue1Name: \"\",\r\n        catalogue2Name: \"\",\r\n      },\r\n      basicInfoProp: [\r\n        {\r\n          prop: \"chineseName\",\r\n          label: \"中文名\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"owner\",\r\n          label: \"所属用户\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"tenantCode\",\r\n          label: \"租户编码\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"project\",\r\n          label: \"存储项目名称\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"driverType\",\r\n          label: \"底层存储类型\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"myCrtTime\",\r\n          label: \"创建时间\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"myUpdTime\",\r\n          label: \"更新时间\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"online\",\r\n          label: \"是否公开\",\r\n          align: \"center\",\r\n        },\r\n      ],\r\n      basicInfoList: [],\r\n      dataList: [],\r\n      propList: [],\r\n      detailsView: true,\r\n      id: \"\",\r\n      assetsState: \"\",\r\n      // 目录树\r\n      catalogueList: [],\r\n      cataValue: [],\r\n      ruleForm: {\r\n        apprComment: \"\",\r\n      },\r\n      rules: {\r\n        apprComment: [\r\n          { required: true, message: \"请输入审批意见\", trigger: \"blur\" },\r\n        ],\r\n      },\r\n      taskId: '',\r\n      processFlag: true,\r\n      // 审批表格\r\n      commentData: [],\r\n      commentProp: [],\r\n      // todo\r\n      todo: false,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initData()\r\n  },\r\n  methods: {\r\n    // 关闭当前页\r\n    returnLastPage() {\r\n      this.$router.back()\r\n    },\r\n    initData() {\r\n      // 目录树\r\n      this.$api.getAllCatalogueList({}).then((res) => {\r\n        this.catalogueList = res.data;\r\n      });\r\n      // 数据\r\n      this.id = this.$route.query.id; // 通过路由传递id\r\n      this.taskId = this.$route.query.taskId\r\n      this.$api\r\n        .getTableByIdToProcessApprove({\r\n          taskId: this.taskId,\r\n        })\r\n        .then((res) => {\r\n          console.log(res,2333);\r\n          this.basicInfoList = [];\r\n          this.cataValue = [];\r\n          let data = res.data;\r\n          this.todo = data.todo === 'true' ? true : false\r\n          this.basicinfo = data.main_form;\r\n          this.basicInfoList.push(this.basicinfo);\r\n          // 表格数据\r\n          this.dataList = data.sub_forms;\r\n          // 审批表格数据\r\n          this.commentData = data.opinion\r\n          // 发布状态\r\n          this.assetsState = this.basicinfo.assetsState;\r\n          // 返回的目录  -- 渲染\r\n          let temp = this.basicinfo.catalogues;\r\n\r\n          for (let key in temp) {\r\n            key = key.split(\"/\");\r\n            this.cataValue.push({ id: key });\r\n          }\r\n          console.log(this.cataValue);\r\n        });\r\n      this.propList = [\r\n        {\r\n          prop: \"columnName\",\r\n          label: \"字段名称\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"columnMessage\",\r\n          label: \"字段信息\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"type\",\r\n          label: \"字段类型\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"length\",\r\n          label: \"字段长度\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"isNull\",\r\n          label: \"是否可以为空\",\r\n          align: \"center\",\r\n        },\r\n      ];\r\n      this.commentProp = [\r\n        {\r\n          prop: \"state\",\r\n          label: \"办理环节\",\r\n          type: \"tag\",\r\n          align: \"center\",\r\n          tagType: (row) => {\r\n            return row.state == 1\r\n              ? \"info\"\r\n              : \"warning\";\r\n          },\r\n          render: (row) => {\r\n            return row.state == 1\r\n              ? \"已办\"\r\n              : \"待办\";\r\n          },\r\n        },\r\n        {\r\n          prop: \"user_name\",\r\n          label: \"办理人\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"message\",\r\n          label: \"办理意见\",\r\n        },\r\n        {\r\n          prop: \"duration\",\r\n          label: \"办理时效(工作日)\",\r\n          align: \"center\",\r\n        },\r\n        {\r\n          prop: \"end_time\",\r\n          label: \"更新时间\",\r\n        },\r\n      ]\r\n    },\r\n    transOnline(online) {\r\n      if (online === 1) {\r\n        return \"是\";\r\n      } else if (online === 0) {\r\n        return \"否\";\r\n      } else {\r\n        return \"\";\r\n      }\r\n    },\r\n    // 审批  -- 通过\r\n    pass(formName) {\r\n      console.log(\"通过\", this.taskId);\r\n      this.$refs[formName].validate((valid) => {\r\n        if (valid && this.processFlag) {\r\n          this.processFlag = false;\r\n          this.$api\r\n            .completeTask({\r\n              taskId: this.taskId,\r\n              submitType: \"0\",\r\n              assignee: \"\",\r\n              apprComment: this.ruleForm.apprComment,\r\n            })\r\n            .then((res) => {\r\n              if (res.code == 0 || res.code == 200) {\r\n                this.$message.success(res.msg);\r\n                this.returnLastPage()\r\n              } else {\r\n                this.$message.error(res.msg);\r\n              }\r\n              this.processFlag = true;\r\n            });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    // 审批  -- 拒绝\r\n    reject(formName) {\r\n      console.log(\"拒绝\", this.taskId);\r\n      this.$refs[formName].validate((valid) => {\r\n        if (valid && this.processFlag) {\r\n          this.processFlag = false;\r\n          this.$api\r\n            .completeTask({\r\n              taskId: this.taskId,\r\n              submitType: \"1\",\r\n              assignee: \"\",\r\n              apprComment: this.ruleForm.apprComment,\r\n            })\r\n            .then((res) => {\r\n              if (res.code == 0 || res.code == 200) {\r\n                this.$message.success(res.msg);\r\n                this.returnLastPage()\r\n              } else {\r\n                this.$message.error(res.msg);\r\n              }\r\n              this.processFlag = true;\r\n            });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n  },\r\n};\r\n",null]}