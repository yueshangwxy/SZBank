{"remainingRequest":"D:\\SZBank\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\SZBank\\src\\views\\indicators\\myCollection\\myCollection.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\SZBank\\src\\views\\indicators\\myCollection\\myCollection.vue","mtime":1713697767955},{"path":"D:\\SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\SZBank\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\SZBank\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      activeName: \"all\",\r\n      tableData: [],\r\n      currentPage: 1,\r\n      pageSize: 9,\r\n      total: 50,\r\n      // 数据预览\r\n      dataPreVis: false,\r\n      preDataList: [],\r\n      preDataProp: [],\r\n      // 申请权限\r\n      authorityVis: false,\r\n      // 加入购物车参数\r\n      request: {\r\n        assetId: \"\",\r\n        beginTime: \"\",\r\n        endTime: \"\",\r\n      },\r\n      // 直接申请\r\n      directApplyVis: false,\r\n      daterange: \"\",\r\n      pickerOptions: {\r\n        disabledDate: (time) => {\r\n          let oneDay = 60 * 60 * 24 * 1000;\r\n          return time.getTime() < Date.now() - oneDay;\r\n        },\r\n      },\r\n      radio: \"2\",\r\n      // 提示弹窗\r\n      tipDialog: false,\r\n      dataErrorMsg: \"\",\r\n    };\r\n  },\r\n  mounted() {\r\n    this.$store.commit(\"SET_KEEPALIVE\", true);\r\n    if (this.$route.query && this.$route.query.activeName) {\r\n      this.activeName = this.$route.query.activeName;\r\n      this.getFavoriteList();\r\n    } else {\r\n      // 默认查询全部\r\n      this.$api\r\n        .queryMyCollection({\r\n          page: this.currentPage,\r\n          size: this.pageSize,\r\n        })\r\n        .then((res) => {\r\n          this.tableData = res.data.records;\r\n          this.total = res.data.total;\r\n        });\r\n    }\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    if (\r\n      to.path === \"/detailsView/table\" ||\r\n      to.path === \"/detailsView/api\" ||\r\n      to.path === \"/detailsView/label\" ||\r\n      to.path === \"/detailsView/target\"\r\n    ) {\r\n      this.$store.commit(\"SET_KEEPALIVE\", true);\r\n    } else {\r\n      this.$store.commit(\"SET_KEEPALIVE\", false);\r\n    }\r\n    next();\r\n  },\r\n  watch: {\r\n    // 时间选择\r\n    daterange(val) {\r\n      if (val) {\r\n        this.request.beginTime = this.formatDate(val[0]);\r\n        this.request.endTime = this.formatDate(val[1]);\r\n      } else {\r\n        this.request.beginTime = \"\";\r\n        this.request.endTime = \"\";\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    linefeed(h, { column, $index }) {\r\n      let realWidth = 0;\r\n      let span = document.createElement(\"span\");\r\n      span.innerText = column.label;\r\n      if (!column.label) {\r\n        document.body.appendChild(span);\r\n        realWidth = 100;\r\n        column.minWidth = realWidth; // 可能还有边距/边框等值，需要根据实际情况加上\r\n        document.body.removeChild(span);\r\n        if(column.label.indexOf(',')>-1) {\r\n          return h(\"div\",{},[\r\n            h(\"div\",{},column.label.split(',')[0]),\r\n            h(\"div\",{},column.label.split(',')[1]),\r\n          ])\r\n        } else {\r\n          return h(\"span\", column.label);\r\n        } \r\n      } else {\r\n        document.body.appendChild(span);\r\n        realWidth = span.getBoundingClientRect().width + 30;\r\n        column.minWidth = realWidth; // 可能还有边距/边框等值，需要根据实际情况加上\r\n        document.body.removeChild(span);\r\n        if(column.label.indexOf(',')>-1) {\r\n          return h(\"div\",{},[\r\n            h(\"div\",{},column.label.split(',')[0]),\r\n            h(\"div\",{},column.label.split(',')[1]),\r\n          ])\r\n        } else {\r\n          return h(\"span\", column.label);\r\n        } \r\n      }\r\n    },\r\n    getAssetTypeInfo(assetType) {\r\n      if (assetType === \"table\") {\r\n        return {\r\n          tagColor: \"success\",\r\n          tagName: \"表\",\r\n          codeName: \"tableName\",\r\n        };\r\n      } else if (assetType === \"target\") {\r\n        return {\r\n          tagColor: \"warning\",\r\n          tagName: \"指标\",\r\n          codeName: \"targetName\",\r\n        };\r\n      } else if (assetType === \"api\") {\r\n        return {\r\n          tagColor: \"\",\r\n          tagName: \"API\",\r\n          codeName: \"indexName\",\r\n        };\r\n      } else if (assetType === \"label\") {\r\n        return {\r\n          tagColor: \"danger\",\r\n          tagName: \"标签\",\r\n          codeName: \"labelName\",\r\n        };\r\n      }\r\n    },\r\n    // tab切换\r\n    handleClick(tab, event) {\r\n      this.currentPage = 1;\r\n      this.getFavoriteList();\r\n    },\r\n\r\n    //列表查询\r\n    getFavoriteList() {\r\n      if (this.activeName === \"all\") {\r\n        this.$api\r\n          .queryMyCollection({\r\n            page: this.currentPage,\r\n            size: this.pageSize,\r\n          })\r\n          .then((res) => {\r\n            this.tableData = res.data.records;\r\n            this.total = res.data.total;\r\n          });\r\n      } else if (this.activeName === \"table\") {\r\n        this.$api\r\n          .queryMyCollection({\r\n            page: this.currentPage,\r\n            size: this.pageSize,\r\n            assetType: \"table\",\r\n          })\r\n          .then((res) => {\r\n            this.tableData = res.data.records;\r\n            this.total = res.data.total;\r\n          });\r\n      } else if (this.activeName === \"api\") {\r\n        this.$api\r\n          .queryMyCollection({\r\n            page: this.currentPage,\r\n            size: this.pageSize,\r\n            assetType: \"api\",\r\n          })\r\n          .then((res) => {\r\n            this.tableData = res.data.records;\r\n            this.total = res.data.total;\r\n          });\r\n      } else if (this.activeName === \"target\") {\r\n        this.$api\r\n          .queryMyCollection({\r\n            page: this.currentPage,\r\n            size: this.pageSize,\r\n            assetType: \"target\",\r\n          })\r\n          .then((res) => {\r\n            this.tableData = res.data.records;\r\n            this.total = res.data.total;\r\n          });\r\n      } else if (this.activeName === \"label\") {\r\n        this.$api\r\n          .queryMyCollection({\r\n            page: this.currentPage,\r\n            size: this.pageSize,\r\n            assetType: \"label\",\r\n          })\r\n          .then((res) => {\r\n            this.tableData = res.data.records;\r\n            this.total = res.data.total;\r\n          });\r\n      }\r\n    },\r\n    // 分页\r\n    handleCurrentChange(val) {\r\n      this.currentPage = val;\r\n      this.getFavoriteList();\r\n    },\r\n    // 日期格式转换\r\n    formatDate(date) {\r\n      let y = date.getFullYear();\r\n      let m = date.getMonth() + 1;\r\n      m = m < 10 ? \"0\" + m : m;\r\n      let d = date.getDate();\r\n      d = d < 10 ? \"0\" + d : d;\r\n      let h = date.getHours();\r\n      h = h < 10 ? \"0\" + h : h;\r\n      let minute = date.getMinutes();\r\n      minute = minute < 10 ? \"0\" + minute : minute;\r\n      let second = date.getSeconds();\r\n      second = second < 10 ? \"0\" + second : second;\r\n      return y + \"-\" + m + \"-\" + d;\r\n      // return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;\r\n    },\r\n    // 详情查看\r\n    viewDetails(type, item) {\r\n      this.$router.push({\r\n        path: \"/detailsView/\" + item.assetType,\r\n        query: {\r\n          id: item.id,\r\n        },\r\n      });\r\n    },\r\n    // 删除收藏\r\n    delFavorite(item) {\r\n      this.$api\r\n        .delFavorite({\r\n          assetId: item.id,\r\n        })\r\n        .then((res) => {\r\n          if (res.code == 0 || res.code == 200) {\r\n            this.$message.success(res.msg);\r\n            this.getFavoriteList();\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        });\r\n    },\r\n    // 数据预览\r\n    previewData(item) {\r\n      this.preDataProp = [];\r\n      this.preDataList = [];\r\n      this.dataPreVis = true;\r\n      this.dataErrorMsg = \"\";\r\n      this.$api\r\n        .previewTableData({ name: item.tableName, project: item.project })\r\n        .then((res) => {\r\n          if (res.code == 200 || res.code == 0) {\r\n            this.preDataProp = res.data.columns;\r\n            this.preDataList = res.data.dataList;\r\n            this.$nextTick(() => {\r\n              this.$refs.dataTable.doLayout();\r\n            });\r\n          } else {\r\n            // this.$message.error(res.msg);\r\n            this.dataErrorMsg = res.msg;\r\n          }\r\n        });\r\n    },\r\n    // 申请访问\r\n    applyForAccess(item) {\r\n      this.$api\r\n        .applyForAccess({\r\n          apiId: item.id,\r\n        })\r\n        .then((res) => {\r\n          if (res.code == 0 || res.code == 200) {\r\n            this.$message.success(res.msg);\r\n            this.getFavoriteList();\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        });\r\n    },\r\n    // 申请权限\r\n    applyForAuthority(item) {\r\n      this.directApplyVis = true;\r\n      this.daterange = \"\";\r\n      this.request.tableId = item.id;\r\n    },\r\n    // 加入购物车\r\n    addShopCar() {\r\n      this.$api.addShopCar(this.request).then((res) => {\r\n        this.authorityVis = false;\r\n        if (res.code == 999) {\r\n          this.$message.warning(res.msg);\r\n        } else if (res.code == 200 || res.code == 0) {\r\n          this.$message.success(res.msg);\r\n        }\r\n      });\r\n    },\r\n    // 直接申请\r\n    directApply() {\r\n      this.authorityVis = false;\r\n      // 直接申请权限接口\r\n      let list = [this.request];\r\n      this.$api\r\n        .applyForAuthority({\r\n          list: list,\r\n        })\r\n        .then((res) => {\r\n          if (res.code == 200 || res.code == 0) {\r\n            this.$message.success(res.msg);\r\n            this.getFavoriteList();\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        });\r\n    },\r\n    // 确定申请\r\n    confirmApply() {\r\n      // 关闭当前弹窗\r\n      if (this.radio === \"2\") {\r\n        this.request.beginTime = \"\";\r\n        this.request.endTime = \"\";\r\n        this.directApplyVis = false;\r\n        // 打开申请权限方式弹窗\r\n        this.authorityVis = true;\r\n      } else {\r\n        if (this.daterange.length < 1) {\r\n          this.$message.error(\"请选择时间\");\r\n        } else {\r\n          this.directApplyVis = false;\r\n          // 打开申请权限方式弹窗\r\n          this.authorityVis = true;\r\n        }\r\n      }\r\n    },\r\n    // 失效时间转换\r\n    transInvalidTime(time) {\r\n      let invalidTime = time ? (time.indexOf(\"9999\") > -1 ? \"永久\" : time) : \"\";\r\n      return invalidTime;\r\n    },\r\n  },\r\n};\r\n",null]}