{"remainingRequest":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\myShopCar\\myShopCar.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\myShopCar\\myShopCar.vue","mtime":1656042806020},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n  name: \"MyShopCar\",\r\n  data() {\r\n    return {\r\n      searchInput: \"\",\r\n      // 表格\r\n      tableData: [],\r\n      propList: [],\r\n      // 分页\r\n      pageSize: 10,\r\n      currentPage: 1,\r\n      total: 4,\r\n      // 审批 弹窗\r\n      confirmDialog: false,\r\n      // 提示弹窗\r\n      tipDialog: false,\r\n      // 审批参数\r\n      request: [],\r\n      // 当前选中行\r\n      selectRows: [],\r\n      // 是否批量操作\r\n      isbatch: false,\r\n    };\r\n  },\r\n  beforeRouteLeave(to, from, next) {\r\n    if (\r\n      to.path === \"/detailsView/table\" ||\r\n      to.path === \"/detailsView/api\" ||\r\n      to.path === \"/detailsView/label\" ||\r\n      to.path ===  \"/detailsView/target\"\r\n    ) {\r\n      this.$store.commit(\"SET_KEEPALIVE\", true);\r\n    } else {\r\n      this.$store.commit(\"SET_KEEPALIVE\", false);\r\n    }\r\n    next();\r\n  },\r\n  created() {\r\n    this.$store.commit(\"SET_KEEPALIVE\", true);\r\n    this.propList = [\r\n      {\r\n        prop: \"tableName\",\r\n        label: \"表名\",\r\n        width: \"160\",\r\n      },\r\n      {\r\n        prop: \"deptCode\",\r\n        width: 130,\r\n        label: \"业务属主部门\",\r\n      },\r\n      {\r\n        prop: \"project\",\r\n        label: \"存储项目名称\",\r\n        width: \"160\",\r\n      },\r\n      {\r\n        prop: \"driverType\",\r\n        width: 130,\r\n        label: \"底层存储类型\",\r\n      },\r\n      {\r\n        prop: \"owner\",\r\n        label: \"所属用户\",\r\n      },\r\n      {\r\n        prop: \"beginTimeStr\",\r\n        width: 130,\r\n        label: \"权限开始日期\",\r\n      },\r\n      {\r\n        prop: \"endTimeStr\",\r\n        width: 130,\r\n        label: \"权限结束日期\",\r\n        type: \"endTime\",\r\n        render: (row) => {\r\n          let endTimeStr = row.endTimeStr\r\n            ? row.endTimeStr.indexOf(\"9999\") > -1\r\n              ? \"永久\"\r\n              : row.endTimeStr\r\n            : \"\";\r\n          return endTimeStr;\r\n        },\r\n      },\r\n      {\r\n        prop: \"crtDateStr\",\r\n        label: \"申请时间\",\r\n      },\r\n    ];\r\n  },\r\n  mounted() {\r\n    this.initList();\r\n  },\r\n  methods: {\r\n    transInvalidTime(time) {\r\n      if (time && time.includes(\"9999\")) {\r\n        return \"永久\";\r\n      } else {\r\n        return time;\r\n      }\r\n    },\r\n    // 从第一页开始查找\r\n    initList() {\r\n      this.currentPage = 1;\r\n      this.queryList();\r\n    },\r\n    // 查询列表\r\n    queryList() {\r\n      this.$api\r\n        .qryShopCar({\r\n          page: this.currentPage,\r\n          size: this.pageSize,\r\n          tableName: this.searchInput,\r\n        })\r\n        .then((res) => {\r\n          let data = res.data;\r\n          this.tableData = data.records;\r\n          this.total = data.total;\r\n        });\r\n    },\r\n    // 复选框选中\r\n    handleSelectionChange(val) {\r\n      // [{}]  [{},{}]\r\n      // this.selectRows = val\r\n      // if(this.selectRows.length<1) {\r\n      //     this.businessKey = ''\r\n      // } else {\r\n      //     this.selectRows.forEach(ele => {\r\n      //         this.businessKey = this.businessKey += ele.tableId + ','\r\n      //     });\r\n      //     this.businessKey = this.businessKey.slice(0,this.businessKey.length-1)\r\n      // }\r\n      this.selectRows = [];\r\n      val.forEach((item) => {\r\n        this.selectRows.push({\r\n          tableId: item.tableId,\r\n          beginTime: item.beginTimeStr,\r\n          endTime: item.endTimeStr,\r\n        });\r\n      });\r\n    },\r\n    // 详情查看\r\n    viewDetails(row) {\r\n      console.log(\"详情查看\", row.tableId);\r\n      this.$router.push({\r\n        path: \"/detailsView/table\",\r\n        query: {\r\n          id: row.tableId,\r\n        },\r\n      });\r\n    },\r\n    // 发起审批  -- 单个\r\n    initiateApproval(row) {\r\n      this.confirmDialog = true;\r\n      this.isbatch = false;\r\n      this.request = [\r\n        {\r\n          tableId: row.tableId,\r\n          beginTime: row.beginTimeStr,\r\n          endTime: row.endTimeStr,\r\n        },\r\n      ];\r\n    },\r\n    // 发起审批  -- 批量\r\n    batchOperation() {\r\n      this.confirmDialog = true;\r\n      this.isbatch = true;\r\n    },\r\n    // 确认审批\r\n    confrim() {\r\n      this.confirmDialog = false;\r\n      let list = [];\r\n      if (this.isbatch) {\r\n        list = this.selectRows;\r\n      } else {\r\n        list = this.request;\r\n      }\r\n      // 调接口审批\r\n      this.$api\r\n        .initiateApproval({\r\n          list: list,\r\n        })\r\n        .then((res) => {\r\n          console.log(res);\r\n          if (res.code == 200 || res.code == 0) {\r\n            this.tipDialog = true;\r\n            setTimeout(() => {\r\n              this.tipDialog = false;\r\n              this.queryList();\r\n            }, 3000);\r\n          } else {\r\n            this.$message.error(res.msg);\r\n          }\r\n        });\r\n    },\r\n    // 删除\r\n    deleteRow(row) {\r\n      this.$confirm(\"确定删除吗?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      }).then(() => {\r\n        this.$api\r\n          .delShopCar({\r\n            Id: row.id,\r\n          })\r\n          .then((res) => {\r\n            this.queryList();\r\n            this.$message.success(res.message);\r\n          });\r\n      });\r\n    },\r\n    // 分页\r\n    handleSizeChange(val) {\r\n      console.log(`每页 ${val} 条`);\r\n    },\r\n    handleCurrentChange(val) {\r\n      this.currentPage = val;\r\n      this.queryList();\r\n    },\r\n  },\r\n};\r\n",null]}