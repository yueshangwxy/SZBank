{"remainingRequest":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\portalHome\\manager\\roleManager.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\portalHome\\manager\\roleManager.vue","mtime":1653378909412},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport AddUserDialog from \"./addUserDialog.vue\";\nexport default {\n    name: \"roleManager\",\n    components: {\n        AddUserDialog,\n    },\n    data() {\n        return {\n            name: '',\n            date: '',\n            dateValue: [],\n            // 表格\n            tableData: [],\n            propList: [],\n            // 分页\n            pageSize: 9,\n            total: 10,\n            currentPage: 1,\n            // 角色新增弹窗\n            addOrEditTitle: '',\n            addRoleVisible: false,\n            // tenantList: [],\n            ruleForm: {\n                // tenant: '',\n                roleName: '',\n                desc: '',\n            },\n            rules: {\n                tenant: [\n                    { required: true, message: '请选择租户', trigger: 'change' },\n                ],\n                roleName: [\n                    { required: true, message: '请输入名称', trigger: 'blur' },\n                ],\n            },\n            // 单条数据删除popover框\n            singleDelVis: false,\n            // 新增用户弹窗\n            addUserVisible: false,\n            // 批量删除提示框\n            batchDeleteVisible: false,\n            // 当前选中行\n            selectRows: [],\n            // 当前操作行id\n            rowId: '',\n        };\n    },\n    watch: {\n        date(val) {\n            if(val) {\n                let startTime = this.$formatDate(val[0])\n                let endTime = this.$formatDate(val[1]) \n                this.dateValue = [startTime,endTime]\n                console.log(this.dateValue);\n            } else {\n                this.dateValue = []\n            }\n        }\n    },\n    created() {},\n    mounted() {},\n    computed: {},\n    created() {\n        this.propList = [\n            {\n                prop: 'name',\n                label: '名称',\n                align: 'center',\n            },\n            {\n                prop: 'tenant',\n                label: '所属租户',\n                align: 'center',\n            },\n            {\n                prop: 'desc',\n                label: '描述',\n            },\n            {\n                prop: 'crtDate',\n                label: '创建日期',\n            },\n        ]\n        this.queryList()\n        // this.$api.getTenants({}).then(res => {\n        //     this.tenantList = res\n        // })\n    },\n    methods: {\n        // 重置\n        reset() {\n            this.name = ''\n            this.date = ''\n        },\n        // 从第一页开始搜索\n        initList() {\n            this.currentPage = 1\n            this.queryList()\n        },\n        // 列表查询\n        queryList() {\n            // name(输入名称或者描述搜索) crtDate(时间控制) size(分页条数)  page(页码)\n            let request = {\n                name: this.name,\n                crtDate: this.dateValue,\n                size: this.pageSize,\n                page: this.currentPage,\n            }\n            console.log(request);\n            this.$api.qryRoleListPage(request).then(res => {\n                if(res.data && res.data.records) {\n                    this.tableData = res.data.records\n                }\n            })\n        },\n        // 复选框选中\n        handleSelectionChange(val) {\n            this.selectRows = val\n        },\n        // 角色新增\n        addRole() {\n            console.log('新增角色');\n            // this.ruleForm = {\n            //     tenant: '',\n            //     roleName: '',\n            //     desc: '',\n            // }\n            this.addOrEditTitle = '新增角色'\n            this.addRoleVisible = true\n            this.$nextTick(() => {\n                this.$refs['ruleForm'].resetFields();\n            })\n        },\n        // 新增/编辑角色弹窗确定\n        confirmAddRole() {\n            this.$refs['ruleForm'].validate((valid) => {\n                if (valid) {\n                    if(this.addOrEditTitle==='新增角色') {\n                        console.log('新增');\n                        this.$api.createRole({\n                            name: this.ruleForm.roleName,\n                            remark: this.ruleForm.desc\n                        }).then(res => {\n                            if(res.code==200 || res.code==0) {\n                                this.$message.success(res.msg)\n                                this.addRoleVisible = false\n                                this.queryList()\n                            } else {\n                                this.$message.error(res.msg)\n                            }\n                        })\n                    }else if(this.addOrEditTitle==='编辑角色') {\n                        console.log('编辑');\n                        this.$api.updateRole({\n                            id: this.rowId,\n                            name: this.ruleForm.roleName,\n                            remark: this.ruleForm.desc\n                        }).then(res => {\n                            if(res.code==200 || res.code==0) {\n                                this.$message.success(res.msg)\n                                this.addRoleVisible = false\n                                this.queryList()\n                            } else {\n                                this.$message.error(res.msg)\n                            }\n                        })\n                    }\n                } else {\n                    return false;\n                }\n            });\n        },\n        // 新增用户弹窗  -- 打开\n        addUser(row) {\n            this.rowId = row.id\n            this.addUserVisible = true\n        },\n        // 新增用户弹窗  -- 确定\n        confirmAddUser() {\n            this.addUserVisible = false\n        },\n        // 新增用户弹窗  -- 关闭\n        closeAddUser() {\n            this.addUserVisible = false\n        },\n        // 修改\n        modify(row) {\n            console.log(row);\n            this.rowId = row.id\n            this.addOrEditTitle = '编辑角色'\n            this.addRoleVisible = true\n            this.$nextTick(() => {\n                this.$refs['ruleForm'].resetFields();\n            })\n        },\n        // 关闭popover\n        handleClose(index) {\n            this.$refs[`popover-${index}`].doClose()\n        },\n        // 批量删除\n        batchDelete() {\n            this.batchDeleteVisible = true\n        },\n        // 批量删除提示框确定\n        confirmDelete() {\n            // 调接口  当前选中数据this.selectRows  \n            let temp = []\n            this.selectRows.forEach(item => {\n                temp.push(item.id)\n            })\n            let request = {\n                ids: temp\n            }\n            console.log(request);\n            this.$api.deleteRole(request).then(res => {\n                if(res.code==200 || res.code==0) {\n                    this.batchDeleteVisible = false\n                    this.$message.success(res.msg)\n                    this.queryList()\n                }else {\n                    this.$message.error(res.msg)\n                }\n            })\n        },\n        // 删除  --- 单行\n        delRow(row,index) {\n            this.rowId = row.id\n            console.log(row);\n            let request = {\n                ids: [this.rowId]\n            }\n            console.log(request);\n            // 调接口删除\n            this.$api.deleteRole(request).then(res => {\n                if(res.code==200 || res.code==0) {\n                    this.handleClose(index)\n                    this.$message.success(res.msg)\n                    this.queryList()\n                }else {\n                    this.$message.error(res.msg)\n                }\n            })\n        },\n        //  分页\n        handleCurrentChange(val) {\n            console.log(val);\n            this.currentPage = val\n            this.queryList()\n        }\n    },\n};\n",null]}