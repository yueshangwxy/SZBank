{"remainingRequest":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\dataServicePlatform\\myService.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\dataServicePlatform\\myService.vue","mtime":1654824275286},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { isMiddleAdmin, isSuperAdmin } from \"@/utils/validator\";\r\nexport default {\r\n  name: \"myService\",\r\n  data() {\r\n    return {\r\n      name: \"\",\r\n      oppositePerson: \"\",\r\n      dept: \"\",\r\n      type: \"\",\r\n      serviceType: \"\",\r\n      // 表格\r\n      tableData: [],\r\n      propList: [],\r\n      // 分页\r\n      pageSize: 10,\r\n      currentPage: 1,\r\n      total: 10,\r\n      // 上下线确认弹窗\r\n      confirmDialog: false,\r\n      message: \"\",\r\n      // 当前操作id\r\n      currentOperation: {\r\n        online: 0,\r\n        id: \"\",\r\n      },\r\n      // 部门树\r\n      deptTree: [],\r\n    };\r\n  },\r\n  // beforeRouteLeave(to, from, next) {\r\n  //   if (\r\n  //     to.name === \"editApi\" ||\r\n  //     to.name === \"apiDetail\" ||\r\n  //     to.name === \"docDetail\" ||\r\n  //     to.name === 'applyForApi' ||\r\n  //     to.name === 'applyForDoc' ||\r\n  //     to.name === \"editDoc\"\r\n  //   ) {\r\n  //     this.$store.commit(\"SET_KEEPALIVE\", true);\r\n  //   } else {\r\n  //     this.$store.commit(\"SET_KEEPALIVE\", false);\r\n  //   }\r\n  //   next();\r\n  // },\r\n  created() {\r\n    // this.$store.commit(\"SET_KEEPALIVE\", true);\r\n    this.propList = [\r\n      {\r\n        prop: \"name\",\r\n        label: \"名称\",\r\n      },\r\n      {\r\n        prop: \"description\",\r\n        label: \"描述\",\r\n      },\r\n      {\r\n        prop: \"dept\",\r\n        label: \"所属部门\",\r\n      },\r\n      {\r\n        prop: \"belongUser\",\r\n        label: \"对接人\",\r\n      },\r\n      {\r\n        prop: \"serviceType\",\r\n        label: \"服务类型\",\r\n        type: \"service\",\r\n        render: (row) => {\r\n          let label = row.serviceType === \"1\" ? \"API\" : \"文件\";\r\n          return label;\r\n        },\r\n      },\r\n      {\r\n        prop: \"status\",\r\n        label: \"状态\",\r\n        type: \"tag\",\r\n        tagType: (row) => {\r\n          let type = \"\";\r\n          if (row.status === \"0\") {\r\n            type = \"info\";\r\n          } else if (row.status === \"1\") {\r\n            type = \"warning\";\r\n          } else if (row.status === \"2\") {\r\n            type = \"warning\";\r\n          } else if (row.status === \"3\") {\r\n            type = \"success\";\r\n          } else if (row.status === \"4\") {\r\n            type = \"danger\";\r\n          } else if (row.status === \"5\") {\r\n            type = \"warning\";\r\n          } else if (row.status === \"6\") {\r\n            type = \"warning\";\r\n          } else if (row.status === \"7\") {\r\n            type = \"warning\";\r\n          } else if (row.status === \"8\") {\r\n            type = \"\";\r\n          }\r\n          return type;\r\n        },\r\n        render: (row) => {\r\n          let status = \"\";\r\n          if (row.status === \"0\") {\r\n            status = \"已下线\";\r\n          } else if (row.status === \"1\") {\r\n            status = \"草稿\";\r\n          } else if (row.status === \"2\") {\r\n            status = \"需求已提交\";\r\n          } else if (row.status === \"3\") {\r\n            status = \"需求已通过\";\r\n          } else if (row.status === \"4\") {\r\n            status = \"需求已驳回\";\r\n          } else if (row.status === \"5\") {\r\n            status = \"开发中\";\r\n          } else if (row.status === \"6\") {\r\n            status = \"测试中\";\r\n          } else if (row.status === \"7\") {\r\n            status = \"已完成待上线\";\r\n          } else if (row.status === \"8\") {\r\n            status = \"已上线\";\r\n          }\r\n          return status;\r\n        },\r\n      },\r\n      {\r\n        prop: \"crtUserCode\",\r\n        label: \"创建人\",\r\n      },\r\n      {\r\n        prop: \"createDate\",\r\n        label: \"创建时间\",\r\n      },\r\n    ];\r\n    this.$api.findDeptTree({}).then((res) => {\r\n      this.deptTree = res.data;\r\n    });\r\n  },\r\n  mounted() {\r\n    this.queryList();\r\n  },\r\n  computed: {\r\n    isSuperLogin() {\r\n      return isMiddleAdmin() || isSuperAdmin();\r\n    },\r\n  },\r\n  methods: {\r\n    isMiddleAdmin() {\r\n      return isMiddleAdmin();\r\n    },\r\n    // 查询列表\r\n    queryList() {\r\n      let request = {\r\n        name: this.name, // 名称\r\n        belongUser: this.oppositePerson, // 对接人\r\n        dept: this.dept, // 所属部门\r\n        serviceType: this.serviceType, // 1API 2wenjian\r\n        crtUserCode: \"\", // 创建人\r\n        page: this.currentPage,\r\n        size: this.pageSize,\r\n      };\r\n      this.$api.qryServiceList(request).then((res) => {\r\n        console.log(res);\r\n        this.tableData = res.data.records;\r\n        this.total = res.data.total;\r\n      });\r\n    },\r\n    // jumpApi\r\n    jumpApi() {\r\n      this.$router.push({\r\n        path: \"/dataServicePlatform/applyForApi\",\r\n      });\r\n    },\r\n    // jumpDoc\r\n    jumpDoc() {\r\n      this.$router.push({\r\n        path: \"/dataServicePlatform/applyForDoc\",\r\n      });\r\n    },\r\n    // 查看\r\n    viewDetails(row) {\r\n      if (row.serviceType === \"1\") {\r\n        this.$router.push({\r\n          path: \"/dataServicePlatform/apiDetail\",\r\n          query: {\r\n            id: row.id,\r\n          },\r\n        });\r\n      } else if (row.serviceType === \"2\") {\r\n        this.$router.push({\r\n          path: \"/dataServicePlatform/docDetail\",\r\n          query: {\r\n            id: row.id,\r\n          },\r\n        });\r\n      }\r\n    },\r\n    /**\r\n     * 普通用户只能在草稿状态下编辑\r\n     */\r\n    hasEditRole(row) {\r\n      if (!this.isSuperLogin && row.status !== \"1\") {\r\n        return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    },\r\n    // 编辑\r\n    edit(row) {\r\n      if (row.serviceType === \"1\") {\r\n        this.$router.push({\r\n          path: \"/dataServicePlatform/editApi\",\r\n          query: {\r\n            id: row.id,\r\n          },\r\n        });\r\n      } else if (row.serviceType === \"2\") {\r\n        this.$router.push({\r\n          path: \"/dataServicePlatform/editDoc\",\r\n          query: {\r\n            id: row.id,\r\n          },\r\n        });\r\n      }\r\n    },\r\n    // 上线\r\n    online(row) {\r\n      console.log(row);\r\n      this.message = \"您要上线此条服务吗？\";\r\n      this.confirmDialog = true;\r\n      this.currentOperation = {\r\n        online: 0,\r\n        id: row.id,\r\n      };\r\n    },\r\n    // 下线\r\n    offline(row) {\r\n      console.log(row);\r\n      this.message = \"您要下线此条服务吗？\";\r\n      this.confirmDialog = true;\r\n      this.currentOperation = {\r\n        online: 1,\r\n        id: row.id,\r\n      };\r\n    },\r\n    // 确认上下线\r\n    confrim() {\r\n      this.confirmDialog = false;\r\n      console.log(this.currentOperation, \"上下线\");\r\n      // 调接口\r\n      if (this.currentOperation.online === 0) {\r\n        this.$api\r\n          .serviceOnline({\r\n            id: this.currentOperation.id,\r\n          })\r\n          .then((res) => {\r\n            console.log(res, \"上线\");\r\n            if (res.code == 0 || res.code == 200) {\r\n              this.$message.success(res.msg);\r\n              this.queryList();\r\n            } else {\r\n              this.$message.error(res.msg);\r\n            }\r\n          });\r\n      } else {\r\n        this.$api\r\n          .serviceOffline({\r\n            id: this.currentOperation.id,\r\n          })\r\n          .then((res) => {\r\n            console.log(res, \"下线\");\r\n            if (res.code == 0 || res.code == 200) {\r\n              this.$message.success(res.msg);\r\n              this.queryList();\r\n            } else {\r\n              this.$message.error(res.msg);\r\n            }\r\n          });\r\n      }\r\n    },\r\n    // 分页\r\n    handleCurrentChange(val) {\r\n      console.log(`当前页: ${val}`);\r\n      this.currentPage = val;\r\n      this.queryList();\r\n    },\r\n  },\r\n};\r\n",null]}