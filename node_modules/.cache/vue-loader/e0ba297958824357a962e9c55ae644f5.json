{"remainingRequest":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\resultCheck.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\resultCheck.vue","mtime":1646010435150},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\work\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {getCheckList, saveCheckData, deleteCheckData, getResultDepts} from '@/api/indicators/indResultSubscribe'\r\nimport qs from 'qs'\r\nimport CRUD, {presenter, header, form, crud} from '@crud/crud'\r\nimport rrOperation from '@crud/RR.operation'\r\nimport crudOperation from '@crud/CRUD.operation'\r\nimport pagination from '@crud/Pagination'\r\nimport crudIndAtomInfo, {\r\n  getColumnByTabel,\r\n  getDimensions,\r\n  getGenAndDerivedInd,\r\n  getAllInds,\r\n  getGenInd,\r\n  getTablesById, bizNameIsContract, approveDetailByBusinessKey, abolish, startProcess, delAtom, getHisList\r\n} from '@/api/indicators/indAtomInfo'\r\nimport Treeselect from '@riophae/vue-treeselect'\r\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\r\nimport moment from \"moment\";\r\n\r\nString.prototype.replaceAll = function (s1, s2) {\r\n  return this.replace(new RegExp(s1, \"gm\"), s2);\r\n}\r\nconst defaultCrud = CRUD({\r\n  title: '指标加工结果校验',\r\n  url: 'v1/indicators/result/atom/getCheckList',\r\n  loading: true,\r\n  crudMethod: {getCheckList}\r\n})\r\n\r\nconst defaultForm = {\r\n  name: null,\r\n  checkData: null\r\n}\r\n\r\n\r\nexport default {\r\n  name: \"resultCheck\",\r\n  components: {pagination, crudOperation, rrOperation, Treeselect},\r\n  mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\r\n  dicts: ['IND_CURRENCY', 'IE_FREQUENCY'],\r\n  data() {\r\n    return {\r\n      dafaultDate: new Date(), // 默认时间\r\n      permission: {\r\n        add: ['admin', 'resultCheck:add'],\r\n        edit: ['admin', 'resultCheck:edit'],\r\n        del: ['admin', 'resultCheck:del']\r\n      },\r\n      activeName: 'first',\r\n      showDetailDialog: false,\r\n      detailDialogTitle: '新增|编辑',\r\n      firstDisabled: false,\r\n      secondDisabled: false,\r\n      resultDepts: [],\r\n\r\n      checkForm: {formulaOne: '', formulaOneExp: '', formulaTwo: '', formulaTwoExp: '', name: '', code: ''},\r\n      showIndDefRule: false,\r\n      value: [],\r\n      valueLable: [],\r\n      transferData: [],\r\n      renderFunc(h, option) {\r\n        return <span>{option.label}</span>;\r\n      },\r\n      genAndDerivedIndArr: [],\r\n      compareSymbolArr: [\r\n        {id: \"0\", value: \">\"},\r\n        {id: \"1\", value: \">=\"},\r\n        {id: \"2\", value: \"<\"},\r\n        {id: \"3\", value: \"<=\"},\r\n        {id: \"4\", value: \"=\"},\r\n        {id: \"5\", value: \"≠\"}\r\n      ],\r\n\r\n      showIndDefRuleTwo: false,\r\n      valueTwo: [],\r\n      valueLableTwo: [],\r\n\r\n      valueFix: [],\r\n      valueLableFix: [],\r\n      showIndDefRuleFix: false,\r\n\r\n      /*fixRules: {\r\n          code: [\r\n              { required: true, message: '指标不能为空', trigger: 'blur' }\r\n          ],\r\n          fixOrgCode: [\r\n              { required: true, message: '机构不能为空', trigger: 'blur' }\r\n          ],\r\n          fixCurrency: [\r\n              { required: true, message: '币种不能为空', trigger:  'blur' }\r\n          ],\r\n          fixIndFrequency: [\r\n              { required: true, message: '指标频率不能为空', trigger:  'blur' }\r\n          ],\r\n          compareSymbol: [\r\n              { required: true, message: '比较符不能为空', trigger: 'blur'}\r\n          ],\r\n          fixVal: [\r\n              { required: true, message: '定量值是数值且不能为空', trigger: 'blur' }\r\n          ]\r\n      },*/\r\n      //定量校验  是否显示错误信息\r\n      fixRuleTipShow: {\r\n        code: false,\r\n        fixOrgCode: false,\r\n        fixCurrency: false,\r\n        fixIndFrequency: false,\r\n        compareSymbol: false,\r\n        fixVal: false,\r\n      },\r\n\r\n      //是否显示错误信息\r\n      ruleTipShow: {\r\n        formulaOne: false,\r\n        formulaOrgCode: false,\r\n        formulaCurrency: false,\r\n        formulaIndFrequency: false,\r\n        formulaCompareSymbol: false,\r\n        formulaTwo: false,\r\n      },\r\n      formulaRules: {\r\n        formulaOne: [\r\n          {required: true, message: '计算公式不能为空', trigger: 'blur'}\r\n        ],\r\n        formulaOrgCode: [\r\n          {required: true, message: '机构不能为空', trigger: 'blur'}\r\n        ],\r\n        formulaCurrency: [\r\n          {required: true, message: '币种不能为空', trigger: 'blur'}\r\n        ],\r\n        formulaIndFrequency: [\r\n          {required: true, message: '指标频率不能为空', trigger: 'blur'}\r\n        ],\r\n        formulaCompareSymbol: [\r\n          {required: true, message: '比较符不能为空', trigger: 'blur'}\r\n        ],\r\n        formulaTwo: [\r\n          {required: true, message: '计算公式不能为空', trigger: 'blur'}\r\n        ]\r\n      }\r\n\r\n\r\n    }\r\n  },\r\n  created() {\r\n    //this.crud.optShow.del=false\r\n    //this.crud.optShow.edit=false\r\n    //this.initDimInfos()\r\n    //this.initDimValuesChildren()\r\n    // this.initDimValues()\r\n    //this.initClassifications()\r\n    this.initGenAndDerivedInd()\r\n    //this.initIndFirstType()\r\n    //this.getDepts();\r\n    this.getResultDepts();\r\n    this.resetQuery()\r\n  },\r\n  methods: {\r\n    resetQuery() {\r\n      this.crud.resetQuery(false);\r\n      this.crud.refresh()\r\n    },\r\n    [CRUD.HOOK.beforeRefresh]() {\r\n      this.crud.optShow.del = true\r\n      this.crud.optShow.add = true\r\n      this.crud.optShow.edit = true\r\n      return true\r\n    },\r\n\r\n\r\n    [CRUD.HOOK.beforeToAdd]() {\r\n      this.showDetailDialog = true;\r\n\r\n      this.activeName = 'first'\r\n      this.firstDisabled = false;\r\n      this.secondDisabled = false;\r\n\r\n    },\r\n    [CRUD.HOOK.beforeToEdit]() {\r\n\r\n      this.$nextTick(() => {\r\n        this.$refs.fixForm.clearValidate();\r\n      })\r\n      /*this.$nextTick(() => {\r\n          this.$refs.formulaForm.clearValidate();\r\n      })*/\r\n\r\n\r\n      this.showDetailDialog = true;\r\n      this.valueLable = [];\r\n      this.valueLableTwo = [];\r\n      if (this.crud.selections[0].check_type == '0') {\r\n        //定量\r\n        this.activeName = 'first'\r\n        this.firstDisabled = false;\r\n        this.secondDisabled = true;\r\n\r\n        this.checkForm.checkType = this.crud.selections[0].check_type\r\n        this.checkForm.id = this.crud.selections[0].id\r\n        this.checkForm.code = this.crud.selections[0].ie_code\r\n        this.checkForm.name = this.crud.selections[0].ie_name\r\n        this.checkForm.compareSymbol = this.crud.selections[0].compare_symbol\r\n        this.checkForm.fixVal = this.crud.selections[0].fix_val\r\n\r\n        this.checkForm.fixCurrency = this.crud.selections[0].ind_currency\r\n        this.checkForm.fixOrgCode = this.crud.selections[0].ind_dept_code\r\n        this.checkForm.fixIndFrequency = this.crud.selections[0].ind_frequency\r\n\r\n      } else if (this.crud.selections[0].check_type == '1') {\r\n        this.activeName = 'second'\r\n        this.firstDisabled = true;\r\n        this.secondDisabled = false;\r\n\r\n        this.checkForm.checkType = this.crud.selections[0].check_type\r\n        this.checkForm.id = this.crud.selections[0].id\r\n        //this.checkForm.code = this.crud.selections[0].ie_code\r\n        this.checkForm.formulaOne = this.crud.selections[0].ie_name\r\n        this.checkForm.formulaCompareSymbol = this.crud.selections[0].compare_symbol\r\n        this.checkForm.formulaTwo = this.crud.selections[0].fix_val\r\n\r\n        this.checkForm.formulaOneExp = this.crud.selections[0].formula_one_exp\r\n        this.checkForm.formulaTwoExp = this.crud.selections[0].formula_two_exp\r\n\r\n        this.checkForm.formulaCurrency = this.crud.selections[0].ind_currency\r\n        this.checkForm.formulaOrgCode = this.crud.selections[0].ind_dept_code\r\n        this.checkForm.formulaIndFrequency = this.crud.selections[0].ind_frequency\r\n      }\r\n    },\r\n    [CRUD.HOOK.beforeDelete]() {\r\n      var selectIds = \"\";\r\n      for (let items of this.crud.selections) {\r\n        if (items.id != '') {\r\n          selectIds += items.id + \",\";\r\n        }\r\n      }\r\n\r\n      deleteCheckData(qs.stringify({ids: selectIds})).then(res => {\r\n        if (res.code == '0') {\r\n          this.$message({\r\n            type: 'success',\r\n            message: '操作成功 '\r\n          })\r\n        }\r\n        this.crud.refresh();\r\n      })\r\n\r\n      return false;\r\n    },\r\n    closeApproveDetailDialog() {\r\n      this.showDetailDialog = false\r\n      this.activeName = 'first'\r\n      this.checkForm = {}\r\n\r\n      this.ruleTipShow = {\r\n        formulaOne: false,\r\n        formulaOrgCode: false,\r\n        formulaCurrency: false,\r\n        formulaIndFrequency: false,\r\n        formulaCompareSymbol: false,\r\n        formulaTwo: false,\r\n      }\r\n\r\n      this.fixRuleTipShow = {\r\n        code: false,\r\n        fixOrgCode: false,\r\n        fixCurrency: false,\r\n        fixIndFrequency: false,\r\n        compareSymbol: false,\r\n        fixVal: false,\r\n      }\r\n\r\n    },\r\n    handleClick(tab, event) {\r\n      console.log(\"=====\" + tab, event);\r\n    },\r\n    saveCheckForm() {\r\n      var checkParam = {};\r\n      checkParam.id = this.checkForm.id\r\n      if (this.activeName == 'first') {\r\n\r\n        checkParam.code = this.checkForm.code\r\n        checkParam.name = this.checkForm.name\r\n        checkParam.compareSymbol = this.checkForm.compareSymbol\r\n        checkParam.fixVal = this.checkForm.fixVal\r\n        checkParam.checkType = '0'\r\n\r\n        checkParam.indDeptCode = this.checkForm.fixOrgCode\r\n        checkParam.indCurrency = this.checkForm.fixCurrency\r\n        checkParam.indFrequency = this.checkForm.fixIndFrequency\r\n      } else {\r\n        checkParam.formulaOne = this.checkForm.formulaOne\r\n        checkParam.formulaOneExp = this.checkForm.formulaOneExp\r\n        checkParam.formulaTwo = this.checkForm.formulaTwo\r\n        checkParam.formulaTwoExp = this.checkForm.formulaTwoExp\r\n        checkParam.formulaCompareSymbol = this.checkForm.formulaCompareSymbol\r\n        checkParam.checkType = '1'\r\n\r\n        checkParam.indDeptCode = this.checkForm.formulaOrgCode\r\n        checkParam.indCurrency = this.checkForm.formulaCurrency\r\n        checkParam.indFrequency = this.checkForm.formulaIndFrequency\r\n      }\r\n\r\n      if (this.activeName == 'first') {\r\n\r\n        this.fixRuleTipShow = {\r\n          code: false,\r\n          fixOrgCode: false,\r\n          fixCurrency: false,\r\n          fixIndFrequency: false,\r\n          compareSymbol: false,\r\n          fixVal: false,\r\n        }\r\n\r\n        let flag = true;//校验是否通过\r\n        if (!checkParam.code) {\r\n          this.fixRuleTipShow.code = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.indDeptCode) {\r\n          this.fixRuleTipShow.fixOrgCode = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.indCurrency) {\r\n          this.fixRuleTipShow.fixCurrency = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.indFrequency) {\r\n          this.fixRuleTipShow.fixIndFrequency = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.compareSymbol) {\r\n          this.fixRuleTipShow.compareSymbol = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.fixVal) {\r\n          this.fixRuleTipShow.fixVal = true;\r\n          flag = false;\r\n        }\r\n\r\n        if (flag) {\r\n          //调用接口\r\n          saveCheckData(qs.stringify(checkParam)).then(res => {\r\n            if (res.code == '0') {\r\n              this.$message({\r\n                type: 'success',\r\n                message: '操作成功 '\r\n              })\r\n            } else {\r\n              this.$message({\r\n                type: 'error',\r\n                message: '操作失败 ' + res.msg\r\n              })\r\n            }\r\n            this.closeApproveDetailDialog();\r\n            this.crud.refresh()\r\n          })\r\n        } else {\r\n          return;\r\n        }\r\n      } else {\r\n        console.log(\"checkParam\", checkParam)\r\n\r\n        this.ruleTipShow = {\r\n          formulaOne: false,\r\n          formulaOrgCode: false,\r\n          formulaCurrency: false,\r\n          formulaIndFrequency: false,\r\n          formulaCompareSymbol: false,\r\n          formulaTwo: false,\r\n        }\r\n\r\n        let flag = true;//校验是否通过\r\n        if (!checkParam.formulaOne) {\r\n          this.ruleTipShow.formulaOne = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.indDeptCode) {\r\n          this.ruleTipShow.formulaOrgCode = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.indCurrency) {\r\n          this.ruleTipShow.formulaCurrency = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.indFrequency) {\r\n          this.ruleTipShow.formulaIndFrequency = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.formulaCompareSymbol) {\r\n          this.ruleTipShow.formulaCompareSymbol = true;\r\n          flag = false;\r\n        }\r\n        if (!checkParam.formulaTwo) {\r\n          this.ruleTipShow.formulaTwo = true;\r\n          flag = false;\r\n        }\r\n\r\n        if (flag) {\r\n\r\n          //合规行校验\r\n          var formulaFlag = this.checkFormulaExp(checkParam.formulaOne);\r\n\r\n          if (!formulaFlag) {\r\n            this.$message({\r\n              type: 'error',\r\n              message: '计算公式1配置错误'\r\n            })\r\n            return;\r\n          }\r\n\r\n          checkParam.formulaOneExp = this.setFormulaExp(this.checkForm.formulaOne);\r\n          if (checkParam.formulaOneExp != null) {\r\n            if (checkParam.formulaOneExp.indexOf(\"[\") >= 0 || checkParam.formulaOneExp.indexOf(\"]\") >= 0) {\r\n              this.$message({\r\n                type: 'error',\r\n                message: '计算公式1指标名称不能修改'\r\n              })\r\n              return;\r\n            }\r\n            checkParam.formulaOneExp = checkParam.formulaOneExp.replaceAll(\"#\", \"[\");\r\n            checkParam.formulaOneExp = checkParam.formulaOneExp.replaceAll(\";\", \"]\");\r\n          }\r\n\r\n\r\n          //计算公式2\r\n\r\n          var formulaFlagTwo = this.checkFormulaExp(checkParam.formulaTwo);\r\n\r\n          if (!formulaFlagTwo) {\r\n            this.$message({\r\n              type: 'error',\r\n              message: '计算公式2配置错误'\r\n            })\r\n            return;\r\n          }\r\n\r\n          checkParam.formulaTwoExp = this.setFormulaExp(this.checkForm.formulaTwo);\r\n          if (checkParam.formulaTwoExp != null) {\r\n            if (checkParam.formulaTwoExp.indexOf(\"[\") >= 0 || checkParam.formulaTwoExp.indexOf(\"]\") >= 0) {\r\n              this.$message({\r\n                type: 'error',\r\n                message: '计算公式2指标名称不能修改'\r\n              })\r\n              return;\r\n            }\r\n            checkParam.formulaTwoExp = checkParam.formulaTwoExp.replaceAll(\"#\", \"[\");\r\n            checkParam.formulaTwoExp = checkParam.formulaTwoExp.replaceAll(\";\", \"]\");\r\n          }\r\n\r\n          //调用接口\r\n          saveCheckData(qs.stringify(checkParam)).then(res => {\r\n            if (res.code == '0') {\r\n              this.$message({\r\n                type: 'success',\r\n                message: '操作成功 '\r\n              })\r\n            } else {\r\n              this.$message({\r\n                type: 'error',\r\n                message: '操作失败 ' + res.msg\r\n              })\r\n            }\r\n            this.closeApproveDetailDialog();\r\n            this.crud.refresh()\r\n          })\r\n        } else {\r\n          return;\r\n        }\r\n      }\r\n    },\r\n    onInput() {\r\n      this.$forceUpdate();\r\n    },\r\n    clearFormulaOne() {\r\n      this.checkForm.formulaOne = '';\r\n      this.checkForm.formulaOneExp = '';\r\n      this.$forceUpdate()\r\n    },\r\n    indDefRulePlus() {\r\n      if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n        this.checkForm.formulaOne = ''\r\n      }\r\n      if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n        this.checkForm.formulaOneExp = ''\r\n      }\r\n\r\n      this.checkForm.formulaOne += ' + '\r\n      //this.checkForm.formulaOneExp += ' + '\r\n      this.$forceUpdate()\r\n    },\r\n    // 指标规则-号按钮\r\n    indDefRuleSubtraction() {\r\n      if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n        this.checkForm.formulaOne = ''\r\n      }\r\n      if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n        this.checkForm.formulaOneExp = ''\r\n      }\r\n      this.checkForm.formulaOne += ' - '\r\n      // this.checkForm.formulaOneExp += ' - '\r\n      this.$forceUpdate()\r\n    },\r\n    // 指标规则×号按钮\r\n    indDefRuleMultiplication() {\r\n      if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n        this.checkForm.formulaOne = ''\r\n      }\r\n      if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n        this.checkForm.formulaOneExp = ''\r\n      }\r\n      this.checkForm.formulaOne += ' * '\r\n      //  this.checkForm.formulaOneExp += ' * '\r\n      this.$forceUpdate()\r\n    },\r\n    // 指标规则/号按钮\r\n    indDefRuleDivision() {\r\n      if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n        this.checkForm.formulaOne = ''\r\n      }\r\n      if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n        this.checkForm.formulaOneExp = ''\r\n      }\r\n      this.checkForm.formulaOne += ' / '\r\n      //  this.checkForm.formulaOneExp += ' / '\r\n      this.$forceUpdate()\r\n    },\r\n    indDefRuleLP() {\r\n      if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n        this.checkForm.formulaOne = ''\r\n      }\r\n      if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n        this.checkForm.formulaOneExp = ''\r\n      }\r\n      this.checkForm.formulaOne += ' ( '\r\n      //    this.checkForm.formulaOneExp += ' ( '\r\n      this.$forceUpdate()\r\n    },\r\n    indDefRuleRP() {\r\n      if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n        this.checkForm.formulaOne = ''\r\n      }\r\n      if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n        this.checkForm.formulaOneExp = ''\r\n      }\r\n      this.checkForm.formulaOne += ' ) '\r\n      //    this.checkForm.formulaOneExp += ' ) '\r\n      this.$forceUpdate()\r\n    },\r\n    // 衍生指标编辑指标口径规则\r\n    showIndDefRuleDialog() {\r\n      // this.formulaOneExp = ''\r\n      this.value = []\r\n      this.showIndDefRule = true\r\n    },\r\n    // 关闭衍生指标编辑指标口径规则\r\n    closeIndDefRuleDialog() {\r\n      this.showIndDefRule = false\r\n    },\r\n    handleChange(value, direction, movedKeys) {\r\n      // valueLable\r\n      //this.transferData[0].label\r\n      this.valueLable = [];\r\n      this.value.map(item => {\r\n        var targetObj = this.transferData.filter(function (itemObj) {\r\n          return itemObj.key == item;\r\n        })\r\n        this.valueLable.push(targetObj[0].label)\r\n      })\r\n\r\n    },\r\n    initGenAndDerivedInd() {\r\n      getAllInds().then(data => {\r\n        this.genAndDerivedIndArr = data.data\r\n        for (let i = 0; i < this.genAndDerivedIndArr.length; i++) {\r\n          this.transferData.push({key: this.genAndDerivedIndArr[i].bizCode, label: this.genAndDerivedIndArr[i].bizName})\r\n        }\r\n      })\r\n    },\r\n    // 选择指标进行规则拼接\r\n    selectInd() {\r\n      /*if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n          this.checkForm.formulaOne = '';\r\n      }*/\r\n\r\n\r\n      /*if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n          this.checkForm.formulaOneExp = '';\r\n      }*/\r\n\r\n\r\n      /*if (this.valueLable.length > 0 ) {\r\n          this.checkForm.formulaOne += ' [' + this.valueLable[0] + '] '\r\n      }*/\r\n\r\n      if (this.checkForm.formulaOne == undefined || this.checkForm.formulaOne == null) {\r\n        this.checkForm.formulaOne = ''\r\n      }\r\n      if (this.checkForm.formulaOneExp == undefined || this.checkForm.formulaOneExp == null) {\r\n        this.checkForm.formulaOneExp = ''\r\n      }\r\n\r\n      if (this.value.length > 0) {\r\n        for (var i = 0; i < this.value.length; i++) {\r\n          var name = ' [' + this.valueLable[i] + '] ';\r\n          var code = ' [' + this.value[i] + '] ';\r\n          this.checkForm.formulaOne += name\r\n        }\r\n        //this.checkForm.formulaOneExp += ' [' + this.value[0] + '] '\r\n      }\r\n\r\n      this.showIndDefRule = false\r\n    },\r\n\r\n\r\n    clearFormulaTwo() {\r\n      this.checkForm.formulaTwo = '';\r\n      this.checkForm.formulaTwoExp = '';\r\n      this.$forceUpdate()\r\n    },\r\n    indDefRulePlusTwo() {\r\n      if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\r\n        this.checkForm.formulaTwo = ''\r\n      }\r\n      if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\r\n        this.checkForm.formulaTwoExp = ''\r\n      }\r\n\r\n      this.checkForm.formulaTwo += ' + '\r\n      this.checkForm.formulaTwoExp += ' + '\r\n      this.$forceUpdate()\r\n    },\r\n    // 指标规则-号按钮\r\n    indDefRuleSubtractionTwo() {\r\n      if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\r\n        this.checkForm.formulaTwo = ''\r\n      }\r\n      if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\r\n        this.checkForm.formulaTwoExp = ''\r\n      }\r\n      this.checkForm.formulaTwo += ' - '\r\n      this.checkForm.formulaTwoExp += ' - '\r\n      this.$forceUpdate()\r\n    },\r\n    // 指标规则×号按钮\r\n    indDefRuleMultiplicationTwo() {\r\n      if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\r\n        this.checkForm.formulaTwo = ''\r\n      }\r\n      if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\r\n        this.checkForm.formulaTwoExp = ''\r\n      }\r\n      this.checkForm.formulaTwo += ' * '\r\n      this.checkForm.formulaTwoExp += ' * '\r\n      this.$forceUpdate()\r\n    },\r\n    // 指标规则/号按钮\r\n    indDefRuleDivisionTwo() {\r\n      if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\r\n        this.checkForm.formulaTwo = ''\r\n      }\r\n      if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\r\n        this.checkForm.formulaTwoExp = ''\r\n      }\r\n      this.checkForm.formulaTwo += ' / '\r\n      this.checkForm.formulaTwoExp += ' / '\r\n      this.$forceUpdate()\r\n    },\r\n    indDefRuleLPTwo() {\r\n      if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\r\n        this.checkForm.formulaTwo = ''\r\n      }\r\n      if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\r\n        this.checkForm.formulaTwoExp = ''\r\n      }\r\n      this.checkForm.formulaTwo += ' ( '\r\n      this.checkForm.formulaTwoExp += ' ( '\r\n      this.$forceUpdate()\r\n    },\r\n    indDefRuleRPTwo() {\r\n      if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\r\n        this.checkForm.formulaTwo = ''\r\n      }\r\n      if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\r\n        this.checkForm.formulaTwoExp = ''\r\n      }\r\n      this.checkForm.formulaTwo += ' ) '\r\n      this.checkForm.formulaTwoExp += ' ) '\r\n      this.$forceUpdate()\r\n    },\r\n    // 衍生指标编辑指标口径规则\r\n    showIndDefRuleDialogTwo() {\r\n      // this.formulaOneExp = ''\r\n      this.valueTwo = []\r\n      this.showIndDefRuleTwo = true\r\n    },\r\n    // 关闭衍生指标编辑指标口径规则\r\n    closeIndDefRuleDialogTwo() {\r\n      this.showIndDefRuleTwo = false\r\n    },\r\n    handleChangeTwo(value, direction, movedKeys) {\r\n      // valueLable\r\n      //this.transferData[0].label\r\n      this.valueLableTwo = [];\r\n      this.valueTwo.map(item => {\r\n        var targetObj = this.transferData.filter(function (itemObj) {\r\n          return itemObj.key == item;\r\n        })\r\n        this.valueLableTwo.push(targetObj[0].label)\r\n      })\r\n\r\n    },\r\n    // 选择指标进行规则拼接\r\n    selectIndTwo() {\r\n      if (this.checkForm.formulaTwo == undefined || this.checkForm.formulaTwo == null) {\r\n        this.checkForm.formulaTwo = ''\r\n      }\r\n      if (this.checkForm.formulaTwoExp == undefined || this.checkForm.formulaTwoExp == null) {\r\n        this.checkForm.formulaTwoExp = ''\r\n      }\r\n\r\n      if (this.valueTwo.length > 0) {\r\n        for (var i = 0; i < this.valueTwo.length; i++) {\r\n          var name = ' [' + this.valueLableTwo[i] + '] ';\r\n          var code = ' [' + this.valueTwo[i] + '] ';\r\n          this.checkForm.formulaTwo += name\r\n        }\r\n      }\r\n\r\n      this.showIndDefRuleTwo = false\r\n    },\r\n    // 衍生指标编辑指标口径规则\r\n    showIndDefRuleDialogFix() {\r\n      // this.formulaOneExp = ''\r\n      this.valueFix = []\r\n      this.showIndDefRuleFix = true\r\n    },\r\n    closeIndDefRuleDialogFix() {\r\n      this.showIndDefRuleFix = false\r\n    },\r\n    handleChangeFix(value, direction, movedKeys) {\r\n      //this.transferData[0].label\r\n      this.valueLableFix = [];\r\n      this.valueFix.map(item => {\r\n        var targetObj = this.transferData.filter(function (itemObj) {\r\n          return itemObj.key == item;\r\n        })\r\n        this.valueLableFix.push(targetObj[0].label)\r\n      })\r\n\r\n    },\r\n    // 选择指标进行规则拼接\r\n    selectIndFix() {\r\n      if (this.valueFix.length > 0) {\r\n        this.checkForm.name = ' [' + this.valueLableFix[0] + '] '\r\n        this.checkForm.code = this.valueFix[0]\r\n      }\r\n\r\n      this.showIndDefRuleFix = false\r\n    },\r\n    selectFixInd(id) {\r\n      var targetObj = this.transferData.filter(function (itemObj) {\r\n        return itemObj.key == id;\r\n      })\r\n      this.checkForm.name = targetObj[0].label;\r\n    },\r\n    getResultDepts() {\r\n      getResultDepts().then(res => {\r\n        this.resultDepts = res.content\r\n      })\r\n    },\r\n    checkFormulaExp(formulaStr) {\r\n      //公式前端校验\r\n      var formulaTmp = formulaStr.replaceAll(\" \", \"\");\r\n      do {\r\n        if (formulaTmp.lastIndexOf(\"]\") < (formulaTmp.length - 1)) {\r\n          var suf = formulaTmp.charAt(formulaTmp.lastIndexOf(\"]\") + 1);\r\n          if (suf != '+' && suf != '-' && suf != '*' && suf != '/' && suf != ')') {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        if (formulaTmp.lastIndexOf(\"[\") > 0) {\r\n          var pre = formulaTmp.charAt(formulaTmp.lastIndexOf(\"[\") - 1);\r\n          if (pre != '+' && pre != '-' && pre != '*' && pre != '/' && pre != '(') {\r\n            return false;\r\n          }\r\n        }\r\n\r\n        formulaTmp = formulaTmp.replace(formulaTmp.substring(formulaTmp.lastIndexOf(\"[\"), formulaTmp.lastIndexOf(\"]\") + 1), \"1\")\r\n\r\n      } while (formulaTmp.lastIndexOf(\"]\") > 0);\r\n\r\n      return true;\r\n\r\n    },\r\n    setFormulaExp(formulaStr) {\r\n      var formulaExp = formulaStr;\r\n      do {\r\n        var pre = formulaExp.lastIndexOf(\"[\");\r\n        var suf = formulaExp.lastIndexOf(\"]\");\r\n\r\n        //指标名称\r\n        var indName = formulaExp.substring(pre, suf + 1);\r\n\r\n        var innerIndName = formulaExp.substring(pre +1 , suf);\r\n        var indCode = '';\r\n        //指标编码\r\n        var targetObj = this.transferData.filter(function (itemObj) {\r\n          if (innerIndName == itemObj.label) {\r\n            return itemObj;\r\n          }\r\n        })\r\n        if (targetObj[0] == null) {\r\n          return '[]';\r\n        }\r\n        indCode = targetObj[0].key;\r\n        formulaExp = formulaExp.replace(indName, '#' + indCode + ';')\r\n      } while (formulaExp.lastIndexOf(\"]\") > 0);\r\n      return formulaExp;\r\n    },\r\n    changeDate(val) {\r\n      this.crud.query.checkData = val;\r\n    }\r\n\r\n\r\n  }\r\n\r\n\r\n}\r\n",null]}