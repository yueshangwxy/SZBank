{"remainingRequest":"D:\\code\\DataAssetPlatform\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform\\Pncui-Indicator\\src\\views\\indicators\\workflow\\waitApprove.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform\\Pncui-Indicator\\src\\views\\indicators\\workflow\\waitApprove.vue","mtime":1647917138785},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":1647917137429}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {approveDetail, completeTask} from '@/api/workflow/applyProcess'\r\nimport qs from 'qs'\r\nimport CRUD, {presenter, header, form, crud} from '@crud/crud'\r\nimport rrOperation from '@crud/RR.operation'\r\nimport crudOperation from '@crud/CRUD.operation'\r\nimport pagination from '@crud/Pagination'\r\nimport {getDepts} from '@/utils/system'\r\nimport Treeselect from '@riophae/vue-treeselect'\r\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css';\r\nimport {getDimensions, getAtomListByIds, getDimListByIeIds, getAtomListByVerifyNo} from '@/api/indicators/indAtomInfo'\r\nimport {getAllSource, getDimInfo} from '@/api/indicators/indIndicatorInfo'\r\nimport atomPage from '../indicator/atom/atomPage'\r\nimport $ from 'jquery';\r\n// crud交由presenter持有\r\nconst defaultCrud = CRUD({\r\n  title: '待我审批',\r\n  url: 'workflow/myTask/waitApprove',\r\n  crudMethod: {approveDetail}\r\n})\r\n\r\nconst defaultForm = {\r\n  userName: null,\r\n  name: null,\r\n  deptCode: null,\r\n  periodDateInterval: null\r\n}\r\n\r\nexport default {\r\n  name: \"waitApprove\",\r\n\r\n  components: {pagination, crudOperation, rrOperation, Treeselect, atomPage},\r\n  mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\r\n  dicts: ['IE_PROP', 'IND_DEPLOY_STATUS', 'IND_VERIFY_STATUS'],\r\n  data() {\r\n    return {\r\n      showApproveDetailDialog: false,\r\n      detailDialogTitle: '审批链路',\r\n      detailData: [],\r\n\r\n      statusDesc: '审批中',\r\n      permission: {\r\n        startUsing: ['admin', 'waitApprove:approveDetail']\r\n      },\r\n\r\n      depts: [], //机构树\r\n      pickerMinDate: \"\", //第一次选中的时间\r\n      //pickerMaxDate : \"\", //第二次选中的时间\r\n      pickerOptions: {\r\n        onPick: obj => {\r\n          this.pickerMinDate = new Date(obj.minDate).getTime();\r\n          //console.log(\"times===>,\" + this.pickerTimes + \", pickerMinDate==>\" + this.pickerMinDate)\r\n          this.pickerMaxDate = new Date(obj.maxDate).getTime();\r\n        },\r\n        disabledDate: time => {\r\n          if (this.pickerMinDate) {\r\n            const day1 = 366 * 24 * 3600 * 1000;\r\n            let maxTime = this.pickerMinDate + day1;\r\n            let minTime = this.pickerMinDate - day1;\r\n            return time.getTime() > maxTime || time.getTime() < minTime;\r\n          }\r\n        }\r\n      },\r\n\r\n      //审批详情组建\r\n      formDialog: false,\r\n      approveTitle: '审批',\r\n      tabData: [],\r\n      dimData: []\r\n\r\n    }\r\n  },\r\n  created() {\r\n    this.resetQuery()\r\n  },\r\n  mounted() {\r\n    this.getDepts();\r\n    //this.defaultCrud.refresh();\r\n    /*$(\"#atomTabs\").click(function () {\r\n      this.getAtomListByIds();\r\n    });*/\r\n\r\n\r\n  },\r\n  methods: {\r\n    resetQuery() {\r\n      this.crud.resetQuery(false);\r\n      this.crud.refresh()\r\n    },\r\n    // 获取数据前设置好接口地址\r\n    [CRUD.HOOK.beforeRefresh]() {\r\n      return true\r\n    },\r\n    showDetail(row) {\r\n      approveDetail(qs.stringify({originalInstId: row.ORIGINAL_INST_ID})).then(res => {\r\n        //打开审批链路详情\r\n        this.showApproveDetailDialog = true\r\n        this.detailData = res.data\r\n      })\r\n    },\r\n\r\n    closeApproveDetailDialog() {\r\n      this.showApproveDetailDialog = false\r\n    },\r\n\r\n    getDepts() {\r\n      getDepts({enabled: true}).then(res => {\r\n        this.depts = res.content\r\n      })\r\n    },\r\n\r\n    //审批\r\n    showApprove(row) {\r\n      this.formDialog = true\r\n      this.form.taskId = row.TASK_ID\r\n      this.form.originalInstId = row.ORIGINAL_INST_ID\r\n      this.form.name = row.NAME\r\n      this.form.deptName = row.DEPT_NAME\r\n      this.form.nickName = row.NICK_NAME\r\n      this.form.crtDate = row.CRT_DATE\r\n      this.form.status = '审批中'\r\n      this.form.businessKey = row.BUSINESS_KEY\r\n      //this.getAtomListByIds();\r\n      this.getAtomListByVerifyNo();\r\n      this.getDimListByIeIds();\r\n      //this.form.apprComment = ''\r\n    },\r\n    closeApproveDialog() {\r\n      this.formDialog = false\r\n      this.form.apprComment = ''\r\n      this.detailData = []\r\n\r\n    },\r\n    completeTask(submitType) {\r\n      // 提交类型   0 正常提交   1 退回\r\n      if (this.form.apprComment == null || this.form.apprComment == '' || this.form.apprComment.trim().length == 0) {\r\n        this.crud.notify('请填写审批意见', CRUD.NOTIFICATION_TYPE.ERROR)\r\n        return false\r\n      }\r\n\r\n      const param = {\r\n        'taskId': this.form.taskId,\r\n        'submitType': submitType,\r\n        'apprComment': this.form.apprComment.trim()\r\n      }\r\n\r\n      completeTask(qs.stringify(param)).then(returnData => {\r\n        console.log(returnData.code)\r\n        if (returnData.code === '0000') {\r\n          this.$message({\r\n            type: 'success',\r\n            message: '操作成功 '\r\n          })\r\n          this.formDialog = false\r\n          //this.defaultCrud.refresh()\r\n        } else {\r\n          this.$message({\r\n            type: 'error',\r\n            message: '操作失败!错误原因:' + returnData.msg\r\n          })\r\n        }\r\n        this.crud.refresh();\r\n      })\r\n\r\n\r\n    },\r\n    handleClick(tab, event) {\r\n\r\n      console.log(tab.index + \"====\" + tab.label)\r\n      if (tab.index == '0') {//\r\n        //this.getAtomListByIds();\r\n        this.getAtomListByVerifyNo();\r\n        this.getDimListByIeIds();\r\n      } else if (tab.index == '1') {\r\n        this.approveDetail();\r\n      }\r\n\r\n      console.log(tab, event);\r\n    },\r\n    getAtomListByIds() {\r\n      getAtomListByIds(this.form.businessKey).then(res => {\r\n        if (res.code == 0) {\r\n          this.tabData = res.data;\r\n        }\r\n      })\r\n    },\r\n    getAtomListByVerifyNo() {\r\n      getAtomListByVerifyNo(this.form.originalInstId).then(res => {\r\n        if (res.code == 0) {\r\n          this.tabData = res.data;\r\n        }\r\n      });\r\n    },\r\n    approveDetail() {\r\n      approveDetail(qs.stringify({originalInstId: this.form.originalInstId})).then(res => {\r\n        this.detailData = res.data\r\n      })\r\n    },\r\n    showAtomDetail(data) {\r\n      const _thisAtom = this.$refs.atomPage\r\n      _thisAtom.form = data\r\n      _thisAtom.title = data.bizName + '[' + data.bizCode + ']详情'\r\n      const param = {\r\n        bizCode: data.bizCode,\r\n        keepHistory: data.keepHistory\r\n      }\r\n      getDimensions(param).then(data => {\r\n        _thisAtom.atomDimensions = data.data\r\n      })\r\n      getDimInfo().then(data => {\r\n        _thisAtom.dimensions = data.data\r\n      })\r\n      // 获取数据源\r\n      getAllSource().then(data => {\r\n        _thisAtom.sourceData = [{id: 'local', datasourceName: '默认数据源'}].concat(data.data)\r\n      })\r\n      _thisAtom.form.currency = data.currency == null ? null : Array.isArray(data.currency) ? data.currency : data.currency.split(\",\")\r\n      _thisAtom.form.indValueType = data.indValueType\r\n      _thisAtom.form.indFrequency = data.indFrequency == null ? null : Array.isArray(data.indFrequency) ? data.indFrequency : data.indFrequency.split(\",\")\r\n      if (data.ieProp == '3') {\r\n        _thisAtom.dimAndValueObject1.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[0] == null ? false : true\r\n        _thisAtom.dimAndValueObject1.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[0] == null ? null : data.indDimAndValueRelations[0].dimension\r\n        _thisAtom.dimAndValueObject1.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[0] == null ? null : data.indDimAndValueRelations[0].dimensionValue\r\n        _thisAtom.dimAndValueObject1.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[0] == null ? null : data.indDimAndValueRelations[0].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject2.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[1] == null ? false : true\r\n        _thisAtom.dimAndValueObject2.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[1] == null ? null : data.indDimAndValueRelations[1].dimension\r\n        _thisAtom.dimAndValueObject2.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[1] == null ? null : data.indDimAndValueRelations[1].dimensionValue\r\n        _thisAtom.dimAndValueObject2.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[1] == null ? null : data.indDimAndValueRelations[1].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject3.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[2] == null ? false : true\r\n        _thisAtom.dimAndValueObject3.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[2] == null ? null : data.indDimAndValueRelations[2].dimension\r\n        _thisAtom.dimAndValueObject3.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[2] == null ? null : data.indDimAndValueRelations[2].dimensionValue\r\n        _thisAtom.dimAndValueObject3.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[2] == null ? null : data.indDimAndValueRelations[2].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject4.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[3] == null ? false : true\r\n        _thisAtom.dimAndValueObject4.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[3] == null ? null : data.indDimAndValueRelations[3].dimension\r\n        _thisAtom.dimAndValueObject4.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[3] == null ? null : data.indDimAndValueRelations[3].dimensionValue\r\n        _thisAtom.dimAndValueObject4.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[3] == null ? null : data.indDimAndValueRelations[3].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject5.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[4] == null ? false : true\r\n        _thisAtom.dimAndValueObject5.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[4] == null ? null : data.indDimAndValueRelations[4].dimension\r\n        _thisAtom.dimAndValueObject5.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[4] == null ? null : data.indDimAndValueRelations[4].dimensionValue\r\n        _thisAtom.dimAndValueObject5.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[4] == null ? null : data.indDimAndValueRelations[4].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject6.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[5] == null ? false : true\r\n        _thisAtom.dimAndValueObject6.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[5] == null ? null : data.indDimAndValueRelations[5].dimension\r\n        _thisAtom.dimAndValueObject6.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[5] == null ? null : data.indDimAndValueRelations[5].dimensionValue\r\n        _thisAtom.dimAndValueObject6.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[5] == null ? null : data.indDimAndValueRelations[5].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject7.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[6] == null ? false : true\r\n        _thisAtom.dimAndValueObject7.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[6] == null ? null : data.indDimAndValueRelations[6].dimension\r\n        _thisAtom.dimAndValueObject7.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[6] == null ? null : data.indDimAndValueRelations[6].dimensionValue\r\n        _thisAtom.dimAndValueObject7.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[6] == null ? null : data.indDimAndValueRelations[6].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject8.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[7] == null ? false : true\r\n        _thisAtom.dimAndValueObject8.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[7] == null ? null : data.indDimAndValueRelations[7].dimension\r\n        _thisAtom.dimAndValueObject8.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[7] == null ? null : data.indDimAndValueRelations[7].dimensionValue\r\n        _thisAtom.dimAndValueObject8.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[7] == null ? null : data.indDimAndValueRelations[7].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject9.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[8] == null ? false : true\r\n        _thisAtom.dimAndValueObject9.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[8] == null ? null : data.indDimAndValueRelations[8].dimension\r\n        _thisAtom.dimAndValueObject9.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[8] == null ? null : data.indDimAndValueRelations[8].dimensionValue\r\n        _thisAtom.dimAndValueObject9.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[8] == null ? null : data.indDimAndValueRelations[8].dimensionName\r\n\r\n        _thisAtom.dimAndValueObject10.isShow = data.indDimAndValueRelations.length == 0 ?\r\n            false : data.indDimAndValueRelations[9] == null ? false : true\r\n        _thisAtom.dimAndValueObject10.dimension = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[9] == null ? null : data.indDimAndValueRelations[9].dimension\r\n        _thisAtom.dimAndValueObject10.dimensionValue = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[9] == null ? null : data.indDimAndValueRelations[9].dimensionValue\r\n        _thisAtom.dimAndValueObject10.dimensionName = data.indDimAndValueRelations.length == 0 ?\r\n            null : data.indDimAndValueRelations[9] == null ? null : data.indDimAndValueRelations[9].dimensionName\r\n      }\r\n      let defRule = data.indDefRule;\r\n      if (defRule != null) {\r\n        let defRuleArr = defRule.split(\"||\");\r\n        if (Array.isArray(defRuleArr) && defRuleArr.length >= 2) {\r\n          _thisAtom.form.indDefRule = defRuleArr[0]\r\n        } else {\r\n          _thisAtom.form.indDefRule = defRule;\r\n        }\r\n      }\r\n      _thisAtom.form.indDefRuleStr = data.indDefRuleStr;\r\n      _thisAtom.indDefRuleStr = data.indDefRuleStr;\r\n      if (_thisAtom.indDefRuleStr == null || _thisAtom.indDefRuleStr == '') {\r\n        this.isSelfRule = true\r\n      } else {\r\n        this.isSelfRule = false\r\n      }\r\n      if (data.indDefRuleVal != null && data.indDefRuleVal != \"\") {\r\n        _thisAtom.form.indDefRuleVal = data.indDefRuleVal;\r\n        _thisAtom.form.indDefRuleId = data.indDefRuleId;\r\n        _thisAtom.indDefRuleVal = data.indDefRuleVal;\r\n        _thisAtom.indDefRuleId = data.indDefRuleId;\r\n      } else {\r\n        if (defRule != null) {\r\n          let defRuleArr = defRule.split(\"||\");\r\n          if (Array.isArray(defRuleArr) && defRuleArr.length >= 2) {\r\n            _thisAtom.form.indDefRuleVal = defRuleArr[1];\r\n            _thisAtom.form.indDefRuleId = defRuleArr[2];\r\n            _thisAtom.indDefRuleVal = defRuleArr[1];\r\n            _thisAtom.indDefRuleId = defRuleArr[2];\r\n          }\r\n        }\r\n      }\r\n      /* _this.bizCode = data.bizCode*/\r\n      _thisAtom.atomPageDialog = true\r\n    },\r\n    getDimListByIeIds() {\r\n      getDimListByIeIds(this.form.businessKey).then(res => {\r\n        if (res.code == 0) {\r\n          this.dimData = res.data;\r\n        }\r\n      })\r\n    },\r\n    onInput() {\r\n      this.$forceUpdate();\r\n    }\r\n\r\n  }\r\n}\r\n",null]}