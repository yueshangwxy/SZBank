{"remainingRequest":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\code\\indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\base\\baseDevelop.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\code\\indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\base\\baseDevelop.vue","mtime":1633767215681},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport crudIndIndicatorInfo, {\n  getAtom,\n  getAtomDimenston,\n  saveBaseRule,\n  updateStatuesByIeCode\n} from '../../../../api/indicators/indIndicatorInfo'\nimport dimensionPage from './dimensionPage'\nimport limitRulePage from './limitRulePage'\n\nexport default {\n  components: {\n    dimensionPage,\n    limitRulePage\n  },\n  dicts: ['EXPRESSION'],\n  data() {\n    return {\n      rules: {\n        'indBaseRule.bizCode': [\n          { required: true, message: '原子指标不能为空', trigger: 'blur' }\n        ],\n        'indBaseRule.measureColumn': [\n          { required: true, message: '度量不能为空', trigger: 'blur' }\n        ]\n      },\n      loading: false,\n      baseDevelopDialog: false,\n      title: '',\n\n      form: {\n        ieCode: null,\n        indBaseRule: {\n          calcRule: null, // 加工规则\n          dataSource: null, // 数据源\n          expression: 'sum', // 取数表达式\n          dataTable: null, // 取数表名-即原子指标中的存储表名\n          measureColumn: null, // 度量\n          bizCode: null // 原子指标\n        },\n\n        indDimRelations: [], // 指标维度关系\n        indBaseRuleFilters: [], // 指标附加规则\n\n        dimVals: null, // 维度选择页面传来的显示维度\n        limitRule: null // 限制规则\n\n      },\n      atom: [], // 原子指标\n      measureInfo: [], // 度量信息\n      dimInfo: [] // 原子指标维度信息\n    }\n  },\n  methods: {\n    /* 基础指标开发的method----start */\n    // 原子指标修改后触发事件\n    atomChangeHandle(val) {\n      this.atom.some((item) => {\n        if (item.bizCode == val) {\n          // 1.自动注入取数表名\n          this.form.indBaseRule.dataTable = item.bizTabCode\n          // 2.根据原子指标编号查询原子指标维度信息表;生成维度信息\n          const dimParam = {\n            bizCode: item.bizCode,\n            dimType: 'D'\n          }\n          getAtomDimenston(dimParam).then(data => {\n            this.dimInfo = data.data\n          })\n          // 3.根据原子指标编号查询原子指标维度信息表;生成度量信息\n          const meaParam = {\n            bizCode: item.bizCode,\n            dimType: 'M'\n          }\n          getAtomDimenston(meaParam).then(data => {\n            this.measureInfo = data.data\n          })\n          // 清空\n          this.form.indBaseRule.measureColumn = null\n          this.form.dimVals = null\n          this.form.limitRule = null\n        }\n      })\n    },\n    // 统计维度点击选择时触发\n    dimClickHandle() {\n      // 将维度信息传递过去并将结果返回\n      const _this = this.$refs.dimensionPage\n      _this.title = '统计维度'\n      _this.dimInfo = this.dimInfo\n      _this.indDimRelations = this.form.indDimRelations// 默认选中的值\n      _this.selectRow()// 做默认选中的处理\n      _this.dimensionDialog = true\n    },\n    // 接收统计维度子组件传来的信息\n    getDimensionPage(data1, data2) {\n      this.form.dimVals = data1\n      this.form.indDimRelations = data2\n    },\n    // 限制规则点击选择时触发\n    limitRuleClickHandle() {\n      // 将维度信息传递过去选择后将结果返回\n      const _this = this.$refs.limitRulePage\n      _this.title = '限制规则'\n      _this.dimInfo = this.dimInfo\n      _this.tableData = []\n      _this.tableName = this.form.indBaseRule.dataTable// 表名,查询值列表的参数\n      _this.indBaseRuleFilters = this.form.indBaseRuleFilters// 默认选中的值\n      _this.selectRow()// 做默认选中的处理\n      _this.limitRuleDialog = true\n    },\n    // 接收限制规则子组件传来的信息\n    getLimitPage(data1, data2) {\n      this.form.limitRule = data1\n      this.form.indBaseRuleFilters = data2\n    },\n    // 取消按钮\n    cancel() {\n      this.baseDevelopDialog = false\n    },\n    // 保存\n    saveBaseRule() {\n      if (this.form.indBaseRule.bizCode == null || this.form.indBaseRule.bizCode.trim() == '') {\n        this.$message.error({\n          message: '原子指标不能为空'\n        })\n        return false\n      }\n      if (this.form.indBaseRule.measureColumn == null || this.form.indBaseRule.measureColumn.trim() == '') {\n        this.$message.error({\n          message: '度量不能为空'\n        })\n        return false\n      }\n      // form表单作为参数\n      saveBaseRule(this.form).then(data => {\n        if (data.code === 0) {\n          this.$message.success({\n            message: '保存成功!'\n          })\n          this.cancel()\n          this.$emit('func', 'hi')\n        } else {\n          this.$message.error({\n            message: data.msg\n          })\n        }\n      })\n    },\n    // 上线\n    upLine() {\n      saveBaseRule(this.form).then(data => {\n        if (data.code === 0) {\n          const indIndicatorInfo = {\n            'ieCode': this.form.ieCode,\n            'status': 4\n          }\n          updateStatuesByIeCode(indIndicatorInfo).then(data => {\n            if (data.code === 0) {\n              this.$message.success({\n                message: '操作成功!'\n              })\n              this.cancel()\n              this.$emit('func', 'hi')\n            } else {\n              this.$message.error({\n                message: data.msg\n              })\n            }\n          })\n        } else {\n          this.$message.error({\n            message: data.msg\n          })\n        }\n      })\n    }\n    /* 基础指标开发的method----end */\n  }\n}\n",null]}