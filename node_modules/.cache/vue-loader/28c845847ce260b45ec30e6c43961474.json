{"remainingRequest":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\assetSearch\\assetSearch.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\assetSearch\\assetSearch.vue","mtime":1652778849901},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      // 首页传来的关键字\r\n      keywords: '',\r\n      tabList: [\r\n        { label: \"全部表\", name: \"all\" },\r\n        { label: \"我的表\", name: \"mine\" },\r\n      ],\r\n      activeTab: \"all\",\r\n      // 树形控件\r\n      filterText: \"\",\r\n      defaultProps: {\r\n        id: \"contentsId\",\r\n        children: \"children\",\r\n        label: \"name\",\r\n      },\r\n      treeData: [],\r\n      treeDataAll: [],\r\n      treeDataMine: [],\r\n      // 目录列表\r\n      catalogueList: [],\r\n      // 资产类型\r\n      assetType: \"all\",\r\n      // 一级目录\r\n      firstType: \"all\",\r\n      firstList: [],\r\n      // 二级目录\r\n      secondType: \"all\",\r\n      secondList: [],\r\n      // 三级目录\r\n      thirdType: \"all\",\r\n      thirdList: [],\r\n      // 精准筛选\r\n      // 属主部门\r\n      deptCode: '',\r\n      table: {\r\n        project: ''\r\n      },\r\n      api: {\r\n        application: ''\r\n      },\r\n      target: {\r\n        targetName: '',\r\n        targetCode: '',\r\n        targetType: '',\r\n        classifyOne: '',\r\n      },\r\n      label: {\r\n        classifyName: '',\r\n        objectCode: '',\r\n        fromCode: '',\r\n      },\r\n      // 列表部分\r\n      tableData: [],\r\n      // 收藏\r\n      save: true,\r\n      // 分页\r\n      currentPage: 1,\r\n      pageSize: 9,\r\n      total: 50,\r\n      // 数据预览\r\n      dataPreVis: false,\r\n      preDataList: [],\r\n      preDataProp: [],\r\n      // 申请权限\r\n      authorityVis: false,\r\n      // 加入购物车参数\r\n      request: {\r\n        tableId: \"\",\r\n        beginTime: \"\",\r\n        endTime: \"\",\r\n      },\r\n      // 直接申请\r\n      directApplyVis: false,\r\n      daterange: \"\",\r\n      pickerOptions: {\r\n        disabledDate: (time) => {\r\n            let oneDay = 60*60*24*1000\r\n            return time.getTime() < Date.now() - oneDay;\r\n          }\r\n      },\r\n      radio: \"2\",\r\n      // 提示弹窗\r\n      tipDialog: false,\r\n\r\n      nodeData: [],\r\n      // 应用列表\r\n      appList: [],\r\n      // 指标类型列表\r\n      targetTypeList: [],\r\n      // 一级分类列表\r\n      classifyOneList: [],\r\n      // 部门树\r\n      deptTreeList: [],\r\n    };\r\n  },\r\n  watch: {\r\n    $route(to, from) {\r\n      console.log(to, from, \"$route\");\r\n      this.getRouteData();\r\n    },\r\n    save(val) {\r\n      console.log(val);\r\n    },\r\n    // 节点过滤\r\n    filterText(val) {\r\n      this.$refs.tree.filter(val);\r\n    },\r\n    // 树状图tab\r\n    activeTab(val) {\r\n      if (val === \"all\") {\r\n        this.treeData = this.treeDataAll;\r\n        this.currentPage = 1\r\n        this.getListByKeywords()\r\n      } else {\r\n        this.treeData = this.treeDataMine;\r\n        this.currentPage = 1\r\n        this.getSelfTablePage()\r\n      }\r\n    },\r\n    // 目录联动\r\n    // 资产类型\r\n    assetType(val) {\r\n      if (val === \"all\") {\r\n        this.thirdList = [];\r\n        this.treeData = this.treeDataAll;\r\n      } else if (val === \"table\") {\r\n        this.secondType = \"all\";\r\n        this.activeTab = 'all'\r\n        this.treeData = this.treeDataAll;\r\n      } else if (val === \"api\") {\r\n        this.secondType = \"all\";\r\n        this.treeData = this.treeDataAll;\r\n      } else if (val === \"target\") {\r\n        this.secondType = \"all\";\r\n        this.treeData = this.treeDataAll;\r\n      } else if (val === \"label\") {\r\n        this.secondType = \"all\";\r\n        this.treeData = this.treeDataAll;\r\n      }\r\n    },\r\n    // 一级\r\n    firstType(val) {\r\n      if(val === 'all') {\r\n        this.secondType = 'all'\r\n      }\r\n      let data;\r\n      data = this.firstList.filter(item=>{\r\n          return item.contentsId == val\r\n      })\r\n      if(data.length<1) {\r\n          this.secondList = []\r\n      }else {\r\n          this.secondList = JSON.parse(JSON.stringify(data[0].children))\r\n          if(this.secondList.length>0) {\r\n              this.secondList.unshift({\r\n                  contentsId: 'all',\r\n                  name: '全部',\r\n                  children: []\r\n              })\r\n          }\r\n      }\r\n    },\r\n    // 二级\r\n    secondType(val) {\r\n      if(val === 'all') {\r\n        this.thirdType = 'all'\r\n      }\r\n      let data;\r\n      data = this.secondList.filter(item=>{\r\n          return item.contentsId == val\r\n      })\r\n      console.log(data,333);\r\n      if(data.length<1) {\r\n          this.thirdList = []\r\n      }else {\r\n          this.thirdList = JSON.parse(JSON.stringify(data[0].children))\r\n          if(this.thirdList.length>0) {\r\n              this.thirdList.unshift({\r\n                  contentsId: 'all',\r\n                  name: '全部',\r\n                  children: []\r\n              })\r\n          }\r\n      }\r\n    },\r\n    // 时间选择\r\n    daterange(val) {\r\n      if(val) {\r\n        this.request.beginTime = this.formatDate(val[0])\r\n        this.request.endTime = this.formatDate(val[1])\r\n      } else {\r\n        this.request.beginTime = ''\r\n        this.request.endTime = ''\r\n      }\r\n    },\r\n  },\r\n  created() {\r\n    // 首页跳转\r\n    this.getRouteData();\r\n    // 树状图初始数据\r\n    this.$api.getAllCatalogueList({}).then(res => {\r\n        this.treeData = res\r\n        this.treeDataAll = res\r\n    })\r\n    // 我的表目录树\r\n    this.$api.getAuthTree({}).then(res => {\r\n      this.treeDataMine = res.data\r\n    })\r\n    // 全部目录 \r\n    this.$api.getAllCatalogueList({}).then(res => {\r\n        console.log(res,'chushihua');\r\n        this.firstList = res\r\n        this.firstList.unshift({\r\n            contentsId: 'all',\r\n            name: '全部',\r\n            children: []\r\n        })\r\n    })\r\n    // 查询所有应用   appList\r\n    // 查询指标类型, 一级分类 \r\n    // 查询部门树    \r\n    this.$api.getAppList({}).then(res => {\r\n      this.appList = res.data\r\n    })\r\n    this.$api.getTargetSelect({}).then(res => {\r\n      this.targetTypeList = res.data.targetTypeList\r\n      this.classifyOneList = res.data.classifyOneList\r\n    })\r\n    this.$api.getDeptTree({}).then(res => {\r\n      this.deptTreeList = res.data\r\n    })\r\n    // 初始化列表\r\n    this.queryList();\r\n\r\n  },\r\n  mounted() {},\r\n  methods: {\r\n    getRouteData() {\r\n      //   console.log(this.$route.query);\r\n      if (this.$route.query.data != undefined) {\r\n        if (typeof this.$route.query.data == \"number\") {\r\n          // 1 表资产 2 API资产 3 指标资产 4 标签资产\r\n          if (this.$route.query.data == 1) {\r\n            this.assetType = \"table\";\r\n          } else if (this.$route.query.data == 2) {\r\n            this.assetType = \"api\";\r\n          } else if (this.$route.query.data == 3) {\r\n            this.assetType = \"target\";\r\n          } else if (this.$route.query.data == 4) {\r\n            this.assetType = \"label\";\r\n          }\r\n        } else if (typeof this.$route.query.data == \"string\") {\r\n          this.keywords = this.$route.query.data\r\n          // 搜索\r\n          if (this.$route.query.from == \"home\") {\r\n            //   从首页搜索\r\n            console.log(this.$route.query.data, \"首页搜索\");\r\n            var index = this.$route.query.index\r\n            if (index != undefined) {\r\n                // 0~3 表数据资产 4~6 指标数据资产 7~9 标签数据资产\r\n                if (index == 0 || index == 1 || index == 2 || index == 3) {\r\n                    this.assetType = \"table\";\r\n                } else if (index == 4 || index == 5 || index == 6) {\r\n                    this.assetType = \"target\";\r\n                } else if (index == 7 || index == 8 || index == 9) {\r\n                    this.assetType = \"label\";\r\n                }\r\n                this.firstType = this.$route.query.firstDir\r\n                this.secondType = this.$route.query.secondDir\r\n                this.thirdType = (this.$route.query.index + 1).toString()\r\n                console.log(this.secondType,'this.secondType')\r\n                console.log(this.thirdType,'this.thirdType')\r\n            }\r\n            console.log(this.$route.query.index)\r\n          } else if (this.$route.query.from == \"other\") {\r\n            //   从其他页搜索\r\n            console.log(this.$route.query.data, \"其他页搜索\");\r\n          }\r\n          // 初始化列表\r\n          this.queryList();\r\n        }\r\n      }\r\n    },\r\n    // 搜索按钮点击\r\n    queryList() {\r\n      // 我的表搜索按钮点击\r\n      this.currentPage = 1\r\n      if(this.assetType==='table' && this.activeTab==='mine'){\r\n        this.getSelfTablePage()\r\n      } else {  // 其他搜索按钮点击\r\n        this.getListByKeywords()\r\n      }\r\n    },\r\n    // 资产类型切换\r\n    handleClick(tab, event) {\r\n      console.log(tab, event);\r\n      this.table = {}\r\n      this.api = {}\r\n      this.target = {}\r\n      this.label = {}\r\n      this.deptCode = ''\r\n    },\r\n    // 节点过滤\r\n    filterNode(value, data) {\r\n      if (!value) return true;\r\n      return data.name.indexOf(value.toString()) !== -1;\r\n    },\r\n    // 节点点击   --- 树状图节点点击调接口重新查询列表\r\n    handleNodeClick(data,node) {\r\n      // 最后一级节点点击\r\n      if (!data.children || data.children.length == 0) {\r\n        this.thirdType = data.contentsId\r\n        this.secondType = node.parent.data.contentsId\r\n        this.firstType = node.parent.parent.data.contentsId\r\n        // 我的表节点点击\r\n        this.queryList()\r\n      } else {\r\n        console.log('非最后一级节点点击');\r\n      }\r\n    },\r\n    // 我的表查询\r\n    getSelfTablePage() {\r\n      this.keywords = sessionStorage.getItem('searchKeyWords')\r\n      const request = {\r\n        contentsOne: this.firstType,\r\n        contentsTwo: this.secondType,\r\n        contentsThree: this.thirdType,\r\n        keywords: this.keywords,\r\n        deptCode: this.deptCode,\r\n        project: this.table.project,\r\n        page: this.currentPage,\r\n        size: this.pageSize,\r\n      }\r\n      console.log(request);\r\n      this.$api.getSelfTablePage(request).then((res) => {\r\n        console.log(res,'我的表');\r\n        this.total = res.data.total\r\n        this.tableData = res.data.records\r\n      })\r\n    },\r\n    // 列表查询\r\n    getListByKeywords() {\r\n      this.keywords = sessionStorage.getItem('searchKeyWords')\r\n      let request = {\r\n        keywords: this.keywords,\r\n        page: this.currentPage,\r\n        size: this.pageSize,\r\n        assetType: this.assetType,\r\n        contentsOne: this.firstType,\r\n        contentsTwo: this.secondType,\r\n        contentsThree: this.thirdType,\r\n        table: this.table,\r\n        api: this.api,\r\n        target: this.target,\r\n        label: this.label,\r\n        deptCode: this.deptCode,\r\n      }\r\n      console.log(request);\r\n      this.$api.getListByKeywords(request).then((res) => {\r\n        this.total = res.total\r\n        if(this.assetType === 'table') {\r\n          this.tableData = res.tableList\r\n        } else if (this.assetType === 'api') {\r\n          this.tableData = res.apiList\r\n        } else if (this.assetType === 'target') {\r\n          this.tableData = res.targetList\r\n        } else if (this.assetType === 'label') {\r\n          this.tableData = res.labelList\r\n        } else {\r\n          this.tableData = res.obj;\r\n        }\r\n      });\r\n    },\r\n    // 分页\r\n    handleCurrentChange(val) {\r\n      this.currentPage = val\r\n      if(this.assetType==='table' && this.activeTab==='mine'){\r\n        this.getSelfTablePage()\r\n      } else {\r\n        this.getListByKeywords()\r\n      }\r\n    },\r\n    // 我的购物车\r\n    jumpShopCar() {\r\n      this.$router.push({\r\n        path: \"/myShopCar/index\",\r\n      });\r\n    },\r\n    // 我的收藏\r\n    jumpCollection() {\r\n      this.$router.push({\r\n        path: \"/myCollection/index\",\r\n      });\r\n    },\r\n    // 详情查看\r\n    viewDetails(item) {\r\n      this.$router.push({\r\n        path: \"/detailsView/\" + item.assetType,\r\n        query: {\r\n          id: item.id,\r\n        },\r\n      });\r\n    },\r\n    // 数据预览\r\n    previewData(item) {\r\n      this.preDataProp = []\r\n      this.preDataList = []\r\n      this.dataPreVis = true;\r\n      this.$api.previewTableData({name: item.tableName}).then(res => {\r\n        console.log(res,333);\r\n        this.preDataProp = res.data.columns\r\n        this.preDataList = res.data.dataList\r\n\r\n      })\r\n    },\r\n    // 添加收藏\r\n    addFavorite(item) {\r\n        this.$api.addFavorite({\r\n            assetId: item.id,\r\n            assetType: item.assetType,\r\n        }).then(res => {\r\n            this.$message.success('添加收藏成功!')\r\n            if(this.assetType==='table' && this.activeTab==='mine'){\r\n              this.getSelfTablePage()\r\n            } else {\r\n              this.getListByKeywords()\r\n            }\r\n        })\r\n    },\r\n    // 删除收藏\r\n    delFavorite(item) {\r\n        this.$api.delFavorite({\r\n            assetId: item.id,\r\n            assetType: item.assetType,\r\n        }).then(res => {\r\n            this.$message.success('取消收藏成功!')\r\n            if(this.assetType==='table' && this.activeTab==='mine'){\r\n              this.getSelfTablePage()\r\n            } else {\r\n              this.getListByKeywords()\r\n            }\r\n        })\r\n    },\r\n    // 申请访问\r\n    applyForAccess(item) {\r\n      this.$api.applyForAccess({\r\n        apiId: item.id\r\n      }).then(res => {\r\n        if(res.code==0 || res.code==200) {\r\n          this.$message.success(res.msg)\r\n          this.getListByKeywords();\r\n        } else {\r\n          this.$message.error(res.msg);\r\n        }\r\n      })\r\n    },\r\n    // 申请权限\r\n    applyForAuthority(item) {\r\n      this.directApplyVis = true\r\n      this.daterange = ''\r\n      this.request.tableId = item.id\r\n    },\r\n    // 加入购物车\r\n    addShopCar() {\r\n      console.log(this.request);\r\n      this.$api.addShopCar(this.request).then((res) => {\r\n        console.log(res);\r\n        this.authorityVis = false\r\n        if(res.code==999) {\r\n          this.$message.warning(res.msg)\r\n        } else if(res.code==200 || res.code==0){\r\n          this.$message.success(res.msg)\r\n        }\r\n      })\r\n    },\r\n    // 直接申请\r\n    directApply() {\r\n      this.authorityVis = false;\r\n      // 直接申请权限接口\r\n      let list = [this.request]\r\n      console.log(list);\r\n      this.$api.applyForAuthority({\r\n        list: list\r\n      }).then((res) => {\r\n          console.log(res);\r\n          this.tipDialog = true;\r\n        })\r\n        .then(() => {\r\n          if(this.assetType==='table' && this.activeTab==='mine'){\r\n            this.getSelfTablePage()\r\n          } else {\r\n            this.getListByKeywords()\r\n          }\r\n          // 提示框展示三秒自动关闭\r\n          setTimeout(() => {\r\n            this.tipDialog = false;\r\n          }, 3000);\r\n        });\r\n    },\r\n    // 生效日期弹窗确定\r\n    confirmApply() {\r\n      // 关闭当前弹窗\r\n      if(this.radio==='2') {\r\n        this.request.beginTime = ''\r\n        this.request.endTime = ''\r\n        this.directApplyVis = false;\r\n        // 打开申请权限方式弹窗\r\n        this.authorityVis = true\r\n      } else {\r\n        if(this.daterange.length<1) {\r\n          this.$message.error('请选择时间')\r\n        }else {\r\n          this.directApplyVis = false\r\n          // 打开申请权限方式弹窗\r\n          this.authorityVis = true\r\n        }\r\n      }\r\n      \r\n    },\r\n    // 日期格式转换\r\n    formatDate (date) {  \r\n      let y = date.getFullYear();  \r\n      let m = date.getMonth() + 1;  \r\n      m = m < 10 ? ('0' + m) : m;  \r\n      let d = date.getDate();  \r\n      d = d < 10 ? ('0' + d) : d;  \r\n      let h = date.getHours();  \r\n      h=h < 10 ? ('0' + h) : h;  \r\n      let minute = date.getMinutes();  \r\n      minute = minute < 10 ? ('0' + minute) : minute;  \r\n      let second=date.getSeconds();  \r\n      second=second < 10 ? ('0' + second) : second;  \r\n      return y + '-' + m + '-' + d  \r\n      // return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;  \r\n    }\r\n  },\r\n};\r\n",null]}