{"remainingRequest":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\src\\views\\indicators\\result\\index.vue","mtime":1644369310615},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Evicce\\Desktop\\工作\\code2\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport crudIndIndicatorResult, {addFavorites,removeFavorites,saveReadRec} from '../../../api/indicators/indIndicatorResult'\r\nimport { getResultDepts} from '@/api/indicators/indResultSubscribe'\r\n  import CRUD, { presenter, header, form, crud } from '@crud/crud'\r\n  import rrOperation from '@crud/RR.operation'\r\n  import crudOperation from '@crud/CRUD.operation'\r\n  // import udOperation from '@crud/UD.operation'\r\n  import pagination from '@crud/Pagination'\r\n  import category from '../category/category'\r\n  import { getDepts } from '@/utils/system'\r\n  import Treeselect from '@riophae/vue-treeselect'\r\n  import '@riophae/vue-treeselect/dist/vue-treeselect.css'\r\n  import moment from \"moment\";\r\n  // crud交由presenter持有\r\n  const defaultCrud = CRUD({\r\n    title: '指标计算结果表',\r\n    url: crudIndIndicatorResult.url,\r\n    sort: 'id,desc',\r\n    initQry: false,\r\n    crudMethod: { ...crudIndIndicatorResult.crud }\r\n  })\r\n  const defaultForm = {\r\n    id: null,\r\n    orgId: null,\r\n    ieId: null,\r\n    ieCode: null,\r\n    ieName: null,\r\n    ieValue: null,\r\n    status: null,\r\n    crtUserCode: null,\r\n    crtOrgCode: null,\r\n    crtDate: null,\r\n    updUserCode: null,\r\n    updOrgCode: null,\r\n    updDate: null,\r\n    frequency: null,\r\n    periodDateInterval:null,\r\n    ieKindOneName:null\r\n  }\r\n  export default {\r\n    name: 'IndIndicatorResult',\r\n    components: { Treeselect,pagination, crudOperation, rrOperation, category },\r\n    mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\r\n    dicts: ['IND_FIRST_TYPE','RETENTION', 'IE_TYPE', 'IE_STATUS','IND_CURRENCY','YN','IE_FREQUENCY'],\r\n    data() {\r\n      return {\r\n        depts: [],\r\n        defaultProps: {\r\n          children: 'children',\r\n          label: 'label'\r\n        },\r\n        table: {\r\n          columns: {\r\n            id: 'hidden',\r\n            ieId: 'hidden',\r\n            updUserCode: 'hidden',\r\n            updDate: 'hidden'\r\n          }\r\n        },\r\n        permission: {\r\n          add: [''],\r\n          edit: [''],\r\n          del: ['']\r\n        },\r\n        showDialog: false,\r\n        pickerMinDate: \"\",//第一次选中的时间\r\n        pickerOptions: {\r\n          onPick: obj => {\r\n\r\n            //this.pickerMinDate = new Date(obj.minDate).getTime();\r\n            //console.log(\"times===>,\" + this.pickerTimes + \", pickerMinDate==>\" + this.pickerMinDate)\r\n           // this.pickerMaxDate = new Date(obj.maxDate).getTime();\r\n            //this.query.periodDateInterval= [this.pickerMinDate, this.pickerMaxDate]\r\n            //this.$set(this.query,'periodDateInterval',[obj.minDate, obj.maxDate]);\r\n          },\r\n          disabledDate: time => {\r\n            if (this.pickerMinDate) {\r\n              const day1 = 366 * 24 * 3600 * 1000;\r\n              let maxTime = this.pickerMinDate + day1;\r\n              let minTime = Date.now() - day1;\r\n              return time.getTime() < minTime || time.getTime() > Date.now();\r\n            } else {\r\n              const day1 = 366 * 24 * 3600 * 1000;\r\n              let minTime = Date.now() - day1;\r\n              return time.getTime() < minTime || time.getTime() > Date.now();\r\n            }\r\n          }\r\n        },\r\n        form:{},\r\n      }\r\n    },\r\n    created() {\r\n      //defaultCrud.query.periodDateInterval = this.timeDefault\r\n      this.crud.optShow.del=false\r\n      this.crud.optShow.edit=false\r\n      this.crud.optShow.add=false\r\n      this.getDepts();\r\n      if(this.$route.query.ieName) {\r\n        this.query.ieName = this.$route.query.ieName\r\n      }\r\n      if(this.$route.query.deptId) {\r\n        this.query.deptId = this.$route.query.deptId\r\n      }\r\n      if(this.$route.query.currency) {\r\n        this.query.currency = this.$route.query.currency\r\n      }\r\n      if(this.$route.query.frequency) {\r\n        this.query.frequency = this.$route.query.frequency\r\n      }\r\n\r\n      if((this.$route.query.ieName == null || this.$route.query.ieName == 'undefined')\r\n          && (this.$route.query.deptId == null || this.$route.query.deptId == 'undefined')\r\n          && (this.$route.query.currency == null || this.$route.query.currency == 'undefined')\r\n          && (this.$route.query.frequency == null || this.$route.query.frequency == 'undefined')){\r\n        //this.crud.resetQuery(false);\r\n        this.query.ieName = ''\r\n        this.query.deptId = null\r\n        this.query.currency = ''\r\n        this.query.frequency = ''\r\n        this.query.isFavorites =''\r\n        this.query.periodDateInterval =''\r\n        this.query.isNotClearIeName = true\r\n      }\r\n      if((this.query.ieName == null || this.query.ieName == 'undefined')\r\n          && (this.query.deptId == null || this.query.deptId == 'undefined')\r\n          && (this.query.currency == null || this.query.currency == 'undefined')\r\n          && (this.query.frequency == null || this.query.frequency == 'undefined')){\r\n        console.log(\"无条件查询\")\r\n       // defaultCrud.initQry = false\r\n        //defaultCrud.refresh()\r\n      }else{\r\n        //CRUD.toQuery\r\n        console.log(\"有条件查询\")\r\n        defaultCrud.initQry = true\r\n        //defaultCrud.refresh()\r\n      }\r\n    },\r\n    mounted() {\r\n      if(this.$route.query.ieName == null || this.$route.query.ieName == 'undefined') {\r\n        this.getPassYearFormatDate ();\r\n        //this.query.periodDateInterval = this.timeDefault\r\n      } else {\r\n        this.query.periodDateInterval =[]\r\n      }\r\n    },\r\n    computed: {\r\n      // 默认时间\r\n      timeDefault () {\r\n        /!*console.log(\"times===>,\" + this.pickerTimes)*!/\r\n        var defalutStartTime = moment().subtract(1,\"year\").format('YYYY-MM-DD')\r\n        var defalutEndTime = moment().format('YYYY-MM-DD')\r\n        return [defalutStartTime, defalutEndTime]\r\n      }\r\n    },\r\n    methods: {\r\n      changeTime(e){\r\n        this.$forceUpdate()\r\n      },\r\n      // 获取数据前设置好接口地址\r\n      [CRUD.HOOK.beforeRefresh]() {\r\n        if(this.$route.query.ieName) {\r\n          this.query.ieName = this.$route.query.ieName\r\n        } else if(!this.query.isNotClearIeName){\r\n          this.query.ieName = '';\r\n        }\r\n        if(defaultCrud.initQry){\r\n          defaultCrud.loading = true\r\n          return true\r\n        }else{\r\n          defaultCrud.initQry = true\r\n          defaultCrud.loading = false\r\n          return false\r\n        }\r\n      },\r\n      viewHandle(row) {\r\n        this.form = row\r\n        this.showDialog = true\r\n        this.saveReadRec(row.id)\r\n      },\r\n      getDepts() {\r\n        getResultDepts().then(res => {\r\n          this.depts = res.content\r\n        })\r\n      },\r\n      saveReadRec(id) {\r\n        saveReadRec(id).then(res => {\r\n          console.log(\"saveReadRec res===>,\" + res)\r\n        })\r\n      },\r\n      addFavorites(data) {\r\n        console.log(\"addFavorites,\" + data)\r\n        if(data == null && !Array.isArray(data)) {\r\n          this.$notify({\r\n            title: '请选择指标结果',\r\n            type: 'warning',\r\n            duration: 2500\r\n          })\r\n          return\r\n        }\r\n        let ids = \"\";\r\n        for(let i = 0; i < data.length; i++) {\r\n          ids += data[i].id + \",\";\r\n        }\r\n        if(ids != null && ids.includes(\",\")) {\r\n          ids = ids.substr(0,ids.length - 1);\r\n        }\r\n        addFavorites(ids).then(res => {\r\n          console.log(\"addFavorites res===>,\" + res)\r\n          if(res.code === 0) {\r\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.SUCCESS)\r\n          } else {\r\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.ERROR)\r\n          }\r\n          defaultCrud.refresh()\r\n        })\r\n      },\r\n      removeFavorites(data) {\r\n        console.log(\"removeFavorites,\" + data)\r\n        if(data == null && !Array.isArray(data)) {\r\n          this.$notify({\r\n            title: '请选择指标结果',\r\n            type: 'warning',\r\n            duration: 2500\r\n          })\r\n          return\r\n        }\r\n        let ids = \"\";\r\n        for(let i = 0; i < data.length; i++) {\r\n          ids += data[i].id + \",\";\r\n        }\r\n        if(ids != null && ids.includes(\",\")) {\r\n          ids = ids.substr(0,ids.length - 1);\r\n        }\r\n        removeFavorites(ids).then(res => {\r\n          console.log(\"removeFavorites res===>,\" + res)\r\n          if(res.code === 0) {\r\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.SUCCESS)\r\n          } else {\r\n            defaultCrud.notify(res.msg, CRUD.NOTIFICATION_TYPE.ERROR)\r\n          }\r\n          defaultCrud.refresh()\r\n        })\r\n      },\r\n      cellStyle(data) {\r\n        if(data.row.readed === 0) {\r\n          return 'font-weight: 1000;color:#1742a5;'\r\n        } else {\r\n          return ''\r\n        }\r\n      },\r\n      /*refreshList() {\r\n        this.crud.refresh()\r\n      },*/\r\n      forceUpdate() {\r\n        this.$forceUpdate()\r\n      },\r\n      handleCategoryClick(data) {\r\n        this.crud.form.categoryId = data.id\r\n        this.crud.query.categoryIds = data.childrenIds\r\n        this.crud.query.categoryType = data.categoryType\r\n        this.crud.query.categoryLevel = data.level\r\n        if (data.categoryType == '0') {\r\n          this.crud.query.categoryId = data.id\r\n        } else {\r\n          this.crud.query.categoryId = data.childrenIds != null ? data.childrenIds.toString() : \"\";\r\n        }\r\n\r\n        this.form.categoryType = data.categoryType\r\n        this.form.categoryId = data.id\r\n        this.crud.form.indFirstType = data.id;\r\n        this.crud.refresh()\r\n      },\r\n      /* 获取过去时间，并传值给现在时间 */\r\n      getPassYearFormatDate () {\r\n        var nowDate = new Date()\r\n        var date = new Date(nowDate)\r\n        date.setDate(date.getDate() - 365)\r\n        var seperator1 = '-'\r\n        var year = date.getFullYear()\r\n        var month = date.getMonth() + 1\r\n        var strDate = date.getDate()\r\n        if (month >= 1 && month <= 9) {\r\n          month = '0' + month\r\n        }\r\n        if (strDate >= 0 && strDate <= 9) {\r\n          strDate = '0' + strDate\r\n        }\r\n        var formatDate = year + seperator1 + month + seperator1 + strDate\r\n        this.getNowFormatDate(formatDate)\r\n      },\r\n      /* 获取现在时间，并接受过去时间的值 */\r\n      getNowFormatDate (formatDate) {\r\n        var date = new Date()\r\n        var seperator1 = '-'\r\n        var year = date.getFullYear()\r\n        var month = date.getMonth() + 1\r\n        var strDate = date.getDate()\r\n        if (month >= 1 && month <= 9) {\r\n          month = '0' + month\r\n        }\r\n        if (strDate >= 0 && strDate <= 9) {\r\n          strDate = '0' + strDate\r\n        }\r\n        var nowData = year + seperator1 + month + seperator1 + strDate\r\n        this.query.periodDateInterval= [formatDate, nowData]  // 默认赋值一年时间\r\n        //this.$set(this.query,\"periodDateInterval\",[formatDate, nowData]);\r\n      }\r\n    }\r\n  }\r\n",null]}