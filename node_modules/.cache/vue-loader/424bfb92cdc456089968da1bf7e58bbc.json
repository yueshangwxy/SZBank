{"remainingRequest":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\eladmin-common\\src\\views\\tools\\picture\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\eladmin-common\\src\\views\\tools\\picture\\index.vue","mtime":1650418876949},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-SZBank\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { mapGetters } from 'vuex'\r\nimport crudPic from '../../../api/tools/picture'\r\nimport CRUD, { presenter, header, crud } from '../../../components/Crud/crud'\r\nimport { getToken } from '../../../utils/auth'\r\nimport rrOperation from '../../../components/Crud/RR.operation'\r\nimport crudOperation from '../../../components/Crud/CRUD.operation'\r\nimport pagination from '../../../components/Crud/Pagination'\r\n\r\n// crud交由presenter持有\r\nconst defaultCrud = CRUD({ title: '图片', url: 'api/pictures', crudMethod: { ...crudPic }})\r\nexport default {\r\n  name: 'Pictures',\r\n  components: { pagination, crudOperation, rrOperation },\r\n  mixins: [presenter(defaultCrud), header(), crud()],\r\n  data() {\r\n    return {\r\n      dialog: false,\r\n      syncLoading: false,\r\n      headers: {\r\n        'Authorization': getToken()\r\n      },\r\n      permission: {\r\n        del: ['admin', 'pictures:del']\r\n      },\r\n      dialogImageUrl: '',\r\n      dialogVisible: false,\r\n      fileList: [],\r\n      pictures: []\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapGetters([\r\n      'imagesUploadApi'\r\n    ])\r\n  },\r\n  created() {\r\n    this.crud.optShow.add = false\r\n    this.crud.optShow.edit = false\r\n  },\r\n  methods: {\r\n    handleSuccess(response, file, fileList) {\r\n      const uid = file.uid\r\n      const id = response.id\r\n      this.pictures.push({ uid, id })\r\n    },\r\n    handleBeforeRemove(file, fileList) {\r\n      for (let i = 0; i < this.pictures.length; i++) {\r\n        if (this.pictures[i].uid === file.uid) {\r\n          crudPic.del(this.pictures[i].id).then(res => {})\r\n          return true\r\n        }\r\n      }\r\n    },\r\n    handlePictureCardPreview(file) {\r\n      this.dialogImageUrl = file.url\r\n      this.dialogVisible = true\r\n    },\r\n    // 刷新列表数据\r\n    doSubmit() {\r\n      this.fileList = []\r\n      this.dialogVisible = false\r\n      this.dialogImageUrl = ''\r\n      this.dialog = false\r\n      this.crud.toQuery()\r\n    },\r\n    // 监听上传失败\r\n    handleError(e, file, fileList) {\r\n      const msg = JSON.parse(e.message)\r\n      this.$notify({\r\n        title: msg.message,\r\n        type: 'error',\r\n        duration: 2500\r\n      })\r\n    },\r\n    sync() {\r\n      this.syncLoading = true\r\n      crudPic.sync().then(res => {\r\n        this.crud.notify('同步成功', CRUD.NOTIFICATION_TYPE.SUCCESS)\r\n        this.crud.toQuery()\r\n        this.syncLoading = false\r\n      })\r\n    }\r\n  }\r\n}\r\n",null]}