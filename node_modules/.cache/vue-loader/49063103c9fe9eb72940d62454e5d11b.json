{"remainingRequest":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\code\\indicator\\Pncui-Indicator\\src\\views\\indicators\\manual\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\code\\indicator\\Pncui-Indicator\\src\\views\\indicators\\manual\\index.vue","mtime":1638272966326},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n  import indIndicatorResult,{getData,getDept,importExcel,add,toApprove,updateApproveStatus,findToApproveInd} from '../../../api/indicators/indIndicatorManual'\n  import CRUD, { presenter, header, form, crud } from '@crud/crud'\n  import rrOperation from '@crud/RR.operation'\n  import crudOperation from '@crud/CRUD.operation'\n  import udOperation from '@crud/UD.operation'\n  import pagination from '@crud/Pagination'\n  import category from '../category/category'\n\n  // crud交由presenter持有\n  const defaultCrud = CRUD({ title: '指标补录', url: indIndicatorResult.url, sort: 'id,desc', crudMethod: { ...indIndicatorResult.method }})\n  const defaultForm = {\n    id: null,\n    ieId: null,\n    ieCode: null,\n    ieName: null,\n    ieValue: null,\n    status: null,\n    crtUserCode: null,\n    crtOrgCode: null,\n    crtDate: null,\n    updUserCode: null,\n    updOrgCode: null,\n    updDate: null,\n    frequency: null,\n    supplementaryValue: null,\n    supplementaryReason: null,\n    ieKindOneCode:null,\n    ieKindOneName:null,\n    ieKindTwoName:null,\n    approveStatus:null,\n    submitDescribe:null\n  }\n/*  const requestXML=\"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" ?>\" +\n          \"<service>\" +\n          \"<LOCAL_HEAD>\" +\n          \"</LOCAL_HEAD>\"+\n          \"<SYS_HEAD>\" +\n          \"<SERVICE_CODE attr=\\\"field\\\"></SERVICE_CODE>\"+\n          \"<SERVICE_SCENE attr=\\\"field\\\"></SERVICE_SCENE>\"+\n          \"<CONSUMER_ID attr=\\\"field\\\"></CONSUMER_ID>\"+\n          \"<CONSUMER_SEQ_NO attr=\\\"field\\\"></CONSUMER_SEQ_NO>\"+\n          \"<BUSS_SEQ_NO attr=\\\"field\\\"></BUSS_SEQ_NO>\"+\n          \"<TRAN_DATE attr=\\\"field\\\"></TRAN_DATE>\"+\n          \"<TRAN_TIMESTAMP attr=\\\"field\\\"></TRAN_TIMESTAMP>\"+\n          \"<TRAN_FLAG attr=\\\"field\\\"></TRAN_FLAG>\"+\n          \"</SYS_HEAD>\"+\n          \"<BODY>\" +\n          \"<INDEX_CODE attr=\\\"field\\\">A00001</INDEX_CODE>\"+\n          \"<DATE_DATE attr=\\\"field\\\">2021-10-29</DATE_DATE>\"+\n          \"</BODY>\"+\n          \"</service>\";*/\n  const bizNames={}\n  const deptList={}\n  const toApproveData=[]\n  export default {\n    name: 'IndIndicatorResult',\n    components: {pagination, crudOperation, rrOperation, category, udOperation},\n    mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\n    dicts: ['RETENTION', 'IE_TYPE', 'IE_STATUS', 'IND_CURRENCY', 'IND_FIRST_TYPE','BUSSINESS_DEPT','IE_FREQUENCY','IND_APPROVE_STATUS'],\n    data() {\n      return {\n        showDialog:false,\n        toApproveDialog:false,\n        innerVisible:false,\n        ids:null,\n        importDataText:'导入数据',\n        importDisabled:false,\n        permission: {\n          add: ['admin', 'indIndicatorResult:add'],\n          edit: ['admin', 'indIndicatorResult:edit'],\n          del: ['admin', 'indIndicatorResult:del']\n        },\n        readOnly:false,\n        bizNames,\n        deptList,\n        toApproveData,\n        cur_page: 1,\n        pageSize: 5,\n         pageSizes:[5,10,20,30,40,50],\n\n        rules: {\n          ieName: [\n            {required: true, message: '指标名称不能为空', trigger: 'blur'}\n          ],\n          ieCode: [\n            {required: true, message: '指标编号不能为空', trigger: 'blur'}\n          ],\n          currency: [\n            {required: true, message: '币种不能为空', trigger: 'blur'}\n          ],\n          frequency: [\n            {required: true, message: '频率不能为空', trigger: 'blur'}\n          ],\n          supplementaryValue: [\n            {required: true, message: '补录值不能为空', trigger: 'blur'}\n          ],\n          supplementaryReason: [\n            {required: true, message: '补录原因不能为空', trigger: 'blur'}\n          ],\n          deptName: [\n            {required: true, message: '业务属主机构不能为空', trigger: 'blur'}\n          ],\n          periodDate: [\n            {required: true, message: '数据日期不能为空', trigger: 'blur'}\n          ],\n        },\n\n      }\n\n    },\n    methods: {\n      // 获取数据前设置好接口地址\n      [CRUD.HOOK.beforeRefresh]() {\n        this.crud.optShow.del = false\n        this.crud.optShow.add = false\n        return true\n      },\n      forceUpdate(e){\n        this.$forceUpdate(); //\n      },\n      downloadTemplate(){\n        //注意路径，前面不要加 ./ 会形成相对路径，点击下载不了。\n        window.open('/ind_indicator_result.xlsx', '_blank')\n      },\n      handleSizeChange(val) {\n        this.pageSize=val;\n        this.cur_page=1;\n      },\n      // 分页导航\n      handleCurrentChange(val) {\n        this.cur_page = val;\n/*\n        this.tableData = this.allData.slice((pageNumber - 1) * pageSize, pageNumber * pageSize)\n*/\n\n      },\n\n      getRowKeys(row) {\n        return row.id;\n      },\n        selectChange() {\n        for (var i = 0; i < Object.keys(this.bizNames).length; i++) {\n          if (this.form.ieName == this.bizNames[i].bizName) {\n            this.form.ieCode = this.bizNames[i].bizCode\n            this.form.ieId = this.bizNames[i].id\n            this.form.ieKindOneCode = this.bizNames[i].indFirstType\n            this.form.ieKindOneName = this.bizNames[i].indFirstTypeName\n            this.form.ieKindTowCode = this.bizNames[i].indSecondType\n            this.form.ieKindTwoName = this.bizNames[i].indSecondTypeName\n           // this.form.frequency = this.bizNames[i].indFrequency\n          }\n        }\n      },\n      deptChange() {\n        for (var i = 0; i < Object.keys(this.deptList).length; i++) {\n          if (this.form.deptName == this.deptList[i].name) {\n            this.form.deptNo = this.deptList[i].code\n            this.form.deptId=this.deptList[i].id\n          }\n        }\n      },\n      addOrEdit(data){\n        console.log(data)\n        if(data.length>0){\n          this.form.id = data[0].id\n          this.form.ieName = data[0].ieName\n          this.form.ieCode = data[0].ieCode\n          this.form.frequency = data[0].frequency\n          this.form.deptNo = data[0].deptNo\n          this.form.deptName = data[0].deptName\n          this.form.periodDate = data[0].periodDate\n          this.form.currency = data[0].currency\n          this.form.supplementaryValue = data[0].supplementaryValue\n          this.form.supplementaryReason = data[0].supplementaryReason\n          this.form.approveStatus = data[0].approveStatus\n          this.readOnly = true\n          if(this.form.approveStatus == \"1\"){\n            this.$message({\n              message: '审批中的指标信息不可更改',\n              type: 'warning'\n            });\n          }else {\n            this.showDialog = true;\n          }\n        }else {\n          this.showDialog = true;\n        }\n\n      },\n      toEdit(cloumn){\n        this.form.id = cloumn.id\n        this.form.ieName = cloumn.ieName\n        this.form.ieCode = cloumn.ieCode\n        this.form.frequency = cloumn.frequency\n        this.form.deptNo = cloumn.deptNo\n        this.form.deptName = cloumn.deptName\n        this.form.periodDate = cloumn.periodDate\n        this.form.currency = cloumn.currency\n        this.form.supplementaryValue = cloumn.supplementaryValue\n        this.form.supplementaryReason = cloumn.supplementaryReason\n        this.readOnly = true\n        this.showDialog = true;\n      },\n      submitCU(){\n        console.log(this.form)\n        add(this.form).then(data=>{\n         console.log(data)\n         if (data.code === 0) {\n           this.$message.success({\n             message: '操作成功!'\n           })\n           this.closeFlowDialog();\n           this.crud.toQuery();\n         } else {\n           this.$message.error({\n             message: data.msg\n           })\n           this.closeFlowDialog();\n           this.crud.toQuery();\n         }\n       })\n      },\n      closeFlowDialog(){\n        this.form.ieName = \"\";\n        this.form.ieCode = \"\";\n        this.form.frequency = \"\";\n        this.form.deptNo = \"\";\n        this.form.deptName = \"\";\n        this.form.periodDate = \"\";\n        this.form.currency = \"\";\n        this.form.supplementaryValue = \"\";\n        this.form.supplementaryReason = \"\";\n\n        //this.crud.selections = [];\n        this.readOnly = false\n        //this.crud.toQuery();\n        this.showDialog = false;\n      },\n      showApproveDialog(){\n        this.toApproveDialog = true;\n\n        findToApproveInd().then(data =>{\n          this.toApproveData =data.data\n          console.log(toApproveData)\n        })\n      },\n      closeToApproveDialog(){\n        this.toApproveDialog = false;\n        this.crud.toQuery();\n      },\n      toApprove(data){\n        console.log(data)\n        this.ids =\"\";\n        for(var i = 0; i < Object.keys(data).length; i++){\n          this.ids+=data[i].id+\",\";\n        }\n        this.ids = this.ids.substring(0,this.ids.lastIndexOf(\",\"));\n        this.innerVisible = true;\n\n      },\n      closeSubmitDialog(){\n        this.innerVisible = false;\n        this.form.submitDescribe=\"\";\n      },\n      submit(){\n        console.log(this.ids+\"=========\"+this.form.submitDescribe)\n        updateApproveStatus(this.ids,this.form.submitDescribe).then(data =>{\n          console.log(data)\n          if(data.msg ==\"成功\"||data.msg ==\"操作成功\"){\n            this.$message.success({\n              message: '操作成功!'\n            })\n            this.closeSubmitDialog();\n            this.closeToApproveDialog();\n          }else{\n            this.$message.error({\n              message: data.msg\n            })\n          }\n        })\n\n      },\n      valueChange(e){\n          this.form.supplementaryValue = e.target.value\n        },\n      beforeUpload(file) {\n        var FileExt = file.name.replace(/.+\\./, \"\");\n        if ([\"xls\", \"xlsx\"].indexOf(FileExt.toLowerCase()) === -1) {\n          this.$message({\n            type: \"warning\",\n            message: \"请上传后缀名为xls、xlsx的附件！\"\n          });\n          return false;\n        }\n        this.importDataText='正在导入';\n        this.importDisabled = true;\n      },\n      handleSuccess(){\n        this.importDataText='导入数据';\n        this.importDisabled = false;\n        this.$refs.upload.clearFiles();\n        this.crud.toQuery();\n\n      },\n      // 自定义上传 导入数据\n      uploadFile: function (item) {\n        const $this = this\n        this.isImported = true;\n        const formData = new FormData();\n        formData.append(\"file\", item.file);\n        importExcel(formData).then(data => {\n          if (data.msg == \"成功\" ||data.msg == \"操作成功\") {\n            $this.$message({\n              type: 'success',\n              message: '导入成功 ',\n            })\n            this.handleSuccess();\n          } else {\n            $this.$message({\n              type: 'warn',\n              message: '导入失败'\n            })\n            this.handleSuccess();\n          }\n        })\n      },\n    },\n\n      mounted() {\n        getData().then(data => {\n          this.bizNames = data.data;\n          console.log(this.bizNames)\n        }),\n\n        getDept().then(data => {\n           this.deptList = data.data;\n        })\n\n      }\n\n  }\n",null]}