{"remainingRequest":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\code\\indicator\\Pncui-Indicator\\node_modules\\eladmin-system\\src\\views\\system\\dept\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\eladmin-system\\src\\views\\system\\dept\\index.vue","mtime":1636685141602},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\code\\indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport crudDept from '../../../api/system/dept'\nimport Treeselect from '@riophae/vue-treeselect'\nimport '@riophae/vue-treeselect/dist/vue-treeselect.css'\nimport CRUD, { presenter, header, form, crud } from '@crud/crud'\nimport rrOperation from '@crud/RR.operation'\nimport crudOperation from '@crud/CRUD.operation'\nimport udOperation from '@crud/UD.operation'\n\n// crud交由presenter持有\nconst defaultCrud = CRUD({ title: '机构', url: 'api/dept', crudMethod: { ...crudDept }})\nconst defaultForm = { id: null, name: null, pid: 1, enabled: 'true', code: null, bussCode: null, bussName: null }\nexport default {\n  name: 'Dept',\n  components: { Treeselect, crudOperation, rrOperation, udOperation },\n  mixins: [presenter(defaultCrud), header(), form(defaultForm), crud()],\n  // 设置数据字典\n  dicts: ['dept_status', 'DEPT_CATEGORY'],\n  data() {\n    return {\n      expands: ['1'],\n      depts: [],\n      dbpdata: {\n        id: null,\n        name: null,\n        dbpPath: null\n      },\n      dbpconfigTitle : '配置DBP',\n      rules: {\n        name: [\n          { required: true, message: '请输入名称', trigger: 'blur' }\n        ],\n        id: [\n          { required: true, message: '请输入编号', trigger: 'blur' }\n        ],\n        dbpPath: [\n          {required: true,message: '请输入DBP路径',trigger: 'blur'}\n        ]\n      },\n      permission: {\n        add: ['admin', 'dept:add'],\n        edit: ['admin', 'dept:edit'],\n        del: ['admin', 'dept:del']\n      },\n      enabledTypeOptions: [\n        { key: 'true', display_name: '启用' },\n        { key: 'false', display_name: '停用' }\n      ],\n      dbpconfigStatus: false,\n      submitConfigStatus: 1\n    }\n  },\n  methods: {\n    getRowKeys: function(row) {\n      return row.id\n    },\n    // 新增与编辑前做的操作\n    [CRUD.HOOK.afterToCU](crud, form) {\n      form.enabled = `${form.enabled}`\n      // 获取所有部门\n      crudDept.getDepts({ enabled: true }).then(res => {\n        this.depts = res.content\n      })\n    },\n    // 查询前做的操作\n    [CRUD.HOOK.afterToDetailCU](crud, form) {\n      form.enabled = `${form.enabled}`\n      // 获取所有部门\n      crudDept.getDepts({ enabled: true }).then(res => {\n        this.depts = res.content\n      })\n    },\n    // 提交前的验证\n    [CRUD.HOOK.afterValidateCU]() {\n      if (!this.form.pid && this.form.id !== 1) {\n        this.$message({\n          message: '上级部门不能为空',\n          type: 'warning'\n        })\n        return false\n      }\n      return true\n    },\n    // 改变状态\n    changeEnabled(data, val) {\n      this.$confirm('此操作将 \"' + this.dict.label.dept_status[val] + '\" ' + data.name + '部门, 是否继续？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(() => {\n        crudDept.edit(data).then(res => {\n          this.crud.notify(this.dict.label.dept_status[val] + '成功', CRUD.NOTIFICATION_TYPE.SUCCESS)\n        }).catch(err => {\n          data.enabled = !data.enabled\n          console.log(err.response.data.message)\n        })\n      }).catch(() => {\n        data.enabled = !data.enabled\n      })\n    },\n    checkboxT(row, rowIndex) {\n      return row.id !== 1\n    },\n    configDbpPath(row) {\n      console.log(\"configDbpPath   \" + row.name)\n      this.dbpdata.id = row.id\n      this.dbpdata.name = row.name\n      this.dbpdata.dbpPath = row.dbpPath\n      this.dbpconfigStatus = true\n    },\n    submitConfig(dbpdata) {\n      this.submitConfigStatus = 2\n      console.log(\"submitConfig  id:  \" + dbpdata.id +\",dbppath: \" + dbpdata.dbpPath)\n      var formData = {};\n      formData.deptId = dbpdata.id\n      formData.deptName = dbpdata.name\n      if(!dbpdata.dbpPath){\n        this.$message({\n          message: '请输入DBP路径',\n          type: 'warning'\n        })\n        this.submitConfigStatus = 1\n        return false;\n      }\n      formData.dbpPath = dbpdata.dbpPath\n      defaultCrud.crudMethod.configDbp(formData).then(res => {\n        console.log(\"submitConfig res : \" + res)\n        defaultCrud.notify(res, CRUD.NOTIFICATION_TYPE.SUCCESS)\n        this.dbpconfigStatus = false\n        this.submitConfigStatus = 1\n      })\n    },\n    cancelConfig() {\n      this.dbpconfigStatus = false\n      this.submitConfigStatus = 1\n    }\n  }\n}\n",null]}