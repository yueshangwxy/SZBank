{"remainingRequest":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\derive.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\derive.vue","mtime":1626599032000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nvar _createForOfIteratorHelper2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\"));\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nvar _indIndicatorInfo = _interopRequireWildcard(require(\"../../../api/indicators/indIndicatorInfo\"));\n\nvar _crud = _interopRequireWildcard(require(\"@crud/crud\"));\n\nvar _RR = _interopRequireDefault(require(\"@crud/RR.operation\"));\n\nvar _ICRUD = _interopRequireDefault(require(\"@crud/ICRUD.operation\"));\n\nvar _UD = _interopRequireDefault(require(\"@crud/UD.operation\"));\n\nvar _Pagination = _interopRequireDefault(require(\"@crud/Pagination\"));\n\nvar _category = _interopRequireDefault(require(\"../category/category\"));\n\nvar _arithmeticPage = _interopRequireDefault(require(\"./arithmetic/arithmeticPage\"));\n\nvar _sqlCheckPage = _interopRequireDefault(require(\"./arithmetic/sqlCheckPage\"));\n\nvar _limitRulePage = _interopRequireDefault(require(\"./arithmetic/limitRulePage\"));\n\nvar _lookDeriveDetails = _interopRequireDefault(require(\"./details/lookDeriveDetails\"));\n\nvar _dept = require(\"@system/api/system/dept\");\n\nvar _vueTreeselect = _interopRequireDefault(require(\"@riophae/vue-treeselect\"));\n\nrequire(\"@riophae/vue-treeselect/dist/vue-treeselect.css\");\n\nvar _vuex = require(\"vuex\");\n\nvar _methods;\n\n// crud交由presenter持有\nvar defaultCrud = (0, _crud.default)({\n  title: '衍生指标信息',\n  url: _indIndicatorInfo.default.url,\n  sort: 'id,desc',\n  crudMethod: (0, _objectSpread2.default)({}, _indIndicatorInfo.default.method)\n});\nvar defaultForm = {\n  id: null,\n  ieCode: null,\n  ieName: null,\n  categoryId: null,\n  ieProp: null,\n  ieType: '2',\n  ieDesc: null,\n  ieRule: null,\n  ieDefaultValue: null,\n  ieMethod: '1',\n  calcFreq: null,\n  status: null,\n  ieDataUnit: '1',\n  ieLevel: null,\n  startDate: null,\n  endDate: null,\n  retention: '1,Y',\n  processInstanceId: null,\n  manageDept: null,\n  crtUserCode: null,\n  crtOrgCode: null,\n  crtDate: null,\n  updUserCode: null,\n  updOrgCode: null,\n  updDate: null\n};\nvar _default = {\n  name: 'IndIndicatorInfo',\n  components: {\n    pagination: _Pagination.default,\n    crudOperation: _ICRUD.default,\n    rrOperation: _RR.default,\n    udOperation: _UD.default,\n    category: _category.default,\n    arithmetic: _arithmeticPage.default,\n    sqlCheck: _sqlCheckPage.default,\n    limitRule: _limitRulePage.default,\n    lookDetails: _lookDeriveDetails.default,\n    Treeselect: _vueTreeselect.default\n  },\n  mixins: [(0, _crud.presenter)(defaultCrud), (0, _crud.header)(), (0, _crud.form)(defaultForm), (0, _crud.crud)()],\n  dicts: ['IE_PROP', 'IE_SCOPE', 'IE_TYPE', 'IE_METHOD', 'CALC_FREQ', 'IE_STATUS', 'IE_DATA_UNIT', 'RETENTION'],\n  data: function data() {\n    return {\n      manageDeptEdited: false,\n      table: {\n        columns: {\n          id: 'hidden',\n          crtOrgCode: 'hidden',\n          updOrgCode: 'hidden'\n        }\n      },\n      permission: {\n        add: ['admin', 'deriveIndIndicatorInfo:add'],\n        submit: ['admin', 'deriveIndIndicatorInfo:submit'],\n        develop: ['admin', 'deriveIndIndicatorInfo:develop'],\n        upLine: ['admin', 'deriveIndIndicatorInfo:upLine'],\n        startUsing: ['admin', 'deriveIndIndicatorInfo:startUsing'],\n        stopUsing: ['admin', 'deriveIndIndicatorInfo:stopUsing'],\n        processA: ['admin', 'deriveIndIndicatorInfo:processA'],\n        edit: ['admin', 'deriveIndIndicatorInfo:edit'],\n        del: ['admin', 'deriveIndIndicatorInfo:del'],\n        details: ['admin', 'deriveIndIndicatorInfo:details']\n      },\n      rules: {\n        ieName: [{\n          required: true,\n          message: '指标名称不能为空',\n          trigger: 'blur'\n        }],\n        ieScope: [{\n          required: true,\n          message: '指标级别不能为空',\n          trigger: 'change'\n        }],\n        ieProp: [{\n          required: true,\n          message: '指标类别不能为空',\n          trigger: 'change'\n        }],\n        ieDataUnit: [{\n          required: true,\n          message: '指标单位不能为空',\n          trigger: 'change'\n        }]\n        /* ieMethod: [\n          {required: true, message: '取值方式不能为空', trigger: 'change'}\n        ]*/\n\n      },\n      processDialog: false,\n      // 计算输日期的页面\n      processParam: {\n        // 传给后台的参数\n        codes: [],\n        periodDate: ''\n      },\n      dateValue: '',\n      // 计算日期\n      depts: [],\n      // 部门数组\n      viewDept: [] // 查看部门数组\n\n    };\n  },\n  computed: (0, _objectSpread2.default)({}, (0, _vuex.mapGetters)(['user'])),\n  mounted: function mounted() {\n    this.getDepts();\n  },\n  methods: (_methods = {\n    // 选择指标级别后关联管理部门\n    changeIeScope: function changeIeScope(data) {\n      if (data == 1) {\n        this.manageDeptEdited = true;\n        /* getInfo().then(res => {\n           this.form.manageDept = res.deptId\n         })*/\n\n        this.form.manageDept = this.user.deptId;\n      } else {\n        this.form.manageDept = null;\n        this.manageDeptEdited = false;\n      }\n    }\n  }, (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeRefresh, function () {\n    this.query.ieType = '2', this.query.queryType = '1';\n    return true;\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToAdd, function () {\n    if (!this.form.categoryId) {\n      this.crud.notify('请选择分类', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    if (this.form.categoryId === '0') {\n      this.crud.notify('根节点不能添加', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    } // 获取部门信息\n\n\n    this.getDepts();\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToEdit, function () {\n    if (this.form.status != 0 && this.form.status != 2) {\n      this.crud.notify('只有未提交或退回的数据才能修改能修改', _crud.default.NOTIFICATION_TYPE.ERROR);\n      this.crud.resetForm();\n      return false;\n    } // 获取部门信息\n\n\n    this.getDepts();\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeDelete, function () {\n    var _iterator = (0, _createForOfIteratorHelper2.default)(this.crud.selections),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var items = _step.value;\n\n        if (items.status != 0) {\n          this.crud.notify('该状态的指标不允许删除', _crud.default.NOTIFICATION_TYPE.ERROR);\n          return false;\n        }\n      } // 获取部门信息\n\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    this.getDepts();\n  }), (0, _defineProperty2.default)(_methods, \"handleCategoryClick\", function handleCategoryClick(data) {\n    this.crud.form.categoryId = data.id;\n    this.crud.query.categoryIds = data.childrenIds;\n    this.form.categoryId = data.id;\n    this.crud.refresh();\n  }), (0, _defineProperty2.default)(_methods, \"deriveDevelop\", function deriveDevelop(data) {\n    // 状态校验-只能选择0-未审批或3-已退回的数据\n    if (data.status != 2) {\n      this.crud.notify('请选择已审批的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    } // 取值方式=1打开四则运算页面.2-SQL公式，3-限制，4-EXCEL公式\n\n\n    if (data.ieMethod == 1) {\n      var _this = this.$refs.arithmetic;\n      var indDeriveRule = {\n        'ieCode': data.ieCode\n      };\n      (0, _indIndicatorInfo.getIndDeriveRuleByIeCode)(indDeriveRule).then(function (data) {\n        if (data.code === 0) {\n          var ruleDesc = data.data.ruleDesc;\n\n          if (ruleDesc != null) {\n            _this.arithtext = ruleDesc;\n          }\n        } else {\n          _this.arithtext = '';\n        }\n      });\n      _this.title = '算法定义-四则运算[' + data.ieCode + ']';\n      _this.ieCode = data.ieCode;\n      _this.arithmeticDialog = true;\n    } else if (data.ieMethod == 2) {\n      var _this2 = this.$refs.sqlCheck;\n      var _indDeriveRule = {\n        'ieCode': data.ieCode\n      };\n      (0, _indIndicatorInfo.getIndDeriveRuleByIeCode)(_indDeriveRule).then(function (deriveRuleData) {\n        if (deriveRuleData.code === 0) {\n          _this2.sqlData.sqlText = deriveRuleData.data.calcRule;\n        } else {\n          _this2.sqlData.sqlText = null;\n        }\n      });\n      _this2.sqlData.ieCode = data.ieCode;\n      _this2.title = '算法定义-SQL校验[' + data.ieCode + ']';\n      _this2.ieCode = data.ieCode;\n      _this2.sqlTemp = true;\n      _this2.sqlCheck = true;\n    } else if (data.ieMethod == 3) {\n      var _this3 = this.$refs.limitRule;\n      _this3.title = '算法定义-限制条件[' + data.ieCode + ']';\n      _this3.ieCode = data.ieCode;\n      _this3.limitCheck = true;\n    }\n  }), (0, _defineProperty2.default)(_methods, \"refQuery\", function refQuery(data) {\n    this.crud.toQuery();\n  }), (0, _defineProperty2.default)(_methods, \"subApprove\", function subApprove(data) {\n    var _this4 = this;\n\n    var temp = 0;\n    var param = [];\n    var ieCodes = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择0-未审批\n      if (data[i].status != 0) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'status': '1',\n        'ieProp': data[i].ieProp\n      };\n      param.push(indIndicatorInfo);\n      ieCodes.push(data[i].ieCode);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择未审批或已退回的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    this.$confirm(\"\\u786E\\u5B9A\\u8981\\u63D0\\u4EA4\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    }).then(function () {\n      (0, _indIndicatorInfo.updateStatus)(param).then(function (returnData) {\n        if (returnData.code === 0) {\n          _this4.crud.notify('操作成功', _crud.default.NOTIFICATION_TYPE.SUCCESS);\n\n          _this4.crud.toQuery();\n        } else {\n          _this4.crud.notify('操作失败!错误原因:' + returnData.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n\n          _this4.crud.toQuery();\n        }\n      });\n    });\n  }), (0, _defineProperty2.default)(_methods, \"upLine\", function upLine(data) {\n    var _this5 = this;\n\n    var temp = 0;\n    var param = [];\n    var ieCodes = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择0-已审批\n      if (data[i].status != 2) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'status': '4'\n      };\n      param.push(indIndicatorInfo);\n      ieCodes.push(data[i].ieCode);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择已审批的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    } // 开发校验通过后执行审批\n\n\n    (0, _indIndicatorInfo.getIndDeriveRule)(ieCodes).then(function (returnData) {\n      if (returnData.code !== 0) {\n        _this5.crud.notify(returnData.msg + '指标未进行开发', _crud.default.NOTIFICATION_TYPE.ERROR);\n      } else {\n        _this5.$confirm(\"\\u786E\\u5B9A\\u4E0A\\u7EBF\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          // 开发校验通过后,修改状态\n          (0, _indIndicatorInfo.updateStatus)(param).then(function (returnData) {\n            if (returnData.code === 0) {\n              _this5.crud.notify('操作成功', _crud.default.NOTIFICATION_TYPE.SUCCESS);\n\n              _this5.crud.toQuery();\n            } else {\n              _this5.crud.notify('操作失败!错误原因:' + returnData.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n\n              _this5.crud.toQuery();\n            }\n          });\n        });\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, \"startUsing\", function startUsing(data) {\n    var _this6 = this;\n\n    var temp = 0;\n    var param = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择4-已上线或6-停用的数据\n      if (data[i].status != 4 && data[i].status != 6) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'ieCode': data[i].ieCode,\n        'status': '5'\n      };\n      param.push(indIndicatorInfo);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择已上线或停用的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    this.$confirm(\"\\u786E\\u5B9A\\u542F\\u7528\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    }).then(function () {\n      // 算法定义校验通过后,修改状态为启用(单独处理、修改衍生指标层级)\n      (0, _indIndicatorInfo.updateDeriveStarStatus)(param).then(function (returnData) {\n        if (returnData.code === 0) {\n          _this6.crud.notify('操作成功', _crud.default.NOTIFICATION_TYPE.SUCCESS);\n\n          _this6.crud.toQuery();\n        } else {\n          _this6.crud.notify('操作失败!错误原因:' + returnData.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n\n          _this6.crud.toQuery();\n        }\n      });\n    });\n  }), (0, _defineProperty2.default)(_methods, \"stopUsing\", function stopUsing(data) {\n    var _this7 = this;\n\n    var temp = 0;\n    var param = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择4-启用数据\n      if (data[i].status != 5) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'status': '6'\n      };\n      param.push(indIndicatorInfo);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择启用的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    this.$confirm(\"\\u786E\\u5B9A\\u505C\\u7528\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    }).then(function () {\n      (0, _indIndicatorInfo.updateStatus)(param).then(function (returnData) {\n        if (returnData.code === 0) {\n          _this7.crud.notify('操作成功', _crud.default.NOTIFICATION_TYPE.SUCCESS);\n\n          _this7.crud.toQuery();\n        } else {\n          _this7.crud.notify('操作失败!错误原因:' + returnData.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n\n          _this7.crud.toQuery();\n        }\n      });\n    });\n  }), (0, _defineProperty2.default)(_methods, \"details\", function details(row) {\n    var _this = this.$refs.lookDetails; // 打开详情页面时通过ieCode去查询取值规则\n\n    var indDeriveRule = {\n      ieCode: row.ieCode\n    };\n    (0, _indIndicatorInfo.getIndDeriveRuleByIeCode)(indDeriveRule).then(function (data) {\n      if (data.code === 0) {\n        _this.$set(_this.form, 'calcRule', data.data.ruleDesc);\n      }\n    });\n    (0, _dept.getDepts)({\n      enabled: true\n    }).then(function (res) {\n      _this.depts = res.content;\n    });\n    _this.title = '详情';\n    _this.form = row;\n    _this.detailsDialog = true;\n  }), (0, _defineProperty2.default)(_methods, \"processA\", function processA(data) {\n    // 只能选择已审批的数据\n    var temp = 0;\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择5-启用\n      if (data[i].status != 5) {\n        temp = -1;\n        break;\n      }\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择已启用的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    var codes = [];\n\n    for (var _i = 0; _i < data.length; _i++) {\n      codes.push(data[_i].ieCode);\n    }\n\n    this.processParam.codes = codes;\n    this.processDialog = true;\n  }), (0, _defineProperty2.default)(_methods, \"processB\", function processB() {\n    var _this8 = this;\n\n    if (this.dateValue == '') {\n      this.crud.notify('日期不能为空', _crud.default.NOTIFICATION_TYPE.ERROR);\n    } else {\n      var dateValue = this.dateFormat(this.dateValue, 'YYYYMMDD');\n      this.processParam.periodDate = dateValue;\n      (0, _indIndicatorInfo.process)(this.processParam, 'derive').then(function (data) {\n        if (data.code == 0) {\n          _this8.crud.notify(data.msg, _crud.default.NOTIFICATION_TYPE.SUCCESS);\n        } else {\n          _this8.crud.notify(data.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n        }\n\n        _this8.processDialog = false;\n      });\n    }\n  }), (0, _defineProperty2.default)(_methods, \"getDepts\", function getDepts() {\n    var _this9 = this;\n\n    (0, _dept.getDepts)({\n      enabled: true,\n      pid: '1',\n      deptCategory: '0'\n    }).then(function (res) {\n      _this9.depts = res.content;\n      _this9.viewDept = [{\n        id: 0,\n        label: '总行机关',\n        children: res.content\n      }];\n    });\n  }), _methods)\n};\nexports.default = _default;",null]}