{"remainingRequest":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\atom\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\atom\\index.vue","mtime":1608778933000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nvar _indAtomInfo = _interopRequireWildcard(require(\"../../../../api/indicators/indAtomInfo\"));\n\nvar _indIndicatorInfo = require(\"../../../../api/indicators/indIndicatorInfo\");\n\nvar _crud = _interopRequireWildcard(require(\"@crud/crud\"));\n\nvar _RR = _interopRequireDefault(require(\"@crud/RR.operation\"));\n\nvar _CRUD = _interopRequireDefault(require(\"@crud/CRUD.operation\"));\n\nvar _UD = _interopRequireDefault(require(\"@crud/UD.operation\"));\n\nvar _Pagination = _interopRequireDefault(require(\"@crud/Pagination\"));\n\nvar _category = _interopRequireDefault(require(\"../../category/category\"));\n\nvar _index = _interopRequireDefault(require(\"../atom/dimension/index\"));\n\nvar _atomPage = _interopRequireDefault(require(\"./atomPage\"));\n\nvar _methods;\n\n// crud交由presenter持有\nvar defaultCrud = (0, _crud.default)({\n  title: '原子指标信息',\n  url: _indAtomInfo.default.url,\n  sort: 'id,desc',\n  crudMethod: (0, _objectSpread2.default)({}, _indAtomInfo.default.crud)\n});\nvar defaultForm = {\n  id: null,\n  ieType: '4',\n  categoryId: null,\n  sourceDataSource: 'local',\n  targetDataSource: 'local',\n  bizCode: null,\n  bizName: null,\n  ieProp: null,\n  createTable: null,\n  keepHistory: '1',\n  bizTabCode: null,\n  bizFlag: null,\n  bizCalcSql: null,\n  dimNames: null,\n  bizDesc: null,\n  calcSeq: null,\n  calcFreq: null,\n  crtUserCode: null,\n  crtOrgCode: null,\n  crtDate: null,\n  updUserCode: null,\n  updOrgCode: null,\n  updDate: null,\n  tenant: null,\n  retention: null,\n  tableShare: '1',\n  status: '2',\n  atomDimensions: []\n};\nvar _default = {\n  name: 'IndAtomInfo',\n  components: {\n    pagination: _Pagination.default,\n    crudOperation: _CRUD.default,\n    rrOperation: _RR.default,\n    udOperation: _UD.default,\n    category: _category.default,\n    dimensionPage: _index.default,\n    atomPage: _atomPage.default\n  },\n  mixins: [(0, _crud.presenter)(defaultCrud), (0, _crud.header)(), (0, _crud.form)(defaultForm), (0, _crud.crud)()],\n  dicts: ['IE_PROP', 'CREATE_TABLE', 'YN', 'RETENTION', 'IE_STATUS'],\n  data: function data() {\n    return {\n      table: {\n        columns: {\n          sourceDataSource: 'hidden',\n          targetDataSource: 'hidden',\n          keepHistory: 'hidden',\n          bizDesc: 'hidden',\n          crtUserCode: 'hidden',\n          crtOrgCode: 'hidden',\n          crtDate: 'hidden',\n          updUserCode: 'hidden',\n          updOrgCode: 'hidden',\n          updDate: 'hidden',\n          tenant: 'hidden'\n        }\n      },\n      permission: {\n        processA: ['indAtomInfo:processA'],\n        add: ['indAtomInfo:add'],\n        edit: ['indAtomInfo:edit'],\n        del: ['indAtomInfo:del'],\n        details: ['indAtomInfo:details']\n      },\n      rules: {\n        bizCalcSql: [{\n          required: true,\n          message: '取数sql不能为空',\n          trigger: 'blur'\n        }],\n        bizName: [{\n          required: true,\n          message: '原子指标名称不能为空',\n          trigger: 'blur'\n        }],\n        bizTabCode: [{\n          required: true,\n          message: '存储表名不能为空',\n          trigger: 'change'\n        }]\n      },\n      sourceData: [],\n      tableInfo: [],\n      atomDimensions: [],\n      bizTabCodeDis: false,\n      // 计算输日期的页面\n      processDialog: false,\n      // 传给后台的参数\n      processParam: {\n        codes: [],\n        periodDate: ''\n      },\n      dateValue: ''\n    };\n  },\n  methods: (_methods = {}, (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeRefresh, function () {\n    this.query.ieType = '4';\n    return true;\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.afterRefresh, function () {\n    var _this2 = this;\n\n    (0, _indIndicatorInfo.getAllSource)().then(function (data) {\n      _this2.sourceData = [{\n        id: 'local',\n        datasourceName: '默认数据源'\n      }].concat(data.data);\n    });\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToEdit, function () {\n    var _this3 = this;\n\n    (0, _indIndicatorInfo.getAllSource)().then(function (data) {\n      _this3.sourceData = [{\n        id: 'local',\n        datasourceName: '默认数据源'\n      }].concat(data.data);\n    });\n    (0, _indAtomInfo.getTablesById)(this.form.targetDataSource).then(function (data) {\n      _this3.tableInfo = data.data;\n    });\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeSubmit, function () {\n    if (this.form.atomDimensions == null) {\n      this.crud.notify('请进行维度管理', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToAdd, function () {\n    var _this4 = this;\n\n    if (!this.form.categoryId) {\n      this.crud.notify('请选择分类', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    if (this.form.categoryId === '0') {\n      this.crud.notify('根节点不能添加', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    } // 获取数据源\n\n\n    (0, _indIndicatorInfo.getAllSource)().then(function (data) {\n      _this4.sourceData = [{\n        id: 'local',\n        datasourceName: '默认数据源'\n      }].concat(data.data);\n    });\n    (0, _indAtomInfo.getTablesById)('local').then(function (data) {\n      _this4.tableInfo = data.data;\n    });\n  }), (0, _defineProperty2.default)(_methods, \"toSelectOne\", function toSelectOne(data) {\n    var _thisAtom = this.$refs.atomPage;\n    _thisAtom.form = data;\n    _thisAtom.title = '原子指标[' + data.bizCode + ']';\n    var param = {\n      bizCode: data.bizCode,\n      keepHistory: data.keepHistory\n    };\n    (0, _indAtomInfo.getDimensions)(param).then(function (data) {\n      _thisAtom.atomDimensions = data.data;\n    });\n    (0, _indIndicatorInfo.getDimInfo)().then(function (data) {\n      _thisAtom.dimensions = data.data;\n    }); // 获取数据源\n\n    (0, _indIndicatorInfo.getAllSource)().then(function (data) {\n      _thisAtom.sourceData = [{\n        id: 'local',\n        datasourceName: '默认数据源'\n      }].concat(data.data);\n    });\n    /* _this.bizCode = data.bizCode*/\n\n    _thisAtom.atomPageDialog = true;\n  }), (0, _defineProperty2.default)(_methods, \"bizTabCodeChange\", function bizTabCodeChange() {\n    if (this.form.bizTabCode === null) {\n      this.bizTabCodeDis = true;\n    } else {\n      this.bizTabCodeDis = false;\n    }\n  }), (0, _defineProperty2.default)(_methods, \"atomDimensionHandle\", function atomDimensionHandle() {\n    var _this5 = this;\n\n    if (this.form.bizCalcSql !== null) {\n      var _this = this.$refs.dimensionPage;\n      _this.keepHistory = this.form.keepHistory;\n\n      if (this.form.bizTabCode === null) {\n        this.bizTabCodeDis = true;\n      }\n      /* const paramSql = {\n        bizCalcSql: this.form.bizCalcSql\n      }\n      bizCalcSqlVali(paramSql).then(data => {\n        if (data.code === 0) {\n         } else {\n          this.$message(data.msg)\n        }\n      })*/\n\n\n      var param = {\n        bizCalcSql: this.form.bizCalcSql,\n        bizCode: this.form.bizCode,\n        keepHistory: this.form.keepHistory,\n        bizTabCode: this.form.bizTabCode,\n        targetDataSource: this.form.targetDataSource\n      };\n      (0, _indAtomInfo.getDimensions)(param).then(function (data) {\n        if (data.code === 0) {\n          _this.atomDimensions = data.data;\n          _this.dimensionDialog = true;\n        } else {\n          _this5.$message(data.msg);\n        }\n      });\n      (0, _indIndicatorInfo.getDimInfo)().then(function (data) {\n        _this.dimensions = data.data;\n      });\n      /* const colParam = {\n        'id': this.form.targetDataSource,\n        'tablename': this.form.bizTabCode\n        /!* 'data_type': this.form.filterColumn*!/\n      }*/\n\n      if (this.form.bizTabCode !== null) {\n        (0, _indAtomInfo.getColumnByTabel)(this.form.targetDataSource, this.form.bizTabCode).then(function (data) {\n          _this.colCodes = data.data;\n        });\n        /* getColumns(colParam).then(data => {\n          if (data.code === 0) {\n            _this.colCodes = data.data\n            console.log(data.data)\n          } else {\n            _this.colCodes = []\n            alert('数据源连接错误')\n          }\n        })*/\n      } else {\n        this.bizTabCodeDis = true;\n      }\n    }\n  }), (0, _defineProperty2.default)(_methods, \"getAtomDimensions\", function getAtomDimensions(data) {\n    this.form.atomDimensions = data;\n  }), (0, _defineProperty2.default)(_methods, \"handleCategoryClick\", function handleCategoryClick(data) {\n    this.crud.form.categoryId = data.id;\n    this.crud.query.categoryIds = data.childrenIds;\n    this.form.categoryId = data.id;\n    this.crud.refresh();\n  }), (0, _defineProperty2.default)(_methods, \"dataSourceChangeHandle\", function dataSourceChangeHandle(val) {\n    var _this6 = this;\n\n    this.form.bizTabCode = null;\n    /* const param = {\n      id: val\n    }\n    getTables(param).then(data => {\n      this.tableInfo = data.data\n    })*/\n    // 通过数据源id查询表\n\n    (0, _indAtomInfo.getTablesById)(val).then(function (data) {\n      _this6.tableInfo = data.data;\n    });\n  }), (0, _defineProperty2.default)(_methods, \"toSourceDataName\", function toSourceDataName(row) {\n    var name = '';\n    this.sourceData.forEach(function (row1) {\n      if (row1.id === row.sourceDataSource) {\n        name = row1.datasourceName;\n      }\n    });\n    return name;\n  }), (0, _defineProperty2.default)(_methods, \"toTargetDataName\", function toTargetDataName(row) {\n    var name = '';\n    this.sourceData.forEach(function (row1) {\n      if (row1.id === row.targetDataSource) {\n        name = row1.datasourceName;\n      }\n    });\n    return name;\n  }), (0, _defineProperty2.default)(_methods, \"processA\", function processA(data) {\n    var bizCodes = [];\n\n    for (var i = 0; i < data.length; i++) {\n      bizCodes.push(data[i].bizCode);\n    }\n\n    this.processParam.codes = bizCodes;\n    this.processDialog = true;\n  }), (0, _defineProperty2.default)(_methods, \"processB\", function processB() {\n    var _this7 = this;\n\n    if (this.dateValue === '') {\n      this.crud.notify('日期不能为空', _crud.default.NOTIFICATION_TYPE.ERROR);\n    } else {\n      var dateValue = this.dateFormat(this.dateValue, 'YYYYMMDD');\n      this.processParam.periodDate = dateValue;\n      (0, _indIndicatorInfo.process)(this.processParam, 'atom').then(function (data) {\n        if (data.code === 0) {\n          _this7.crud.notify(data.msg, _crud.default.NOTIFICATION_TYPE.SUCCESS);\n        } else {\n          _this7.crud.notify(data.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n        }\n\n        _this7.processDialog = false;\n      });\n    }\n  }), _methods)\n};\nexports.default = _default;",null]}