{"remainingRequest":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\approve.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\indicator\\approve.vue","mtime":1612770274000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nvar _indIndicatorInfo = _interopRequireWildcard(require(\"../../../api/indicators/indIndicatorInfo\"));\n\nvar _crud = _interopRequireWildcard(require(\"@crud/crud\"));\n\nvar _RR = _interopRequireDefault(require(\"@crud/RR.operation\"));\n\nvar _ACRUD = _interopRequireDefault(require(\"@crud/ACRUD.operation\"));\n\nvar _UD = _interopRequireDefault(require(\"@crud/UD.operation\"));\n\nvar _Pagination = _interopRequireDefault(require(\"@crud/Pagination\"));\n\nvar _checkApproves = _interopRequireDefault(require(\"./approve/checkApproves\"));\n\nvar _checkApprove = _interopRequireDefault(require(\"./approve/checkApprove\"));\n\nvar _lookApproveDetails = _interopRequireDefault(require(\"./details/lookApproveDetails\"));\n\nvar _dept = require(\"@system/api/system/dept\");\n\nvar _methods;\n\n// crud交由presenter持有\nvar defaultCrud = (0, _crud.default)({\n  title: '指标基本信息',\n  url: _indIndicatorInfo.default.url,\n  sort: 'id,desc',\n  crudMethod: (0, _objectSpread2.default)({}, _indIndicatorInfo.default.method)\n});\nvar _default = {\n  name: 'IndIndicatorInfo',\n  components: {\n    pagination: _Pagination.default,\n    crudOperation: _ACRUD.default,\n    rrOperation: _RR.default,\n    udOperation: _UD.default,\n    checkApproves: _checkApproves.default,\n    checkApprove: _checkApprove.default,\n    lookDetails: _lookApproveDetails.default\n  },\n  mixins: [(0, _crud.presenter)(defaultCrud), (0, _crud.header)(), (0, _crud.crud)()],\n  dicts: ['IE_PROP', 'IE_TYPE', 'IE_METHOD', 'CALC_FREQ', 'IE_STATUS', 'IE_DATA_UNIT', 'RETENTION', 'BUTTON_NAME'],\n  data: function data() {\n    return {\n      table: {\n        columns: {\n          id: 'hidden'\n          /* crtOrgCode: 'hidden',\n          updOrgCode: 'hidden',*/\n\n        }\n      },\n      permission: {\n        upLine: ['admin', 'baseIndIndicatorInfo:upLine'],\n        startUsing: ['admin', 'baseIndIndicatorInfo:startUsing'],\n        add: ['admin', 'indIndicatorInfo:add'],\n        edit: ['admin', 'indIndicatorInfo:edit'],\n        del: ['admin', 'indIndicatorInfo:del']\n      }\n    };\n  },\n  methods: (_methods = {}, (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeRefresh, function () {\n    /* this.query.status = this.$route.query.status,*/\n    this.query.queryType = '2';\n    return true;\n  }), (0, _defineProperty2.default)(_methods, \"approve\", function approve(row) {\n    var _this2 = this;\n\n    var ieCodes = [];\n    var _this = this.$refs.checkApprove; // 打开审批页面时通过ieCode去查询取值规则\n\n    var indDeriveRule = {\n      ieCode: row.ieCode\n    };\n    ieCodes.push(row.ieCode);\n\n    if (row.status == 2) {\n      // 开发校验通过后执行审批\n      // 基础指标验证\n      if (row.ieType == 1) {\n        (0, _indIndicatorInfo.getIndBaseRule)(ieCodes).then(function (returnData) {\n          if (returnData.code !== 0) {\n            _this2.crud.notify(returnData.msg + '指标未进行开发', _crud.default.NOTIFICATION_TYPE.ERROR);\n          } else {\n            /* getIndDeriveRuleByIeCode(indDeriveRule).then(data => {\n               if (data.code === 0) {\n                 _this.$set(_this.form, 'calcRule', data.data.ruleDesc)\n               }\n             })*/\n            (0, _dept.getDepts)({\n              enabled: true\n            }).then(function (res) {\n              _this.depts = res.content;\n            });\n            _this.title = '审批';\n            _this.form = row;\n            _this.approveDialog = true;\n          }\n        });\n      } // 衍生指标 验证是否可以上线\n\n\n      if (row.ieType == 2) {\n        (0, _indIndicatorInfo.getIndDeriveRule)(ieCodes).then(function (returnData) {\n          if (returnData.code !== 0) {\n            _this2.crud.notify(returnData.msg + '指标未进行开发', _crud.default.NOTIFICATION_TYPE.ERROR);\n          } else {\n            /* getIndDeriveRuleByIeCode(indDeriveRule).then(data => {\n              if (data.code === 0) {\n                _this.$set(_this.form, 'calcRule', data.data.ruleDesc)\n              }\n            })*/\n            (0, _dept.getDepts)({\n              enabled: true\n            }).then(function (res) {\n              _this.depts = res.content;\n            });\n            _this.title = '审批';\n            _this.form = row;\n            _this.approveDialog = true;\n          }\n        });\n      }\n    } else {\n      /* getIndDeriveRuleByIeCode(indDeriveRule).then(data => {\n        if (data.code === 0) {\n          _this.$set(_this.form, 'calcRule', data.data.ruleDesc)\n        }\n      })*/\n      (0, _dept.getDepts)({\n        enabled: true\n      }).then(function (res) {\n        _this.depts = res.content;\n      });\n      _this.title = '审批';\n      _this.form = row;\n      _this.approveDialog = true;\n    }\n  }), (0, _defineProperty2.default)(_methods, \"upLine\", function upLine(data) {\n    var _this3 = this;\n\n    var temp = 0;\n    var param = [];\n    var ieCodes = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择0-已审批\n      if (data[i].status != 2) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'status': '4'\n      };\n      param.push(indIndicatorInfo);\n      ieCodes.push(data[i].ieCode);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择已审批的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    } // 开发校验通过后执行审批\n\n\n    (0, _indIndicatorInfo.getIndBaseRule)(ieCodes).then(function (returnData) {\n      if (returnData.code !== 0) {\n        _this3.crud.notify(returnData.msg + '指标未进行开发', _crud.default.NOTIFICATION_TYPE.ERROR);\n      } else {\n        _this3.$confirm(\"\\u786E\\u5B9A\\u4E0A\\u7EBF\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          // 开发校验通过后,修改状态\n          (0, _indIndicatorInfo.updateStatus)(param).then(function (returnData) {\n            if (returnData.code === 0) {\n              _this3.crud.notify('操作成功', _crud.default.NOTIFICATION_TYPE.SUCCESS);\n\n              _this3.crud.toQuery();\n            } else {\n              _this3.crud.notify('操作失败!错误原因:' + returnData.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n\n              _this3.crud.toQuery();\n            }\n          });\n        });\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, \"startUsing\", function startUsing(data) {\n    var _this4 = this;\n\n    var temp = 0;\n    var param = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择4-已上线，不能啟用6-停用的数据\n      if (data[i].status != 4) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'status': '5'\n      };\n      param.push(indIndicatorInfo);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择已上线的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    this.$confirm(\"\\u786E\\u5B9A\\u542F\\u7528\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    }).then(function () {\n      (0, _indIndicatorInfo.updateStatus)(param).then(function (returnData) {\n        if (returnData.code === 0) {\n          _this4.crud.notify('操作成功', _crud.default.NOTIFICATION_TYPE.SUCCESS);\n\n          _this4.crud.toQuery();\n        } else {\n          _this4.crud.notify('操作失败!错误原因:' + returnData.msg, _crud.default.NOTIFICATION_TYPE.ERROR);\n\n          _this4.crud.toQuery();\n        }\n      });\n    });\n  }), (0, _defineProperty2.default)(_methods, \"approves\", function approves(data) {\n    var _this5 = this;\n\n    var temp = 0;\n    var ieCodes = [];\n    var _this = this.$refs.checkApproves;\n    _this.title = '审批';\n\n    for (var i = 0; i < data.length; i++) {\n      var indIndicatorInfo = {\n        'id': data[i].id\n      };\n\n      for (var j = 0; j < data.length; j++) {\n        if (data[i].status != data[j].status) {\n          temp = -1;\n        }\n      }\n\n      _this.param.push(indIndicatorInfo);\n\n      ieCodes.push(data[i].ieCode);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择状态一致的数据', _crud.default.NOTIFICATION_TYPE.ERROR);\n      _this.approveDialog = false;\n      return false;\n    } else {\n      if (data[0].status == 2) {\n        // 判断是否已开发具备上线\n        // 判断是基础指标1 还是 衍生指标2\n        if (data[0].ieType == 1) {\n          (0, _indIndicatorInfo.getIndBaseRule)(ieCodes).then(function (returnData) {\n            if (returnData.code !== 0) {\n              _this5.crud.notify(returnData.msg + '指标未进行开发', _crud.default.NOTIFICATION_TYPE.ERROR);\n\n              _this.approveDialog = false;\n            } else {\n              _this.approveDialog = true;\n            }\n          });\n        }\n\n        if (data[0].ieType == 2) {\n          // 开发校验通过后执行审批\n          (0, _indIndicatorInfo.getIndDeriveRule)(ieCodes).then(function (returnData) {\n            if (returnData.code !== 0) {\n              _this5.crud.notify(returnData.msg + '指标未进行开发', _crud.default.NOTIFICATION_TYPE.ERROR);\n\n              _this.approveDialog = false;\n            } else {\n              _this.approveDialog = true;\n            }\n          });\n        }\n      } else {\n        _this.approveDialog = true;\n      }\n    }\n\n    _this.form.status = data[0].status;\n  }), (0, _defineProperty2.default)(_methods, \"details\", function details(row) {\n    var _this = this.$refs.lookDetails; // 打开详情页面时通过ieCode去查询取值规则\n\n    var indDeriveRule = {\n      ieCode: row.ieCode\n    };\n    (0, _indIndicatorInfo.getIndDeriveRuleByIeCode)(indDeriveRule).then(function (data) {\n      if (data.code === 0) {\n        _this.$set(_this.form, 'calcRule', data.data.ruleDesc);\n      }\n    });\n    (0, _dept.getDepts)({\n      enabled: true\n    }).then(function (res) {\n      _this.depts = res.content;\n    });\n    _this.title = '详情';\n    _this.form = row;\n    _this.detailsDialog = true;\n  }), _methods)\n};\nexports.default = _default;",null]}