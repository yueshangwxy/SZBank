{"remainingRequest":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\eladmin-system\\src\\views\\system\\role\\form1.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\eladmin-system\\src\\views\\system\\role\\form1.vue","mtime":1647917128245},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1647917137429}],"contextDependencies":[],"result":["import \"core-js/modules/web.dom.iterable\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { getDepts } from \"../../../api/system/dept\";\nimport request from '@eladmin/utils/request';\nimport qs from 'qs';\nexport default {\n  data: function data() {\n    return {\n      loading: false,\n      dialog: false,\n      title: '',\n      roleId: '',\n      roleLevel: '',\n      tree: {\n        defaultProps: {\n          children: 'children',\n          label: 'name'\n        },\n        data: [],\n        deptNam: '',\n        loading: true,\n        menuIds: []\n      },\n      table: {\n        query: {\n          blurry: '',\n          deptId: '',\n          enabled: true\n        },\n        data: [],\n        loading: false,\n        total: 0,\n        page: 0,\n        size: 10\n      },\n      tag: {\n        data: []\n      },\n      userIds: []\n    };\n  },\n  computed: {},\n  created: function created() {},\n  methods: {\n    // 获取左侧部门数据\n    getDeptDatas: function getDeptDatas() {\n      var _this2 = this;\n\n      this.tree.loading = false;\n      var sort = 'id,desc';\n      var params = {\n        sort: sort,\n        maxLevel: null\n      };\n\n      if (this.tree.deptName) {\n        params['name'] = this.tree.deptNam;\n      }\n\n      getDepts(params).then(function (res) {\n        _this2.tree.data = res.content;\n        _this2.tree.loading = false;\n      });\n    },\n    // 切换部门\n    handleNodeClick: function handleNodeClick(data) {\n      if (data.pid === 0) {\n        this.table.query.deptId = null;\n      } else {\n        this.table.query.deptId = data.id;\n      }\n\n      this.toQueryUser();\n    },\n    toQueryUser: function toQueryUser() {\n      var _this3 = this;\n\n      var _this = this;\n\n      _this.table.loading = true;\n      var sort = 'id,desc';\n      this.params = {\n        page: this.table.page,\n        size: this.table.size,\n        sort: sort\n      };\n      this.params['blurry'] = _this.table.query.blurry;\n      this.params['deptId'] = _this.table.query.deptId;\n      this.params['enabled'] = _this.table.query.enabled;\n      request({\n        url: '/api/users/list' + '?' + qs.stringify(_this.params, {\n          indices: false\n        }),\n        method: 'get'\n      }).then(function (res) {\n        _this.table.data = res.content;\n        _this.table.total = res.totalElements;\n        _this.table.loading = false;\n\n        if (_this.table.total > 0) {\n          _this3.$nextTick(function () {\n            _this.table.data.forEach(function (row) {\n              if (_this3.userIds.indexOf(row.id) >= 0) {\n                _this3.$refs.userTable.toggleRowSelection(row, true);\n              } else {\n                _this3.$refs.userTable.toggleRowSelection(row, false);\n              }\n            });\n          });\n        } // this.$refs.userTable.toggleRowSelection(_this.table.data[0],true)\n        // TODO 默认选中用户未处理\n        // _this.tag.data.forEach(row => {\n        // console.info(_this.table.data[1])\n        // this.$refs.userTable.toggleAllSelection()\n        // this.$refs.userTable.toggleRowSelection(this.table.data[0])\n        // });\n        // console.info(this.hasSelectList)\n        // this.table.data.forEach(row => {\n        //   if(this.hasSelectList.indexOf(row.ID) >= 0){\n        //     console.info(row.ID)\n        //     console.info(row)\n        //     this.$refs.userTable.toggleRowSelection(row,true);\n        //   }\n        // })\n\n      });\n    },\n    userPageChange: function userPageChange(e) {\n      this.table.page = e - 1;\n      this.toQueryUser();\n    },\n    userSizeChange: function userSizeChange(e) {\n      this.table.page = 0;\n      this.table.size = e;\n      this.toQueryUser();\n    },\n    onUserSelected: function onUserSelected(selection, row) {\n      if (selection.indexOf(row) >= 0) {\n        if (this.userIds.indexOf(row.id) < 0) {\n          this.tag.data.push(row);\n          this.userIds.push(row.id);\n        }\n      } else {\n        if (this.userIds.indexOf(row.id) >= 0) {\n          this.tag.data.splice(this.userIds.indexOf(row.id), 1);\n          this.userIds.splice(this.userIds.indexOf(row.id), 1);\n        }\n      }\n    },\n    onUserSelectedAll: function onUserSelectedAll(selection) {\n      var _this4 = this;\n\n      if (selection.length > 0) {\n        selection.forEach(function (row) {\n          if (_this4.userIds.indexOf(row.id) < 0) {\n            _this4.tag.data.push(row);\n\n            _this4.userIds.push(row.id);\n          }\n        });\n      } else {\n        this.table.data.forEach(function (row) {\n          if (_this4.userIds.indexOf(row.id) >= 0) {\n            _this4.tag.data.splice(_this4.userIds.indexOf(row.id), 1);\n\n            _this4.userIds.splice(_this4.userIds.indexOf(row.id), 1);\n          }\n        });\n      }\n    },\n    getUserByRoleId: function getUserByRoleId() {\n      var _this5 = this;\n\n      var _this = this;\n\n      request({\n        url: '/api/roles/queryUserByRole' + '?' + qs.stringify({\n          'roleId': this.roleId\n        }, {\n          indices: false\n        }),\n        method: 'get'\n      }).then(function (res) {\n        _this.tag.data = res;\n        _this.userIds = [];\n\n        _this.tag.data.forEach(function (row) {\n          _this5.userIds.push(row.id);\n        });\n      });\n    },\n    tagHandleClose: function tagHandleClose(tag) {\n      var _this6 = this;\n\n      console.log('tagHandleClose:', tag, this.tag.data, this.userIds);\n      this.tag.data.splice(this.tag.data.indexOf(tag), 1);\n      this.userIds.splice(this.userIds.indexOf(tag.id), 1);\n      this.$nextTick(function () {\n        _this6.table.data.forEach(function (row) {\n          if (tag.id == row.id) {\n            _this6.$refs.userTable.toggleRowSelection(row, false);\n          }\n        });\n      });\n    },\n    cancel: function cancel() {\n      this.title = '';\n      this.roleId = '';\n      this.roleLevel = '';\n      this.dialog = false;\n      this.table.data = [];\n    },\n    doSubmit: function doSubmit() {\n      var _this7 = this;\n\n      // var _this = this\n      this.loading = true;\n      request({\n        url: '/api/roles/saveUserRoles' + '?' + qs.stringify({\n          'roleId': this.roleId,\n          'userIds': this.userIds\n        }, {\n          indices: false\n        }),\n        method: 'post'\n      }).then(function (res) {\n        _this7.loading = false;\n\n        _this7.$notify({\n          title: '保存成功',\n          type: 'success',\n          duration: 2500\n        });\n\n        _this7.dialog = false;\n      });\n    }\n  }\n};",null]}