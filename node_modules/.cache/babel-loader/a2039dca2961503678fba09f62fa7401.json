{"remainingRequest":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\dimension\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\src\\views\\indicators\\dimension\\index.vue","mtime":1619491437000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\workspace-suzhouzhibiao\\Indicator\\Pncui-Indicator\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nvar _interopRequireWildcard = require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/interopRequireWildcard\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _defineProperty2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/workspace-suzhouzhibiao/Indicator/Pncui-Indicator/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nvar _indDimension = _interopRequireWildcard(require(\"../../../api/indicators/indDimension\"));\n\nvar _crud = _interopRequireWildcard(require(\"@crud/crud\"));\n\nvar _RR = _interopRequireDefault(require(\"@crud/RR.operation\"));\n\nvar _CRUD = _interopRequireDefault(require(\"@crud/CRUD.operation\"));\n\nvar _UD = _interopRequireDefault(require(\"@crud/UD.operation\"));\n\nvar _Pagination = _interopRequireDefault(require(\"@crud/Pagination\"));\n\nvar _indIndicatorInfo = require(\"../../../api/indicators/indIndicatorInfo\");\n\nvar _indDataTable = require(\"@datasource/api/datasources/indDataTable\");\n\nvar _indDataColumn = require(\"@datasource/api/datasources/indDataColumn\");\n\nvar _dimData = _interopRequireDefault(require(\"../dimension/dimData\"));\n\nvar _methods;\n\n// crud交由presenter持有\nvar defaultCrud = (0, _crud.default)({\n  title: '维度管理',\n  url: _indDimension.default.url,\n  sort: 'id,desc',\n  crudMethod: (0, _objectSpread2.default)({}, _indDimension.default.method)\n});\nvar defaultForm = {\n  id: null,\n  dimCode: null,\n  datasourceId: null,\n  dimName: null,\n  tableName: null,\n  nameColumn: null,\n  nameColumnDesc: null,\n  codeColumn: null,\n  codeColumnDesc: null,\n  pid: null,\n  dimLevel: null,\n  alias: null,\n  pkFlag: null,\n  crtUserCode: null,\n  crtOrgCode: null,\n  crtDate: null,\n  updUserCode: null,\n  updOrgCode: null,\n  updDate: null,\n  filterColumn: null,\n  filterValue: null\n};\nvar _default = {\n  name: 'IndDimension',\n  components: {\n    pagination: _Pagination.default,\n    crudOperation: _CRUD.default,\n    rrOperation: _RR.default,\n    udOperation: _UD.default,\n    dimData: _dimData.default\n  },\n  mixins: [(0, _crud.presenter)(defaultCrud), (0, _crud.header)(), (0, _crud.form)(defaultForm), (0, _crud.crud)()],\n  data: function data() {\n    return {\n      table: {\n        columns: {\n          id: 'hidden',\n          datasourceId: 'hidden',\n          nameColumn: 'hidden',\n          nameColumnDesc: 'hidden',\n          codeColumn: 'hidden',\n          codeColumnDesc: 'hidden',\n          alias: 'hidden',\n          pkFlag: 'hidden',\n          filterColumn: 'hidden',\n          filterValue: 'hidden'\n        }\n      },\n      tableData: [],\n      tableInfo: [],\n      tableDB: [],\n      DictDB: [],\n      selectData: [],\n      screenData: [],\n      showDimInfo: false,\n      permission: {\n        add: ['admin', 'indDimension:add'],\n        edit: ['admin', 'indDimension:edit'],\n        del: ['admin', 'indDimension:del'],\n        showAllDimCode: ['admin', 'indDimension:showAllDimCode'],\n        details: ['admin', 'indDimension:details']\n      },\n      rules: {\n        dimCode: [{\n          required: true,\n          message: '维度编号不能为空',\n          trigger: 'blur'\n        }],\n        dimName: [{\n          required: true,\n          message: '维度名称不能为空',\n          trigger: 'blur'\n        }],\n        tableName: [{\n          required: true,\n          message: '维表表名称不能为空',\n          trigger: 'blur'\n        }],\n        codeColumn: [{\n          required: true,\n          message: '代码字段不能为空',\n          trigger: 'blur'\n        }],\n        codeColumnDesc: [{\n          required: true,\n          message: '代码字段描述不能为空',\n          trigger: 'blur'\n        }],\n        nameColumn: [{\n          required: true,\n          message: '显示字段不能为空',\n          trigger: 'blur'\n        }],\n        nameColumnDesc: [{\n          required: true,\n          message: '显示字段描述不能为空',\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  created: function created() {\n    var _this2 = this;\n\n    this.$nextTick(function () {\n      (0, _indIndicatorInfo.getAllSource)().then(function (data) {\n        // console.log(\"=====getAllSource====>>>>\",data)\n        if (data.code === 0) {\n          _this2.tableDB = data.data;\n        } else {\n          _this2.$message.error({\n            message: '获取数据失败'\n          });\n        }\n      });\n      (0, _indDataTable.getTableListById)('all').then(function (data) {\n        if (data.code === 0) {\n          _this2.DictDB = data.data;\n        } else {\n          _this2.$message.error({\n            message: '获取数据失败'\n          });\n        }\n      });\n    });\n  },\n  methods: (_methods = {}, (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeRefresh, function () {\n    return true;\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToAdd, function () {\n    var _this3 = this;\n\n    this.tableData = [];\n    this.tableInfo = [];\n    this.form.datasourceId = 'local';\n    (0, _indDataTable.getTableListById)(this.form.datasourceId).then(function (data) {\n      if (data.code === 0) {\n        _this3.tableData = data.data;\n      } else {\n        _this3.clearFrom();\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeToEdit, function () {\n    var _this4 = this;\n\n    (0, _indDataTable.getTableListById)(this.form.datasourceId).then(function (data) {\n      // console.log(\"====getTables====>>>>>\",data)\n      if (data.code === 0) {\n        _this4.tableData = data.data;\n      } else {\n        _this4.tableData = [];\n      }\n    });\n    (0, _indDataColumn.getColumnListByDataSourceIdAndTableName)(this.form.datasourceId, this.form.tableName).then(function (data) {\n      // console.log(\"========getColumns====>>>>\",data)\n      if (data.code === 0) {\n        if (data.data.length === 0) {\n          _this4.$message.error({\n            message: '表' + _this4.form.tableName + '不存在'\n          });\n        }\n\n        _this4.tableInfo = data.data;\n      } else {\n        _this4.tableInfo = [];\n      }\n    });\n\n    if (this.form.filterColumn !== null && this.form.filterColumn !== '') {\n      var temp = this.form.filterValue;\n      var tempArray = [];\n\n      if (temp !== null && temp !== '' && temp.indexOf(',') !== -1) {\n        tempArray = temp.split(',');\n      } else if (temp !== null && temp !== '') {\n        tempArray.push(temp);\n      }\n\n      this.form.filterValue = tempArray;\n      (0, _indDimension.getValueListByTableAndColumn)(this.form.tableName, this.form.filterColumn, this.form.datasourceId).then(function (data) {\n        if (data.code === 0) {\n          _this4.screenData = data.data;\n        } else {\n          _this4.$message.error({\n            message: '表' + _this4.form.tableName + '或列' + _this4.form.filterColumn + '不存在'\n          });\n        }\n      });\n    }\n  }), (0, _defineProperty2.default)(_methods, _crud.default.HOOK.beforeSubmit, function () {\n    if (this.form.filterValue !== null && this.form.filterValue !== '') {\n      this.form.filterValue = String(this.form.filterValue);\n    }\n  }), (0, _defineProperty2.default)(_methods, \"getTableInfo\", function getTableInfo() {\n    var _this5 = this;\n\n    this.form.nameColumn = '';\n    this.form.nameColumnDesc = '';\n    this.form.codeColumn = '';\n    this.form.codeColumnDesc = '';\n    this.form.filterColumn = '';\n    this.form.filterValue = '';\n    (0, _indDataColumn.getColumnListByDataSourceIdAndTableName)(this.form.datasourceId, this.form.tableName).then(function (data) {\n      // console.log(\"========getColumns====>>>>\",data)\n      if (data.code === 0) {\n        if (data.data.length === 0) {\n          _this5.$message.error({\n            message: '表' + _this5.form.tableName + '不存在'\n          });\n        }\n\n        _this5.tableInfo = data.data;\n      } else {\n        _this5.tableInfo = [];\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, \"getListData\", function getListData() {\n    var _this6 = this;\n\n    this.form.filterValue = '';\n\n    if (this.form.filterColumn !== null && this.form.filterColumn !== '') {\n      (0, _indDimension.getValueListByTableAndColumn)(this.form.tableName, this.form.filterColumn, this.form.datasourceId).then(function (data) {\n        if (data.code === 0) {\n          _this6.screenData = data.data;\n        } else {\n          _this6.$message.error({\n            message: '表' + _this6.form.tableName + '或列' + _this6.form.filterColumn + '不存在'\n          });\n        }\n      });\n    }\n  }), (0, _defineProperty2.default)(_methods, \"setColumnDesc\", function setColumnDesc() {\n    var _this7 = this;\n\n    this.tableInfo.forEach(function (row) {\n      if (_this7.form.nameColumn === row.columnName) {\n        _this7.form.nameColumnDesc = row.columnDesc;\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, \"setCodeDesc\", function setCodeDesc() {\n    var _this8 = this;\n\n    this.tableInfo.forEach(function (row) {\n      if (_this8.form.codeColumn === row.columnName) {\n        _this8.form.codeColumnDesc = row.columnDesc;\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, \"getTableByDB\", function getTableByDB() {\n    var _this9 = this;\n\n    this.clearFrom();\n    (0, _indDataTable.getTableListById)(this.form.datasourceId).then(function (data) {\n      if (data.code === 0) {\n        _this9.tableData = data.data;\n      } else {\n        _this9.clearFrom();\n      }\n    });\n  }), (0, _defineProperty2.default)(_methods, \"clearFrom\", function clearFrom() {\n    this.form.nameColumn = '';\n    this.form.nameColumnDesc = '';\n    this.form.tableName = '';\n    this.form.codeColumn = '';\n    this.form.codeColumnDesc = '';\n    this.form.filterColumn = '';\n    this.form.filterValue = '';\n    this.tableData = [];\n    this.tableInfo = [];\n  }), (0, _defineProperty2.default)(_methods, \"formatId\", function formatId(row) {\n    var name = '';\n    this.tableDB.forEach(function (row1) {\n      if (row1.id === row.datasourceId) {\n        name = row1.datasourceName;\n      }\n    });\n    return name;\n  }), (0, _defineProperty2.default)(_methods, \"formatTableName\", function formatTableName(row) {\n    var name = '';\n    this.DictDB.forEach(function (row1) {\n      if (row1.tableName === row.tableName) {\n        name = row1.tableDesc;\n      }\n    });\n    return name;\n  }), (0, _defineProperty2.default)(_methods, \"handleInfo\", function handleInfo(row) {\n    this.form.id = row.id;\n    this.form.dimCode = row.dimCode;\n    this.form.datasourceId = row.datasourceId;\n    this.form.dimName = row.dimName;\n    this.form.tableName = row.tableName;\n    this.form.codeColumn = row.codeColumn;\n    this.form.codeColumnDesc = row.codeColumnDesc;\n    this.form.nameColumn = row.nameColumn;\n    this.form.nameColumnDesc = row.nameColumnDesc;\n    this.form.pid = row.pid;\n    this.form.dimLevel = row.dimLevel;\n    this.form.filterColumn = row.filterColumn;\n    this.form.filterValue = row.filterValue;\n    this.form.alias = row.alias;\n    this.form.pkFlag = row.pkFlag;\n    this.form.crtUserCode = row.crtUserCode;\n    this.form.crtOrgCode = row.crtOrgCode;\n    this.form.crtDate = this.parseTime(row.crtDate);\n    this.form.updUserCode = row.updUserCode;\n    this.form.updOrgCode = row.updOrgCode;\n    this.form.updDate = this.parseTime(row.updDate);\n    this.showDimInfo = true;\n  }), (0, _defineProperty2.default)(_methods, \"showAllDimCode\", function showAllDimCode(data) {\n    var _this = this.$refs.dimData;\n    _this.query.tableName = data.tableName;\n    _this.query.columnDimCode = data.dimCode;\n    _this.query.columnDimName = data.dimName;\n    _this.query.columnCodeColumn = data.codeColumn;\n    _this.query.columnNameColumn = data.nameColumn;\n    _this.query.columnDimLevel = data.dimLevel;\n    _this.query.columnFilterColumn = data.filterColumn;\n    _this.query.columnPid = data.pid;\n    _this.tCode = data.codeColumnDesc;\n    _this.tName = data.nameColumnDesc;\n    var temp = String(data.filterValue);\n    _this.query.queryFilter = temp;\n\n    if (temp !== null && temp !== '' && temp.indexOf(',') !== -1) {\n      _this.filterValue = temp.split(',');\n    } else {\n      _this.filterValue.push(temp);\n    }\n\n    _this.searchDimData();\n\n    _this.showAllDim = true;\n  }), _methods)\n};\nexports.default = _default;",null]}