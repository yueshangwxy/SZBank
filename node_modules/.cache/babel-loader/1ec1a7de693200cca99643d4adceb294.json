{"remainingRequest":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\auth\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\auth\\index.vue","mtime":1647917138741},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1647917137429}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/code/DataAssetPlatform/Pncui-Ind/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es7.array.includes\");\n\nrequire(\"core-js/modules/es6.string.includes\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _request = _interopRequireDefault(require(\"@/utils/request\"));\n\nvar _qs = _interopRequireDefault(require(\"qs\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'Auth',\n  dicts: ['DATA_AUTH_TYPE'],\n  data: function data() {\n    return {\n      authActiveName: 'role',\n      menuActiveName: 'admin',\n      currentType: 'role',\n      currentId: '',\n      currentRoleLevel: null,\n      menuTreeDefaultProps: {\n        children: 'children',\n        label: 'name'\n      },\n      deptTab: {\n        query: {\n          name: '',\n          id: ''\n        },\n        data: [],\n        loading: false\n      },\n      roleTab: {\n        query: {\n          blurry: ''\n        },\n        data: [],\n        loading: true,\n        total: 0,\n        page: 0,\n        size: 10\n      },\n      userTab: {\n        query: {\n          blurry: ''\n        },\n        data: [],\n        loading: true,\n        total: 0,\n        page: 0,\n        size: 10\n      },\n      adminTab: {\n        menuLoading: false,\n        data: [],\n        loading: false,\n        operators: [],\n        strictly: true\n      },\n      indexTab: {\n        menuLoading: false,\n        data: [],\n        loading: false,\n        operators: [],\n        strictly: true\n      },\n      indexOrgTab: {\n        menuLoading: false,\n        data: [],\n        loading: false,\n        operators: [],\n        strictly: true\n      }\n    };\n  },\n  mounted: function mounted() {\n    this.toQueryRole(); // this.getAdminmenus()\n  },\n  methods: {\n    authHandleClick: function authHandleClick(tab, event) {\n      if (tab.name === 'dept') {\n        this.currentType = 'dept';\n        this.$refs.adminMenuTree.setCheckedKeys([]);\n        this.toQueryDept();\n      } else if (tab.name === 'role') {\n        this.currentType = 'role';\n        this.$refs.adminMenuTree.setCheckedKeys([]);\n        this.toQueryRole();\n      } else if (tab.name === 'user') {\n        this.currentType = 'user';\n        this.$refs.adminMenuTree.setCheckedKeys([]);\n        this.toQueryUser();\n      }\n    },\n    menuHandleClick: function menuHandleClick(tab, event) {// this.getAdminmenus()\n    },\n    // 机构权限配置\n    toQueryDept: function toQueryDept() {\n      var _this = this;\n\n      _this.deptTab.loading = true; // _this.deptTab.data = [];\n\n      (0, _request.default)({\n        url: '/api/dept' + '?' + _qs.default.stringify(_this.deptTab.query, {\n          indices: false\n        }),\n        method: 'get'\n      }).then(function (res) {\n        _this.deptTab.data = res.content;\n        _this.deptTab.loading = false; //  console.log(_this.deptTab.data)\n      });\n    },\n    onSelectDept: function onSelectDept(currentRow, oldCurrentRow) {\n      var _this2 = this;\n\n      // console.log(currentRow,oldCurrentRow)\n      if (currentRow) {\n        this.adminTab.strictly = true;\n        this.currentId = currentRow.id;\n        this.$refs.adminMenuTree.setCheckedKeys([]);\n        (0, _request.default)({\n          url: '/auths/menus' + '?' + _qs.default.stringify({\n            type: 'dept',\n            id: currentRow.id\n          }, {\n            indices: false\n          }),\n          method: 'get'\n        }).then(function (res) {\n          _this2.adminTab.data = res;\n          _this2.adminTab.loading = false;\n          _this2.adminTab.strictly = false;\n        });\n      }\n    },\n    // 角色权限配置\n    toQueryRole: function toQueryRole() {\n      var _this = this;\n\n      _this.roleTab.loading = true;\n      var sort = 'level,asc';\n      this.params = {\n        page: this.roleTab.page,\n        size: this.roleTab.size,\n        sort: sort\n      };\n      this.params['blurry'] = _this.roleTab.query.blurry;\n      (0, _request.default)({\n        url: '/api/roles' + '?' + _qs.default.stringify(_this.params, {\n          indices: false\n        }),\n        method: 'get'\n      }).then(function (res) {\n        // console.log(res.content)\n        _this.roleTab.data = res.content;\n        _this.roleTab.total = res.totalElements;\n        _this.roleTab.loading = false;\n      });\n    },\n    onSelectRole: function onSelectRole(currentRow, oldCurrentRow) {\n      var _this3 = this;\n\n      if (currentRow) {\n        this.currentId = currentRow.id;\n        this.adminTab.strictly = true;\n        this.indexOrgTab.strictly = true; // this.adminTab.loading = true\n\n        this.currentRoleLevel = currentRow.level;\n        this.$refs.adminMenuTree.setCheckedKeys([]);\n        (0, _request.default)({\n          url: '/auths/menus/role/' + currentRow.id,\n          method: 'get'\n        }).then(function (res) {\n          console.log('======get role auths::', res);\n          _this3.adminTab.data = res.auths;\n          _this3.adminTab.operators = res.operators;\n          _this3.adminTab.strictly = false; // this.adminTab.loading = false\n        });\n        (0, _request.default)({\n          url: '/auths/roleIndexs/' + currentRow.id,\n          method: 'get'\n        }).then(function (res) {\n          console.log('======get role auths::', res);\n          _this3.indexTab.data = res.ind.auths;\n          _this3.indexTab.operators = res.ind.authorizes;\n          _this3.indexTab.strictly = false;\n          _this3.indexOrgTab.data = res.org.auths;\n          _this3.indexOrgTab.operators = res.org.authorizes;\n          _this3.indexOrgTab.strictly = false; // this.adminTab.loading = false\n        });\n      }\n    },\n    rolePageChange: function rolePageChange(e) {\n      this.roleTab.page = e - 1;\n      this.toQueryRole();\n    },\n    roleSizeChange: function roleSizeChange(e) {\n      this.roleTab.page = 0;\n      this.roleTab.size = e;\n      this.toQueryRole();\n    },\n    // 用户权限配置\n    toQueryUser: function toQueryUser() {\n      var _this = this;\n\n      _this.userTab.loading = true;\n      var sort = 'id,desc';\n      this.params = {\n        page: this.userTab.page,\n        size: this.userTab.size,\n        sort: sort\n      };\n      this.params['blurry'] = _this.userTab.query.blurry;\n      (0, _request.default)({\n        url: '/api/users' + '?' + _qs.default.stringify(_this.params, {\n          indices: false\n        }),\n        method: 'get'\n      }).then(function (res) {\n        // console.log(res.content)\n        _this.userTab.data = res.content;\n        _this.userTab.total = res.totalElements;\n        _this.userTab.loading = false;\n      });\n    },\n    onSelectUser: function onSelectUser(currentRow, oldCurrentRow) {\n      var _this4 = this;\n\n      // console.log(currentRow,oldCurrentRow)\n      if (currentRow) {\n        this.adminTab.strictly = true;\n        this.currentId = currentRow.id;\n        this.$refs.adminMenuTree.setCheckedKeys([]);\n        (0, _request.default)({\n          url: '/auth/menus' + '?' + _qs.default.stringify({\n            type: 'user',\n            id: currentRow.id\n          }, {\n            indices: false\n          }),\n          method: 'get'\n        }).then(function (res) {\n          _this4.adminTab.data = res.auths;\n          _this4.adminTab.this.adminTab.strictly = false;\n        });\n      }\n    },\n    userPageChange: function userPageChange(e) {\n      this.userTab.page = e - 1;\n      this.toQueryUser();\n    },\n    userSizeChange: function userSizeChange(e) {\n      this.userTab.page = 0;\n      this.userTab.size = e;\n      this.toQueryUser();\n    },\n    // 加载admin菜单\n\n    /* getAdminmenus() {\n      var _this = this\n      request({\n        url: '/api/menus/tree',\n        method: 'get'\n      }).then(res => {\n        _this.adminTab.data = res\n        _this.adminTab.loading = false\n      })\n    },*/\n    doSaveAdminMenus: function doSaveAdminMenus() {\n      var _this5 = this;\n\n      this.adminTab.menuLoading = true; // var _this = this\n\n      var menus = [];\n      /* this.$refs.adminMenuTree.getHalfCheckedNodes().forEach(function(data, index) {\n        menus.push({id:data.id,auth:data.dataAuthType})\n      })*/\n      // 得到已选中的 key 值\n\n      console.log('=====getCheckedKeys========', menus, this.$refs.adminMenuTree.getCheckedNodes(false, true));\n      this.$refs.adminMenuTree.getCheckedNodes(false, true).forEach(function (data, index) {\n        menus.push({\n          resourceId: data.id,\n          authorizeType: '03',\n          dataAuthType: data.dataAuthType\n        });\n      });\n      (0, _request.default)({\n        url: '/auths/menus/' + this.currentType + '/' + this.currentId,\n        method: 'post',\n        data: menus\n      }).then(function (res) {\n        _this5.adminTab.menuLoading = false;\n\n        _this5.$notify({\n          title: '保存成功',\n          type: 'success',\n          duration: 2500\n        });\n      });\n    },\n    doSaveAdminIndexs: function doSaveAdminIndexs() {\n      var _this6 = this;\n\n      this.indexTab.menuLoading = true; // var _this = this\n\n      var indexs = []; // 得到已选中的 key 值\n\n      console.log('=====getCheckedKeys========', indexs, this.$refs.adminIndexTree.getCheckedNodes(false, true));\n      this.$refs.adminIndexTree.getCheckedNodes(false, true).forEach(function (data, index) {\n        indexs.push({\n          objCode: data.id,\n          objType: '1'\n        });\n      });\n      this.$refs.adminIndexOrgTree.getCheckedNodes(false, true).forEach(function (data, index) {\n        indexs.push({\n          objCode: data.id,\n          objType: '2'\n        });\n      });\n      (0, _request.default)({\n        url: '/auths/roleIndexs/' + this.currentId,\n        method: 'post',\n        data: indexs\n      }).then(function (res) {\n        _this6.indexTab.menuLoading = false;\n\n        _this6.$notify({\n          title: '保存成功',\n          type: 'success',\n          duration: 2500\n        });\n      });\n    },\n    choiceChildrenNode: function choiceChildrenNode(data, selected) {\n      var _this7 = this;\n\n      var isChecked = selected.checkedKeys.includes(data.id);\n\n      if (isChecked) {\n        if (data.children) {\n          var allChildrens = this.getAllChildren(data);\n          allChildrens.forEach(function (item) {\n            _this7.$refs.adminIndexOrgTree.setChecked(item.id, true);\n          });\n        }\n      } else {\n        if (data.children) {\n          var allChildrens = this.getAllChildren(data);\n          allChildrens.forEach(function (item) {\n            _this7.$refs.adminIndexOrgTree.setChecked(item.id, false);\n          });\n        }\n      }\n    },\n    choiceIndChildrenNode: function choiceIndChildrenNode(data, selected) {\n      var _this8 = this;\n\n      var isChecked = selected.checkedKeys.includes(data.id);\n\n      if (isChecked) {\n        if (data.children) {\n          var allChildrens = this.getAllChildren(data);\n          allChildrens.forEach(function (item) {\n            _this8.$refs.adminIndexTree.setChecked(item.id, true);\n          });\n        }\n      } else {\n        if (data.children) {\n          var allChildrens = this.getAllChildren(data);\n          allChildrens.forEach(function (item) {\n            _this8.$refs.adminIndexTree.setChecked(item.id, false);\n          });\n        }\n      }\n    },\n    getAllChildren: function getAllChildren(node) {\n      var res = [];\n      var nodes = node.children;\n\n      if (nodes != null) {\n        for (var i = 0; i < nodes.length; i++) {\n          var childNode = nodes[i];\n          res.push(childNode);\n          var temp = this.getAllChildren(childNode);\n          res = res.concat(temp);\n        }\n      }\n\n      return res;\n    }\n  }\n};\nexports.default = _default;",{"version":3,"mappings":"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","names":["name","dicts","data","authActiveName","menuActiveName","currentType","currentId","currentRoleLevel","menuTreeDefaultProps","children","label","deptTab","query","id","loading","roleTab","blurry","total","page","size","userTab","adminTab","menuLoading","operators","strictly","indexTab","indexOrgTab","mounted","methods","authHandleClick","tab","event","menuHandleClick","toQueryDept","_this","url","indices","method","then","onSelectDept","currentRow","oldCurrentRow","type","toQueryRole","sort","onSelectRole","console","rolePageChange","e","roleSizeChange","toQueryUser","onSelectUser","userPageChange","userSizeChange","doSaveAdminMenus","menus","resourceId","authorizeType","dataAuthType","title","duration","doSaveAdminIndexs","indexs","objCode","objType","choiceChildrenNode","selected","allChildrens","choiceIndChildrenNode","getAllChildren","node","res"],"sourceRoot":"src/views/indicators/auth","sources":["index.vue"],"sourcesContent":["<template>\r\n  <el-row :gutter=\"20\" style=\"height:100%\">\r\n    <div class=\"content\" style=\"height:650px !important\">\r\n      <el-col :span=\"10\">\r\n        <el-tabs v-model=\"authActiveName\" @tab-click=\"authHandleClick\">\r\n\r\n          <el-tab-pane label=\"角色\" name=\"role\">\r\n            <el-row>\r\n              <el-col>\r\n                <el-input\r\n                    v-model=\"roleTab.query.blurry\"\r\n                    clearable\r\n                    placeholder=\"输入名称或描述搜索\"\r\n                    style=\"width: 200px;\"\r\n                    class=\"filter-item\"\r\n                    @keyup.enter.native=\"toQueryRole\"\r\n                />\r\n                <el-button class=\"filter-item\" type=\"success\" icon=\"el-icon-search\" @click=\"toQueryRole\">搜索\r\n                </el-button>\r\n              </el-col>\r\n            </el-row>\r\n            <el-row>\r\n              <el-col>\r\n                <el-table\r\n                    v-loading=\"roleTab.loading\"\r\n                    :data=\"roleTab.data\"\r\n                    row-key=\"id\"\r\n                    border\r\n                    height=\"450\"\r\n                    highlight-current-row\r\n                    style=\"width: 100%;margin-top: 10px;\"\r\n                    @current-change=\"onSelectRole\"\r\n                >\r\n                  <el-table-column :show-overflow-tooltip=\"true\" prop=\"name\" label=\"角色名称\" width=\"150px\"/>\r\n                  <el-table-column prop=\"level\" label=\"角色级别\" width=\"100px\">\r\n                    <template slot-scope=\"scope\">\r\n                      {{ scope.row.level }}级\r\n                    </template>\r\n                  </el-table-column>\r\n                  <el-table-column :show-overflow-tooltip=\"true\" prop=\"remark\" label=\"描述\"/>\r\n                </el-table>\r\n                <el-pagination\r\n                    background\r\n                    :total=\"roleTab.total\"\r\n                    :current-page=\"roleTab.page + 1\"\r\n                    style=\"margin-top: 8px;\"\r\n                    layout=\"total, prev, pager, next, sizes\"\r\n                    @size-change=\"roleSizeChange\"\r\n                    @current-change=\"rolePageChange\"\r\n                />\r\n              </el-col>\r\n            </el-row>\r\n\r\n          </el-tab-pane>\r\n          <el-tab-pane v-if=\"false\" label=\"用户权限管理\" name=\"user\">\r\n            <el-input\r\n                v-model=\"userTab.query.blurry\"\r\n                clearable\r\n                placeholder=\"输入名称或邮箱搜索\"\r\n                style=\"width: 200px;\"\r\n                class=\"filter-item\"\r\n                @keyup.enter.native=\"toQueryUser\"\r\n            />\r\n            <el-button class=\"filter-item\" type=\"success\" icon=\"el-icon-search\" @click=\"toQueryUser\">搜索\r\n            </el-button>\r\n            <el-table\r\n                v-loading=\"userTab.loading\"\r\n                :data=\"userTab.data\"\r\n                row-key=\"id\"\r\n                border\r\n                height=\"398\"\r\n                highlight-current-row\r\n                style=\"width: 100%;margin-top: 10px;\"\r\n                @current-change=\"onSelectUser\"\r\n            >\r\n\r\n              <el-table-column :show-overflow-tooltip=\"true\" prop=\"username\" label=\"用户名\" width=\"100px\"/>\r\n              <el-table-column :show-overflow-tooltip=\"true\" prop=\"nickName\" label=\"姓名\" width=\"120px\"/>\r\n              <el-table-column :show-overflow-tooltip=\"true\" prop=\"email\" label=\"邮箱\" width=\"150px\"/>\r\n              <el-table-column :show-overflow-tooltip=\"true\" label=\"部门\">\r\n                <template slot-scope=\"scope\">\r\n                  <div>{{ scope.row.dept.name }}</div>\r\n                </template>\r\n              </el-table-column>\r\n            </el-table>\r\n            <el-pagination\r\n                background\r\n                :total=\"userTab.total\"\r\n                :current-page=\"userTab.page + 1\"\r\n                style=\"margin-top: 8px;\"\r\n                layout=\"total, prev, pager, next, sizes\"\r\n                @size-change=\"userSizeChange\"\r\n                @current-change=\"userPageChange\"\r\n            />\r\n          </el-tab-pane>\r\n          <el-tab-pane v-if=\"false\" label=\"机构权限管理\" name=\"dept\">\r\n            <el-input\r\n                v-model=\"deptTab.query.name\"\r\n                clearable\r\n                placeholder=\"输入机构名称搜索\"\r\n                style=\"width: 200px;\"\r\n                class=\"filter-item\"\r\n                @keyup.enter.native=\"toQueryDept\"\r\n            />\r\n            <el-input\r\n                v-model=\"deptTab.query.id\"\r\n                clearable\r\n                placeholder=\"输入机构编号搜索\"\r\n                style=\"width: 200px;\"\r\n                class=\"filter-item\"\r\n                @keyup.enter.native=\"toQueryDept\"\r\n            />\r\n            <el-button class=\"filter-item\" type=\"success\" icon=\"el-icon-search\" @click=\"toQueryDept\">搜索\r\n            </el-button>\r\n\r\n            <el-table\r\n                v-loading=\"deptTab.loading\"\r\n                :data=\"deptTab.data\"\r\n                :expand-row-keys=\"['1']\"\r\n                row-key=\"id\"\r\n                :tree-props=\"{children: 'children', hasChildren: 'hasChildren'}\"\r\n                border\r\n                height=\"430\"\r\n                highlight-current-row\r\n                style=\"width: 100%;margin-top: 10px;\"\r\n                @current-change=\"onSelectDept\"\r\n            >\r\n              <el-table-column prop=\"name\" label=\"机构名称\"/>\r\n              <el-table-column prop=\"id\" label=\"机构编号\" width=\"200px\"/>\r\n            </el-table>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-col>\r\n      <el-col :span=\"14\">\r\n        <el-tabs v-model=\"menuActiveName\">\r\n          <el-tab-pane label=\"功能权限\" name=\"admin\">\r\n            <el-row>\r\n              <el-col>\r\n                <el-button\r\n                    class=\"filter-item\"\r\n                    :loading=\"adminTab.menuLoading\"\r\n                    type=\"primary\"\r\n                    icon=\"el-icon-check\"\r\n                    @click=\"doSaveAdminMenus\"\r\n                >保存\r\n                </el-button>\r\n              </el-col>\r\n            </el-row>\r\n            <el-row style=\"margin-top: 10px\">\r\n              <el-col>\r\n                <!--                <div class=\"line\">-->\r\n                <!--                  <el-scrollbar class=\"el-tree treeScroll\">-->\r\n                <div style=\"height: 450px;overflow: scroll;background-color: white;\">\r\n                  <el-tree\r\n                      ref=\"adminMenuTree\"\r\n                      v-loading=\"adminTab.loading\"\r\n                      :data=\"adminTab.data\"\r\n                      :check-strictly=\"adminTab.strictly\"\r\n                      :default-checked-keys=\"adminTab.operators\"\r\n                      :props=\"menuTreeDefaultProps\"\r\n                      accordion\r\n                      show-checkbox\r\n                      style=\"width: 100%;height: max-content;border: none\"\r\n                      node-key=\"id\"\r\n                  >\r\n                      <span slot-scope=\"{ node, data }\" class=\"custom-tree-node\">\r\n                        <span>{{ node.label }}</span>\r\n                        <!--<span v-show=\"data.type==1\" style=\"align:right\">\r\n                          <el-radio-group v-model=\"data.dataAuthType\">\r\n                            <el-radio v-for=\"item in dict['DATA_AUTH_TYPE']\" v-if=\"isNaN(item.value) || currentRoleLevel>item.value\" :label=\"item.value\" style=\"width:60px;overflow: auto;\">{{ item.label }}</el-radio>\r\n                          </el-radio-group>\r\n                        </span>-->\r\n                      </span>\r\n                  </el-tree>\r\n\r\n                </div>\r\n                <!--                  </el-scrollbar>-->\r\n                <!--                </div>-->\r\n\r\n              </el-col>\r\n            </el-row>\r\n          </el-tab-pane>\r\n          <el-tab-pane label=\"指标数据权限\" name=\"index\">\r\n            <el-row>\r\n              <el-col>\r\n                <el-button\r\n                    class=\"filter-item\"\r\n                    :loading=\"indexTab.menuLoading\"\r\n                    type=\"primary\"\r\n                    icon=\"el-icon-check\"\r\n                    @click=\"doSaveAdminIndexs\"\r\n                >保存\r\n                </el-button>\r\n              </el-col>\r\n            </el-row>\r\n            <el-row style=\"margin-top: 10px\">\r\n              <el-col>\r\n<!--                <div class=\"line\">-->\r\n                  <el-row>\r\n                    <el-col :span=\"12\">\r\n                      <!--                      <el-scrollbar class=\"el-tree treeScroll\">-->\r\n                      <div style=\"overflow: scroll;background-color: white;height: 450px\">\r\n                        <el-tree\r\n                            ref=\"adminIndexTree\"\r\n                            v-loading=\"adminTab.loading\"\r\n                            :data=\"indexTab.data\"\r\n                            :check-strictly=\"true\"\r\n                            :default-checked-keys=\"indexTab.operators\"\r\n                            :default-expand-all=\"true\"\r\n                            :props=\"menuTreeDefaultProps\"\r\n                            @check=\"choiceIndChildrenNode\"\r\n                            show-checkbox\r\n                            style=\"width: max-content;height: max-content;border: none\"\r\n                            node-key=\"id\"\r\n                        >\r\n                <span slot-scope=\"{ node, data }\" class=\"custom-tree-node\">\r\n                  <span>{{ node.label }}</span>\r\n                  <!-- <span v-show=\"data.type==1\" style=\"align:right\">\r\n                     <el-radio-group v-model=\"data.dataAuthType\">\r\n                       <el-radio v-for=\"item in dict['DATA_AUTH_TYPE']\" v-if=\"isNaN(item.value) || currentRoleLevel>item.value\" :label=\"item.value\" style=\"width:60px;overflow: auto;\">{{ item.label }}</el-radio>\r\n                     </el-radio-group>\r\n                   </span>-->\r\n                </span>\r\n                        </el-tree>\r\n                      </div>\r\n                      <!--                      </el-scrollbar>-->\r\n                    </el-col>\r\n\r\n                    <el-col :span=\"12\">\r\n<!--                      <el-scrollbar class=\"el-tree treeScroll\">-->\r\n                      <div style=\"overflow: scroll;height: 450px;background-color: white;\">\r\n                        <el-tree\r\n                            ref=\"adminIndexOrgTree\"\r\n                            v-loading=\"indexOrgTab.loading\"\r\n                            :data=\"indexOrgTab.data\"\r\n                            :check-strictly=\"true\"\r\n                            :default-checked-keys=\"indexOrgTab.operators\"\r\n                            :default-expand-all=\"true\"\r\n                            :props=\"menuTreeDefaultProps\"\r\n                            @check=\"choiceChildrenNode\"\r\n                            show-checkbox\r\n                            style=\"width: max-content;height: max-content;border: none\"\r\n                            node-key=\"id\"\r\n                        >\r\n                    <span slot-scope=\"{ node, data }\" class=\"custom-tree-node\">\r\n                      <span>{{ node.label }}</span>\r\n                    </span>\r\n                        </el-tree>\r\n<!--                      </el-scrollbar>-->\r\n                      </div>\r\n                    </el-col>\r\n                  </el-row>\r\n<!--                </div>-->\r\n              </el-col>\r\n            </el-row>\r\n\r\n\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-col>\r\n    </div>\r\n  </el-row>\r\n</template>\r\n\r\n<script>\r\n  import request from '@/utils/request'\r\n  import qs from 'qs'\r\n\r\n  export default {\r\n    name: 'Auth',\r\n    dicts: ['DATA_AUTH_TYPE'],\r\n    data() {\r\n      return {\r\n        authActiveName: 'role',\r\n        menuActiveName: 'admin',\r\n\r\n        currentType: 'role',\r\n        currentId: '',\r\n        currentRoleLevel: null,\r\n        menuTreeDefaultProps: {\r\n          children: 'children',\r\n          label: 'name'\r\n        },\r\n        deptTab: {\r\n          query: {\r\n            name: '',\r\n            id: ''\r\n          },\r\n          data: [],\r\n          loading: false\r\n        },\r\n        roleTab: {\r\n          query: {\r\n            blurry: ''\r\n          },\r\n          data: [],\r\n          loading: true,\r\n          total: 0, page: 0, size: 10\r\n        },\r\n        userTab: {\r\n          query: {\r\n            blurry: ''\r\n          },\r\n          data: [],\r\n          loading: true,\r\n          total: 0, page: 0, size: 10\r\n        },\r\n        adminTab: {\r\n          menuLoading: false,\r\n          data: [],\r\n          loading: false,\r\n          operators: [],\r\n          strictly: true\r\n        },\r\n        indexTab: {\r\n          menuLoading: false,\r\n          data: [],\r\n          loading: false,\r\n          operators: [],\r\n          strictly: true\r\n        },\r\n        indexOrgTab: {\r\n          menuLoading: false,\r\n          data: [],\r\n          loading: false,\r\n          operators: [],\r\n          strictly: true\r\n        }\r\n      }\r\n    },\r\n    mounted() {\r\n      this.toQueryRole()\r\n      // this.getAdminmenus()\r\n    },\r\n    methods: {\r\n      authHandleClick(tab, event) {\r\n        if (tab.name === 'dept') {\r\n          this.currentType = 'dept'\r\n          this.$refs.adminMenuTree.setCheckedKeys([])\r\n          this.toQueryDept()\r\n        } else if (tab.name === 'role') {\r\n          this.currentType = 'role'\r\n          this.$refs.adminMenuTree.setCheckedKeys([])\r\n          this.toQueryRole()\r\n        } else if (tab.name === 'user') {\r\n          this.currentType = 'user'\r\n          this.$refs.adminMenuTree.setCheckedKeys([])\r\n          this.toQueryUser()\r\n        }\r\n      },\r\n\r\n      menuHandleClick(tab, event) {\r\n        // this.getAdminmenus()\r\n      },\r\n\r\n      // 机构权限配置\r\n      toQueryDept() {\r\n        var _this = this\r\n        _this.deptTab.loading = true\r\n        // _this.deptTab.data = [];\r\n        request({\r\n          url: '/api/dept' + '?' + qs.stringify(_this.deptTab.query, { indices: false }),\r\n          method: 'get'\r\n        }).then(res => {\r\n          _this.deptTab.data = res.content\r\n          _this.deptTab.loading = false\r\n          //  console.log(_this.deptTab.data)\r\n        })\r\n      },\r\n      onSelectDept(currentRow, oldCurrentRow) {\r\n        // console.log(currentRow,oldCurrentRow)\r\n        if (currentRow) {\r\n          this.adminTab.strictly = true\r\n          this.currentId = currentRow.id\r\n          this.$refs.adminMenuTree.setCheckedKeys([])\r\n          request({\r\n            url: '/auths/menus' + '?' + qs.stringify({ type: 'dept', id: currentRow.id }, { indices: false }),\r\n            method: 'get'\r\n          }).then(res => {\r\n            this.adminTab.data = res\r\n            this.adminTab.loading = false\r\n            this.adminTab.strictly = false\r\n          })\r\n        }\r\n      },\r\n\r\n    // 角色权限配置\r\n    toQueryRole() {\r\n      var _this = this\r\n      _this.roleTab.loading = true\r\n      const sort = 'level,asc'\r\n      this.params = {page: this.roleTab.page, size: this.roleTab.size, sort: sort}\r\n      this.params['blurry'] = _this.roleTab.query.blurry\r\n      request({\r\n        url: '/api/roles' + '?' + qs.stringify(_this.params, {indices: false}),\r\n        method: 'get'\r\n      }).then(res => {\r\n        // console.log(res.content)\r\n        _this.roleTab.data = res.content\r\n        _this.roleTab.total = res.totalElements\r\n        _this.roleTab.loading = false\r\n      })\r\n    },\r\n    onSelectRole(currentRow, oldCurrentRow) {\r\n      if (currentRow) {\r\n        this.currentId = currentRow.id\r\n        this.adminTab.strictly = true\r\n        this.indexOrgTab.strictly = true\r\n        // this.adminTab.loading = true\r\n        this.currentRoleLevel = currentRow.level\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        request({\r\n          url: '/auths/menus/role/' + currentRow.id,\r\n          method: 'get'\r\n        }).then(res => {\r\n          console.log('======get role auths::', res)\r\n          this.adminTab.data = res.auths\r\n          this.adminTab.operators = res.operators\r\n          this.adminTab.strictly = false\r\n          // this.adminTab.loading = false\r\n        })\r\n        request({\r\n          url: '/auths/roleIndexs/' + currentRow.id,\r\n          method: 'get'\r\n        }).then(res => {\r\n          console.log('======get role auths::', res)\r\n          this.indexTab.data = res.ind.auths\r\n          this.indexTab.operators = res.ind.authorizes\r\n          this.indexTab.strictly = false\r\n\r\n          this.indexOrgTab.data = res.org.auths\r\n          this.indexOrgTab.operators = res.org.authorizes\r\n          this.indexOrgTab.strictly = false\r\n\r\n          // this.adminTab.loading = false\r\n        })\r\n      }\r\n    },\r\n    rolePageChange(e) {\r\n      this.roleTab.page = e - 1\r\n      this.toQueryRole()\r\n    },\r\n    roleSizeChange(e) {\r\n      this.roleTab.page = 0\r\n      this.roleTab.size = e\r\n      this.toQueryRole()\r\n    },\r\n\r\n    // 用户权限配置\r\n    toQueryUser() {\r\n      var _this = this\r\n      _this.userTab.loading = true\r\n      const sort = 'id,desc'\r\n      this.params = {page: this.userTab.page, size: this.userTab.size, sort: sort}\r\n      this.params['blurry'] = _this.userTab.query.blurry\r\n      request({\r\n        url: '/api/users' + '?' + qs.stringify(_this.params, {indices: false}),\r\n        method: 'get'\r\n      }).then(res => {\r\n        // console.log(res.content)\r\n        _this.userTab.data = res.content\r\n        _this.userTab.total = res.totalElements\r\n        _this.userTab.loading = false\r\n      })\r\n    },\r\n    onSelectUser(currentRow, oldCurrentRow) {\r\n      // console.log(currentRow,oldCurrentRow)\r\n      if (currentRow) {\r\n        this.adminTab.strictly = true\r\n        this.currentId = currentRow.id\r\n        this.$refs.adminMenuTree.setCheckedKeys([])\r\n        request({\r\n          url: '/auth/menus' + '?' + qs.stringify({type: 'user', id: currentRow.id}, {indices: false}),\r\n          method: 'get'\r\n        }).then(res => {\r\n          this.adminTab.data = res.auths\r\n          this.adminTab.this.adminTab.strictly = false\r\n        })\r\n      }\r\n    },\r\n    userPageChange(e) {\r\n      this.userTab.page = e - 1\r\n      this.toQueryUser()\r\n    },\r\n    userSizeChange(e) {\r\n      this.userTab.page = 0\r\n      this.userTab.size = e\r\n      this.toQueryUser()\r\n    },\r\n\r\n    // 加载admin菜单\r\n    /* getAdminmenus() {\r\n      var _this = this\r\n      request({\r\n        url: '/api/menus/tree',\r\n        method: 'get'\r\n      }).then(res => {\r\n        _this.adminTab.data = res\r\n        _this.adminTab.loading = false\r\n      })\r\n    },*/\r\n    doSaveAdminMenus() {\r\n      this.adminTab.menuLoading = true\r\n      // var _this = this\r\n      const menus = []\r\n      /* this.$refs.adminMenuTree.getHalfCheckedNodes().forEach(function(data, index) {\r\n        menus.push({id:data.id,auth:data.dataAuthType})\r\n      })*/\r\n      // 得到已选中的 key 值\r\n      console.log('=====getCheckedKeys========', menus, this.$refs.adminMenuTree.getCheckedNodes(false, true))\r\n      this.$refs.adminMenuTree.getCheckedNodes(false, true).forEach(function (data, index) {\r\n        menus.push({resourceId: data.id, authorizeType: '03', dataAuthType: data.dataAuthType})\r\n      })\r\n      request({\r\n        url: '/auths/menus/' + this.currentType + '/' + this.currentId,\r\n        method: 'post',\r\n        data: menus\r\n      }).then(res => {\r\n        this.adminTab.menuLoading = false\r\n        this.$notify({\r\n          title: '保存成功',\r\n          type: 'success',\r\n          duration: 2500\r\n        })\r\n      })\r\n    },\r\n    doSaveAdminIndexs() {\r\n      this.indexTab.menuLoading = true\r\n      // var _this = this\r\n      const indexs = []\r\n      // 得到已选中的 key 值\r\n      console.log('=====getCheckedKeys========', indexs, this.$refs.adminIndexTree.getCheckedNodes(false, true))\r\n      this.$refs.adminIndexTree.getCheckedNodes(false, true).forEach(function (data, index) {\r\n        indexs.push({objCode: data.id, objType: '1'})\r\n      })\r\n\r\n      this.$refs.adminIndexOrgTree.getCheckedNodes(false, true).forEach(function (data, index) {\r\n        indexs.push({objCode: data.id, objType: '2'})\r\n      })\r\n\r\n        request({\r\n          url: '/auths/roleIndexs/' + this.currentId,\r\n          method: 'post',\r\n          data: indexs\r\n        }).then(res => {\r\n          this.indexTab.menuLoading = false\r\n          this.$notify({\r\n            title: '保存成功',\r\n            type: 'success',\r\n            duration: 2500\r\n          })\r\n        })\r\n      },\r\n      choiceChildrenNode(data, selected){\r\n        var isChecked = selected.checkedKeys.includes(data.id);\r\n        if (isChecked) {\r\n          if (data.children) {\r\n              var allChildrens = this.getAllChildren(data);\r\n              allChildrens.forEach(item => {\r\n                this.$refs.adminIndexOrgTree.setChecked(item.id,true);\r\n              })\r\n          }\r\n        } else {\r\n          if (data.children) {\r\n            var allChildrens = this.getAllChildren(data);\r\n            allChildrens.forEach(item => {\r\n              this.$refs.adminIndexOrgTree.setChecked(item.id,false);\r\n            })\r\n          }\r\n        }\r\n      },\r\n\r\n      choiceIndChildrenNode(data, selected){\r\n        var isChecked = selected.checkedKeys.includes(data.id);\r\n        if (isChecked) {\r\n          if (data.children) {\r\n            var allChildrens = this.getAllChildren(data);\r\n            allChildrens.forEach(item => {\r\n              this.$refs.adminIndexTree.setChecked(item.id,true);\r\n            })\r\n          }\r\n        } else {\r\n          if (data.children) {\r\n            var allChildrens = this.getAllChildren(data);\r\n            allChildrens.forEach(item => {\r\n              this.$refs.adminIndexTree.setChecked(item.id,false);\r\n            })\r\n          }\r\n        }\r\n      },\r\n      getAllChildren(node){\r\n        var res = [];\r\n        var nodes = node.children;\r\n        if (nodes != null) {\r\n          for (var i = 0; i < nodes.length; i++) {\r\n              var childNode = nodes[i];\r\n              res.push(childNode);\r\n              var temp = this.getAllChildren(childNode);\r\n              res = res.concat(temp);\r\n          }\r\n        }\r\n        return res;\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n.content {\r\n  padding: 20px;\r\n}\r\n\r\n.line {\r\n  border: 1px solid #dfe6ec;\r\n  overflow: auto;\r\n  height: 430px;\r\n  width: 100%;\r\n  margin-top: 10px;\r\n}\r\n\r\n.custom-tree-node {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: revert;\r\n  justify-content: space-between;\r\n  font-size: 14px;\r\n  padding-right: 30px;\r\n}\r\n</style>\r\n"]}]}