{"remainingRequest":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js!D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\store\\modules\\user.js","dependencies":[{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\store\\modules\\user.js","mtime":1647928600476},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/code/DataAssetPlatform/Pncui-Ind/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.setUserInfo = exports.logOut = void 0;\n\nvar _login = require(\"@eladmin/api/login\");\n\nvar _auth = require(\"@eladmin/utils/auth\");\n\nvar _jsCookie = _interopRequireDefault(require(\"js-cookie\"));\n\nvar user = {\n  state: {\n    token: (0, _auth.getToken)(),\n    user: {},\n    authorizes: [],\n    currentRole: (0, _auth.getCurrentRole)(),\n    // 第一次加载菜单时用到\n    loadMenus: false,\n    menus: [],\n    smartbi: {},\n    theme: (0, _auth.getTheme)()\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_USER: function SET_USER(state, user) {\n      state.user = user;\n    },\n    SET_CURRENT_ROLE: function SET_CURRENT_ROLE(state, role) {\n      state.currentRole = role;\n    },\n    SET_AUTHORIZES: function SET_AUTHORIZES(state, authorizes) {\n      state.authorizes = authorizes;\n    },\n    SET_LOAD_MENUS: function SET_LOAD_MENUS(state, loadMenus) {\n      state.loadMenus = loadMenus;\n    },\n    SET_SMARTBI: function SET_SMARTBI(state, smartbi) {\n      state.smartbi = smartbi;\n    },\n    SET_THEME: function SET_THEME(state, theme) {\n      state.theme = theme;\n    }\n  },\n  actions: {\n    // 登录\n    Login: function Login(_ref, userInfo) {\n      var commit = _ref.commit;\n      console.log('----store.Login start111>>', userInfo);\n      var rememberMe = userInfo.rememberMe;\n      return new Promise(function (resolve, reject) {\n        console.log('----store.login start Promise>>');\n        (0, _login.login)(userInfo.username, userInfo.password, userInfo.code, userInfo.uuid, userInfo.loginType).then(function (res) {\n          // console.log('-----login--->', res)\n          _jsCookie.default.set('defaultPass', res.pwdState);\n\n          (0, _auth.setToken)(res.token, rememberMe);\n          commit('SET_TOKEN', res.token);\n          setUserInfo(res.user, commit); // 第一次加载菜单时用到， 具体见 src 目录下的 permission.js\n\n          commit('SET_LOAD_MENUS', true);\n          resolve();\n        }).catch(function (error) {\n          console.log('-----login exception>', error);\n          reject(error);\n        });\n      });\n    },\n    // sso登录\n    SsoLogin: function SsoLogin(_ref2, token) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve, reject) {\n        (0, _login.ssoLogin)(token).then(function (res) {\n          _jsCookie.default.set('defaultPass', res.pwdState);\n\n          (0, _auth.setToken)(res.token, false);\n          commit('SET_TOKEN', res.token);\n          setUserInfo(res.user, commit); // 第一次加载菜单时用到， 具体见 src 目录下的 permission.js\n\n          commit('SET_LOAD_MENUS', true);\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetInfo: function GetInfo(_ref3) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        (0, _login.getInfo)().then(function (res) {\n          setUserInfo(res, commit);\n          resolve(res);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        (0, _login.logout)().then(function () {\n          logOut(commit);\n          resolve();\n        }).catch(function (error) {\n          logOut(commit);\n          reject(error);\n        });\n      });\n    },\n    updateLoadMenus: function updateLoadMenus(_ref5) {\n      var commit = _ref5.commit;\n      return new Promise(function () {\n        commit('SET_LOAD_MENUS', false);\n      });\n    },\n    reLoadMenus: function reLoadMenus(_ref6) {\n      var commit = _ref6.commit;\n      commit('SET_LOAD_MENUS', true);\n    },\n    setSmartbi: function setSmartbi(_ref7, smartbi) {\n      var commit = _ref7.commit;\n      commit('SET_SMARTBI', smartbi);\n    },\n    setCurrentRole: function setCurrentRole(_ref8, role) {\n      var commit = _ref8.commit;\n      commit('SET_CURRENT_ROLE', role);\n      (0, _auth.setCurrentRole)(role);\n    },\n    setTheme: function setTheme(_ref9, theme) {\n      var commit = _ref9.commit;\n      console.log('====setTheme>', theme);\n      commit('SET_THEME', theme);\n      (0, _auth.setTheme)(theme);\n    }\n  }\n};\n\nvar logOut = function logOut(commit) {\n  commit('SET_TOKEN', '');\n  commit('SET_AUTHORIZES', []);\n  (0, _auth.removeToken)();\n  (0, _auth.removeCurrentRole)();\n};\n\nexports.logOut = logOut;\n\nvar setUserInfo = function setUserInfo(res, commit) {\n  // 如果没有任何权限，则赋予一个默认的权限，避免请求死循环\n  if (res.authorizes.length === 0) {\n    commit('SET_AUTHORIZES', ['ROLE_SYSTEM_DEFAULT']);\n  } else {\n    commit('SET_AUTHORIZES', res.authorizes);\n  }\n\n  commit('SET_USER', res);\n};\n\nexports.setUserInfo = setUserInfo;\nvar _default = user;\nexports.default = _default;",{"version":3,"sources":["D:/code/DataAssetPlatform/Pncui-Ind/src/store/modules/user.js"],"names":["user","state","token","authorizes","currentRole","loadMenus","menus","smartbi","theme","mutations","SET_TOKEN","SET_USER","SET_CURRENT_ROLE","role","SET_AUTHORIZES","SET_LOAD_MENUS","SET_SMARTBI","SET_THEME","actions","Login","userInfo","commit","console","log","rememberMe","Promise","resolve","reject","username","password","code","uuid","loginType","then","res","Cookies","set","pwdState","setUserInfo","catch","error","SsoLogin","GetInfo","LogOut","logOut","updateLoadMenus","reLoadMenus","setSmartbi","setCurrentRole","setTheme","length"],"mappings":"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","sourcesContent":["import {login, getInfo, logout, ssoLogin} from '@eladmin/api/login'\r\nimport {\r\n    getToken,\r\n    setToken,\r\n    removeToken,\r\n    getCurrentRole,\r\n    setCurrentRole,\r\n    removeCurrentRole,\r\n    getTheme, setTheme\r\n} from '@eladmin/utils/auth'\r\nimport Cookies from 'js-cookie'\r\nconst user = {\r\n    state: {\r\n        token: getToken(),\r\n        user: {},\r\n        authorizes: [],\r\n        currentRole: getCurrentRole(),\r\n        // 第一次加载菜单时用到\r\n        loadMenus: false,\r\n        menus: [],\r\n        smartbi: {},\r\n        theme: getTheme()\r\n    },\r\n\r\n    mutations: {\r\n        SET_TOKEN: (state, token) => {\r\n            state.token = token\r\n        },\r\n        SET_USER: (state, user) => {\r\n            state.user = user\r\n        },\r\n        SET_CURRENT_ROLE: (state, role) => {\r\n            state.currentRole = role\r\n        },\r\n        SET_AUTHORIZES: (state, authorizes) => {\r\n            state.authorizes = authorizes\r\n        },\r\n        SET_LOAD_MENUS: (state, loadMenus) => {\r\n            state.loadMenus = loadMenus\r\n        },\r\n        SET_SMARTBI: (state, smartbi) => {\r\n            state.smartbi = smartbi\r\n        },\r\n        SET_THEME: (state, theme) => {\r\n            state.theme = theme\r\n        }\r\n    },\r\n\r\n    actions: {\r\n        // 登录\r\n        Login({commit}, userInfo) {\r\n            console.log('----store.Login start111>>', userInfo)\r\n            const rememberMe = userInfo.rememberMe\r\n            return new Promise((resolve, reject) => {\r\n                console.log('----store.login start Promise>>')\r\n                login(userInfo.username, userInfo.password, userInfo.code, userInfo.uuid,userInfo.loginType).then(res => {\r\n                    // console.log('-----login--->', res)\r\n                    Cookies.set('defaultPass', res.pwdState)\r\n                    setToken(res.token, rememberMe)\r\n                    commit('SET_TOKEN', res.token)\r\n                    setUserInfo(res.user, commit)\r\n                    // 第一次加载菜单时用到， 具体见 src 目录下的 permission.js\r\n                    commit('SET_LOAD_MENUS', true)\r\n                    resolve()\r\n                }).catch(error => {\r\n                    console.log('-----login exception>', error)\r\n                    reject(error)\r\n                })\r\n            })\r\n        },\r\n        // sso登录\r\n        SsoLogin({commit}, token) {\r\n            return new Promise((resolve, reject) => {\r\n                ssoLogin(token).then(res => {\r\n                    Cookies.set('defaultPass', res.pwdState)\r\n                    setToken(res.token, false)\r\n                    commit('SET_TOKEN', res.token)\r\n                    setUserInfo(res.user, commit)\r\n                    // 第一次加载菜单时用到， 具体见 src 目录下的 permission.js\r\n                    commit('SET_LOAD_MENUS', true)\r\n                    resolve()\r\n                }).catch(error => {\r\n                    reject(error)\r\n                })\r\n            })\r\n        },\r\n        // 获取用户信息\r\n        GetInfo({commit}) {\r\n            return new Promise((resolve, reject) => {\r\n                getInfo().then(res => {\r\n                    setUserInfo(res, commit)\r\n                    resolve(res)\r\n                }).catch(error => {\r\n                    reject(error)\r\n                })\r\n            })\r\n        },\r\n        // 登出\r\n        LogOut({commit}) {\r\n            return new Promise((resolve, reject) => {\r\n                logout().then(() => {\r\n                    logOut(commit)\r\n                    resolve()\r\n                }).catch(error => {\r\n                    logOut(commit)\r\n                    reject(error)\r\n                })\r\n            })\r\n        },\r\n        updateLoadMenus({commit}) {\r\n            return new Promise(() => {\r\n                commit('SET_LOAD_MENUS', false)\r\n            })\r\n        },\r\n        reLoadMenus({commit}) {\r\n            commit('SET_LOAD_MENUS', true)\r\n        },\r\n        setSmartbi({commit}, smartbi) {\r\n            commit('SET_SMARTBI', smartbi)\r\n        },\r\n        setCurrentRole({commit}, role) {\r\n            commit('SET_CURRENT_ROLE', role)\r\n            setCurrentRole(role)\r\n        },\r\n        setTheme({commit}, theme) {\r\n            console.log('====setTheme>', theme)\r\n            commit('SET_THEME', theme)\r\n            setTheme(theme)\r\n        }\r\n    }\r\n}\r\n\r\nexport const logOut = (commit) => {\r\n    commit('SET_TOKEN', '')\r\n    commit('SET_AUTHORIZES', [])\r\n    removeToken()\r\n    removeCurrentRole()\r\n}\r\n\r\nexport const setUserInfo = (res, commit) => {\r\n    // 如果没有任何权限，则赋予一个默认的权限，避免请求死循环\r\n    if (res.authorizes.length === 0) {\r\n        commit('SET_AUTHORIZES', ['ROLE_SYSTEM_DEFAULT'])\r\n    } else {\r\n        commit('SET_AUTHORIZES', res.authorizes)\r\n    }\r\n    commit('SET_USER', res)\r\n}\r\n\r\nexport default user\r\n"]}]}