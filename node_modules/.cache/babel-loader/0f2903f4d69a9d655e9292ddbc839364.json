{"remainingRequest":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js!D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\login\\login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\src\\views\\indicators\\login\\login.vue","mtime":1653959914643},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1650418872733},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1650418873221},{"path":"D:\\code\\DataAssetPlatform000\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1650418886580}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/code/DataAssetPlatform000/Pncui-Ind/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"D:/code/DataAssetPlatform000/Pncui-Ind/node_modules/@babel/runtime/helpers/objectSpread2\"));\n\nvar _rsaEncrypt = require(\"@eladmin/utils/rsaEncrypt\");\n\nvar _settings = _interopRequireDefault(require(\"@public/config/settings\"));\n\nvar _login = require(\"@eladmin/api/login\");\n\nvar _jsCookie = _interopRequireDefault(require(\"js-cookie\"));\n\nvar _vuex = require(\"vuex\");\n\nvar _ThemeSelect = _interopRequireDefault(require(\"@portal/components/ThemeSelect\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'Login',\n  data: function data() {\n    return {\n      title: _settings.default.title,\n      codeEnabled: false,\n      codeUrl: '',\n      cookiePass: '',\n      theme: 'default',\n      loginForm: {\n        username: '',\n        password: '',\n        rememberMe: false,\n        code: '',\n        uuid: '',\n        loginType: '',\n        targetUrl: ''\n      },\n      loginRules: {\n        username: [{\n          required: true,\n          trigger: 'blur',\n          message: '用户名不能为空'\n        }],\n        password: [{\n          required: true,\n          trigger: 'blur',\n          message: '密码不能为空'\n        }],\n        code: [{\n          required: true,\n          trigger: 'change',\n          message: '验证码不能为空'\n        }]\n      },\n      loading: false,\n      redirect: undefined,\n      currentRole: {\n        id: '',\n        name: ''\n      },\n      selectRole: false,\n      showForm: false\n    };\n  },\n  components: {\n    ThemeSelect: _ThemeSelect.default\n  },\n  computed: {\n    logo: function logo() {\n      //console.log('lllllogo>>>>>', Config.logo, typeof (Config.logo))\n      return _settings.default.logo ? _settings.default.logo : require('@portalParent/public/themes/' + this.getStyle()['style'] + '/images/logo.png');\n    },\n    getBackground: function getBackground() {\n      //return '/themes/' + this.getTheme().layout + '/' + this.getTheme().style + '/images/login_bg_' + (new Date().getDay() + 1) + '.jpg'\n      return _settings.default.loginBackground ? _settings.default.loginBackground : require('@portalParent/public/themes/' + this.getStyle().style + '/images/login_bg_' + (new Date().getDay() + 1) + '.jpg');\n    }\n  },\n  watch: {\n    $route: {\n      handler: function handler(route) {\n        this.redirect = route.query && route.query.redirect;\n      },\n      immediate: true\n    }\n  },\n  created: function created() {\n    var param = getQueryObject();\n    var token = param.token;\n    var userName = param.userName;\n    var type = param.type;\n    var targetUrl = param.targetUrl;\n    console.log(\"login token:: \" + token + \",userName :: \" + userName + \",loginType :: \" + type + \",targetUrl=\" + targetUrl);\n\n    if (type === 'sso' && (token != null || userName != null)) {\n      this.showForm = false;\n      this.autoLogin(param);\n    } else {\n      this.showForm = true;\n    }\n\n    this.getCode();\n    this.getCookie();\n  },\n  mounted: function mounted() {},\n  methods: (0, _objectSpread2.default)({\n    getCode: function getCode() {\n      var _this = this;\n\n      (0, _login.getCodeImg)().then(function (res) {\n        _this.codeEnabled = res.enabled;\n\n        if (res.enabled) {\n          _this.codeUrl = res.img;\n          _this.loginForm.uuid = res.uuid;\n        }\n      });\n    },\n    getCookie: function getCookie() {\n      var username = _jsCookie.default.get('username');\n\n      var password = _jsCookie.default.get('password');\n\n      var rememberMe = _jsCookie.default.get('rememberMe'); // 保存cookie里面的加密后的密码\n\n\n      this.cookiePass = password === undefined ? '' : password;\n      password = password === undefined ? this.loginForm.password : password;\n      this.loginForm = {\n        username: username === undefined ? this.loginForm.username : username,\n        password: password,\n        rememberMe: rememberMe === undefined ? false : Boolean(rememberMe),\n        code: ''\n      };\n    },\n    autoLogin: function autoLogin(param) {\n      var _this2 = this;\n\n      var token = param.token;\n      var type = param.type;\n      var targetUrl = param.targetUrl;\n      var userName = param.userName;\n      console.log(\"autoLogin ==> \" + token);\n      (0, _login.ssoLogin)(token, userName, targetUrl).then(function (res) {\n        if (res.code === '00') {\n          _this2.loginForm.username = res.username;\n          _this2.loginForm.password = res.password; // this.loginForm.loginType = 'sso';\n\n          _this2.loginForm.loginType = type;\n          _this2.loginForm.targetUrl = res.targetUrl;\n\n          _this2.handleLogin();\n        } else {\n          _this2.$message(res.msg, 'error');\n        }\n      });\n    },\n    handleLogin: function handleLogin() {\n      var _this3 = this;\n\n      console.log(\"handleLogin ==>\");\n      this.$refs.loginForm.validate(function (valid) {\n        var user = {\n          username: _this3.loginForm.username,\n          password: _this3.loginForm.password,\n          rememberMe: _this3.loginForm.rememberMe,\n          code: _this3.loginForm.code,\n          uuid: _this3.loginForm.uuid,\n          loginType: _this3.loginForm.loginType,\n          targetUrl: _this3.loginForm.targetUrl\n        };\n        console.log(\"handleLogin ==> user \" + user.loginType);\n\n        if (user.password !== _this3.cookiePass) {\n          user.password = (0, _rsaEncrypt.encrypt)(user.password);\n        }\n\n        if (valid) {\n          _this3.loading = true;\n\n          if (user.rememberMe) {\n            _jsCookie.default.set('username', user.username, {\n              expires: _settings.default.passCookieExpires\n            });\n\n            _jsCookie.default.set('password', user.password, {\n              expires: _settings.default.passCookieExpires\n            });\n\n            _jsCookie.default.set('rememberMe', user.rememberMe, {\n              expires: _settings.default.passCookieExpires\n            });\n          } else {\n            _jsCookie.default.remove('username');\n\n            _jsCookie.default.remove('password');\n\n            _jsCookie.default.remove('rememberMe');\n          }\n\n          _this3.$store.dispatch('Login', user).then(function () {\n            //console.log('======dddddd======', this.user())\n            if (_this3.user().roles != null && _this3.user().roles.length > 0) {\n              if (_this3.user().roles.length > 1) {\n                console.log('=======login=====>', _this3.user());\n\n                for (var i = 0; i < _this3.user().roles.length; i++) {\n                  _this3.currentRole.id += _this3.user().roles[i].id + \",\";\n                  _this3.currentRole.name += _this3.user().roles[i].name + \",\";\n                }\n\n                _this3.currentRole.id = _this3.currentRole.id.substr(0, _this3.currentRole.id.length - 1);\n                _this3.currentRole.name = _this3.currentRole.name.substr(0, _this3.currentRole.name.length - 1);\n                _this3.selectRole = false;\n\n                if (_this3.loginForm.loginType == \"sso\" && _this3.loginForm.targetUrl) {\n                  _this3.redirect = _this3.loginForm.targetUrl + \"&type=\" + _this3.loginForm.loginType;\n                }\n\n                _this3.goin();\n              } else if (_this3.user().roles.length === 1) {\n                _this3.currentRole.id = _this3.user().roles[0].id;\n                _this3.currentRole.name += _this3.user().roles[0].name;\n\n                if (_this3.loginForm.loginType == \"sso\" && _this3.loginForm.targetUrl) {\n                  _this3.redirect = _this3.loginForm.targetUrl + \"&type=\" + _this3.loginForm.loginType;\n                }\n\n                _this3.goin();\n              }\n            } else {\n              _this3.$message('当前用户没有访问该系统的权限，请联系管理员！', 'error');\n            }\n          }).catch(function (error) {\n            console.log(error);\n            _this3.loading = false;\n\n            _this3.getCode();\n          });\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n    },\n    goin: function goin() {\n      if (!this.currentRole) {\n        this.$message('请选择角色', 'error');\n        return;\n      } //console.log('======goin============', this.currentRole, this.user().roles.find(e => e.id == this.currentRole))\n\n\n      this.$store.dispatch('setCurrentRole', this.currentRole);\n      this.$router.push({\n        path: this.redirect || '/portalHomeIndex'\n      }); //this.$router.push({path: this.redirect || '/'})\n    },\n    cancel: function cancel() {\n      this.selectRole = false;\n      this.loading = false;\n    }\n  }, (0, _vuex.mapGetters)(['user', 'getStyle']))\n};\nexports.default = _default;\n\nfunction getQueryObject(url) {\n  url = url == null ? window.location.href : url;\n  var search = url.substring(url.lastIndexOf('?') + 1);\n  var obj = {};\n  var reg = /([^?&=]+)=([^?&=]*)/g;\n  search.replace(reg, function (rs, $1, $2) {\n    var name = decodeURIComponent($1);\n    var val = decodeURIComponent($2);\n    val = String(val);\n    obj[name] = val;\n    return rs;\n  });\n  return obj;\n}",null]}