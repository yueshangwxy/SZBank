{"remainingRequest":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\indicator\\approve.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\indicator\\approve.vue","mtime":1647917138751},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1647917137429},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1647917137429}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"D:/code/DataAssetPlatform/Pncui-Ind/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nvar _methods;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport crudIndIndicatorInfo, { getIndDeriveRuleByIeCode, updateStatus, getIndBaseRule, getIndDeriveRule } from \"../../../api/indicators/indIndicatorInfo\";\nimport CRUD, { presenter, header, form, crud } from '@crud/crud';\nimport rrOperation from '@crud/RR.operation';\nimport crudOperation from '@crud/ACRUD.operation';\nimport udOperation from '@crud/UD.operation';\nimport pagination from '@crud/Pagination';\nimport checkApproves from \"./approve/checkApproves\";\nimport checkApprove from \"./approve/checkApprove\";\nimport lookDetails from \"./details/lookApproveDetails\";\nimport { getDepts } from '@system/api/system/dept'; // crud交由presenter持有\n\nvar defaultCrud = CRUD({\n  title: '指标基本信息',\n  url: crudIndIndicatorInfo.url,\n  sort: 'id,desc',\n  crudMethod: _objectSpread({}, crudIndIndicatorInfo.method)\n});\nexport default {\n  name: 'IndIndicatorInfo',\n  components: {\n    pagination: pagination,\n    crudOperation: crudOperation,\n    rrOperation: rrOperation,\n    udOperation: udOperation,\n    checkApproves: checkApproves,\n    checkApprove: checkApprove,\n    lookDetails: lookDetails\n  },\n  mixins: [presenter(defaultCrud), header(), crud()],\n  dicts: ['IE_PROP', 'IE_TYPE', 'IE_METHOD', 'CALC_FREQ', 'IE_STATUS', 'IE_DATA_UNIT', 'RETENTION', 'BUTTON_NAME'],\n  data: function data() {\n    return {\n      table: {\n        columns: {\n          id: 'hidden'\n          /* crtOrgCode: 'hidden',\n          updOrgCode: 'hidden',*/\n\n        }\n      },\n      permission: {\n        upLine: ['admin', 'baseIndIndicatorInfo:upLine'],\n        startUsing: ['admin', 'baseIndIndicatorInfo:startUsing'],\n        add: ['admin', 'indIndicatorInfo:add'],\n        edit: ['admin', 'indIndicatorInfo:edit'],\n        del: ['admin', 'indIndicatorInfo:del']\n      }\n    };\n  },\n  methods: (_methods = {}, _defineProperty(_methods, CRUD.HOOK.beforeRefresh, function () {\n    /* this.query.status = this.$route.query.status,*/\n    this.query.queryType = '2';\n    return true;\n  }), _defineProperty(_methods, \"approve\", function approve(row) {\n    var _this2 = this;\n\n    var ieCodes = [];\n    var _this = this.$refs.checkApprove; // 打开审批页面时通过ieCode去查询取值规则\n\n    var indDeriveRule = {\n      ieCode: row.ieCode\n    };\n    ieCodes.push(row.ieCode);\n\n    if (row.status == 2) {\n      // 开发校验通过后执行审批\n      // 基础指标验证\n      if (row.ieType == 1) {\n        getIndBaseRule(ieCodes).then(function (returnData) {\n          if (returnData.code !== 0) {\n            _this2.crud.notify(returnData.msg + '指标未进行开发', CRUD.NOTIFICATION_TYPE.ERROR);\n          } else {\n            /* getIndDeriveRuleByIeCode(indDeriveRule).then(data => {\n               if (data.code === 0) {\n                 _this.$set(_this.form, 'calcRule', data.data.ruleDesc)\n               }\n             })*/\n            getDepts({\n              enabled: true\n            }).then(function (res) {\n              _this.depts = res.content;\n            });\n            _this.title = '审批';\n            _this.form = row;\n            _this.approveDialog = true;\n          }\n        });\n      } // 衍生指标 验证是否可以上线\n\n\n      if (row.ieType == 2) {\n        getIndDeriveRule(ieCodes).then(function (returnData) {\n          if (returnData.code !== 0) {\n            _this2.crud.notify(returnData.msg + '指标未进行开发', CRUD.NOTIFICATION_TYPE.ERROR);\n          } else {\n            /* getIndDeriveRuleByIeCode(indDeriveRule).then(data => {\n              if (data.code === 0) {\n                _this.$set(_this.form, 'calcRule', data.data.ruleDesc)\n              }\n            })*/\n            getDepts({\n              enabled: true\n            }).then(function (res) {\n              _this.depts = res.content;\n            });\n            _this.title = '审批';\n            _this.form = row;\n            _this.approveDialog = true;\n          }\n        });\n      }\n    } else {\n      /* getIndDeriveRuleByIeCode(indDeriveRule).then(data => {\n        if (data.code === 0) {\n          _this.$set(_this.form, 'calcRule', data.data.ruleDesc)\n        }\n      })*/\n      getDepts({\n        enabled: true\n      }).then(function (res) {\n        _this.depts = res.content;\n      });\n      _this.title = '审批';\n      _this.form = row;\n      _this.approveDialog = true;\n    }\n  }), _defineProperty(_methods, \"upLine\", function upLine(data) {\n    var _this3 = this;\n\n    var temp = 0;\n    var param = [];\n    var ieCodes = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择0-已审批\n      if (data[i].status != 2) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'status': '4'\n      };\n      param.push(indIndicatorInfo);\n      ieCodes.push(data[i].ieCode);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择已审批的数据', CRUD.NOTIFICATION_TYPE.ERROR);\n      return false;\n    } // 开发校验通过后执行审批\n\n\n    getIndBaseRule(ieCodes).then(function (returnData) {\n      if (returnData.code !== 0) {\n        _this3.crud.notify(returnData.msg + '指标未进行开发', CRUD.NOTIFICATION_TYPE.ERROR);\n      } else {\n        _this3.$confirm(\"\\u786E\\u5B9A\\u4E0A\\u7EBF\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n          confirmButtonText: '确定',\n          cancelButtonText: '取消',\n          type: 'warning'\n        }).then(function () {\n          // 开发校验通过后,修改状态\n          updateStatus(param).then(function (returnData) {\n            if (returnData.code === 0) {\n              _this3.crud.notify('操作成功', CRUD.NOTIFICATION_TYPE.SUCCESS);\n\n              _this3.crud.toQuery();\n            } else {\n              _this3.crud.notify('操作失败!错误原因:' + returnData.msg, CRUD.NOTIFICATION_TYPE.ERROR);\n\n              _this3.crud.toQuery();\n            }\n          });\n        });\n      }\n    });\n  }), _defineProperty(_methods, \"startUsing\", function startUsing(data) {\n    var _this4 = this;\n\n    var temp = 0;\n    var param = [];\n\n    for (var i = 0; i < data.length; i++) {\n      // 状态校验-只能选择4-已上线，不能啟用6-停用的数据\n      if (data[i].status != 4) {\n        temp = -1;\n        break;\n      }\n\n      var indIndicatorInfo = {\n        'id': data[i].id,\n        'status': '5'\n      };\n      param.push(indIndicatorInfo);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择已上线的数据', CRUD.NOTIFICATION_TYPE.ERROR);\n      return false;\n    }\n\n    this.$confirm(\"\\u786E\\u5B9A\\u542F\\u7528\\u6240\\u9009\\u6570\\u636E\\u5417?\", '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning'\n    }).then(function () {\n      updateStatus(param).then(function (returnData) {\n        if (returnData.code === 0) {\n          _this4.crud.notify('操作成功', CRUD.NOTIFICATION_TYPE.SUCCESS);\n\n          _this4.crud.toQuery();\n        } else {\n          _this4.crud.notify('操作失败!错误原因:' + returnData.msg, CRUD.NOTIFICATION_TYPE.ERROR);\n\n          _this4.crud.toQuery();\n        }\n      });\n    });\n  }), _defineProperty(_methods, \"approves\", function approves(data) {\n    var _this5 = this;\n\n    var temp = 0;\n    var ieCodes = [];\n    var _this = this.$refs.checkApproves;\n    _this.title = '审批';\n\n    for (var i = 0; i < data.length; i++) {\n      var indIndicatorInfo = {\n        'id': data[i].id\n      };\n\n      for (var j = 0; j < data.length; j++) {\n        if (data[i].status != data[j].status) {\n          temp = -1;\n        }\n      }\n\n      _this.param.push(indIndicatorInfo);\n\n      ieCodes.push(data[i].ieCode);\n    }\n\n    if (temp == -1) {\n      this.crud.notify('请选择状态一致的数据', CRUD.NOTIFICATION_TYPE.ERROR);\n      _this.approveDialog = false;\n      return false;\n    } else {\n      if (data[0].status == 2) {\n        // 判断是否已开发具备上线\n        // 判断是基础指标1 还是 衍生指标2\n        if (data[0].ieType == 1) {\n          getIndBaseRule(ieCodes).then(function (returnData) {\n            if (returnData.code !== 0) {\n              _this5.crud.notify(returnData.msg + '指标未进行开发', CRUD.NOTIFICATION_TYPE.ERROR);\n\n              _this.approveDialog = false;\n            } else {\n              _this.approveDialog = true;\n            }\n          });\n        }\n\n        if (data[0].ieType == 2) {\n          // 开发校验通过后执行审批\n          getIndDeriveRule(ieCodes).then(function (returnData) {\n            if (returnData.code !== 0) {\n              _this5.crud.notify(returnData.msg + '指标未进行开发', CRUD.NOTIFICATION_TYPE.ERROR);\n\n              _this.approveDialog = false;\n            } else {\n              _this.approveDialog = true;\n            }\n          });\n        }\n      } else {\n        _this.approveDialog = true;\n      }\n    }\n\n    _this.form.status = data[0].status;\n  }), _defineProperty(_methods, \"details\", function details(row) {\n    var _this = this.$refs.lookDetails; // 打开详情页面时通过ieCode去查询取值规则\n\n    var indDeriveRule = {\n      ieCode: row.ieCode\n    };\n    getIndDeriveRuleByIeCode(indDeriveRule).then(function (data) {\n      if (data.code === 0) {\n        _this.$set(_this.form, 'calcRule', data.data.ruleDesc);\n      }\n    });\n    getDepts({\n      enabled: true\n    }).then(function (res) {\n      _this.depts = res.content;\n    });\n    _this.title = '详情';\n    _this.form = row;\n    _this.detailsDialog = true;\n  }), _methods)\n};",null]}