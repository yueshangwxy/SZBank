{"remainingRequest":"D:\\WorkSpace\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js!D:\\WorkSpace\\indicator\\Pncui-Indicator\\src\\store\\modules\\user.js","dependencies":[{"path":"D:\\WorkSpace\\indicator\\Pncui-Indicator\\src\\store\\modules\\user.js","mtime":1646633727677},{"path":"D:\\WorkSpace\\indicator\\Pncui-Indicator\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\indicator\\Pncui-Indicator\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":["import { login, getInfo, logout, ssoLogin } from '@eladmin/api/login';\nimport { getToken, setToken, removeToken, getCurrentRole, setCurrentRole as _setCurrentRole, removeCurrentRole, getTheme, setTheme as _setTheme } from '@eladmin/utils/auth';\nimport Cookies from 'js-cookie';\nvar user = {\n  state: {\n    token: getToken(),\n    user: {},\n    authorizes: [],\n    currentRole: getCurrentRole(),\n    // 第一次加载菜单时用到\n    loadMenus: false,\n    menus: [],\n    smartbi: {},\n    theme: getTheme()\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_USER: function SET_USER(state, user) {\n      state.user = user;\n    },\n    SET_CURRENT_ROLE: function SET_CURRENT_ROLE(state, role) {\n      state.currentRole = role;\n    },\n    SET_AUTHORIZES: function SET_AUTHORIZES(state, authorizes) {\n      state.authorizes = authorizes;\n    },\n    SET_LOAD_MENUS: function SET_LOAD_MENUS(state, loadMenus) {\n      state.loadMenus = loadMenus;\n    },\n    SET_SMARTBI: function SET_SMARTBI(state, smartbi) {\n      state.smartbi = smartbi;\n    },\n    SET_THEME: function SET_THEME(state, theme) {\n      state.theme = theme;\n    }\n  },\n  actions: {\n    // 登录\n    Login: function Login(_ref, userInfo) {\n      var commit = _ref.commit;\n      console.log('----store.Login start111>>', userInfo);\n      var rememberMe = userInfo.rememberMe;\n      return new Promise(function (resolve, reject) {\n        console.log('----store.login start Promise>>');\n        login(userInfo.username, userInfo.password, userInfo.code, userInfo.uuid, userInfo.loginType).then(function (res) {\n          // console.log('-----login--->', res)\n          Cookies.set('defaultPass', res.pwdState);\n          setToken(res.token, rememberMe);\n          commit('SET_TOKEN', res.token);\n          setUserInfo(res.user, commit); // 第一次加载菜单时用到， 具体见 src 目录下的 permission.js\n\n          commit('SET_LOAD_MENUS', true);\n          resolve();\n        }).catch(function (error) {\n          console.log('-----login exception>', error);\n          reject(error);\n        });\n      });\n    },\n    // sso登录\n    SsoLogin: function SsoLogin(_ref2, token) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve, reject) {\n        ssoLogin(token).then(function (res) {\n          Cookies.set('defaultPass', res.pwdState);\n          setToken(res.token, false);\n          commit('SET_TOKEN', res.token);\n          setUserInfo(res.user, commit); // 第一次加载菜单时用到， 具体见 src 目录下的 permission.js\n\n          commit('SET_LOAD_MENUS', true);\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetInfo: function GetInfo(_ref3) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        getInfo().then(function (res) {\n          setUserInfo(res, commit);\n          resolve(res);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    LogOut: function LogOut(_ref4) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        logout().then(function () {\n          logOut(commit);\n          resolve();\n        }).catch(function (error) {\n          logOut(commit);\n          reject(error);\n        });\n      });\n    },\n    updateLoadMenus: function updateLoadMenus(_ref5) {\n      var commit = _ref5.commit;\n      return new Promise(function () {\n        commit('SET_LOAD_MENUS', false);\n      });\n    },\n    reLoadMenus: function reLoadMenus(_ref6) {\n      var commit = _ref6.commit;\n      commit('SET_LOAD_MENUS', true);\n    },\n    setSmartbi: function setSmartbi(_ref7, smartbi) {\n      var commit = _ref7.commit;\n      commit('SET_SMARTBI', smartbi);\n    },\n    setCurrentRole: function setCurrentRole(_ref8, role) {\n      var commit = _ref8.commit;\n      commit('SET_CURRENT_ROLE', role);\n\n      _setCurrentRole(role);\n    },\n    setTheme: function setTheme(_ref9, theme) {\n      var commit = _ref9.commit;\n      console.log('====setTheme>', theme);\n      commit('SET_THEME', theme);\n\n      _setTheme(theme);\n    }\n  }\n};\nexport var logOut = function logOut(commit) {\n  commit('SET_TOKEN', '');\n  commit('SET_AUTHORIZES', []);\n  removeToken();\n  removeCurrentRole();\n};\nexport var setUserInfo = function setUserInfo(res, commit) {\n  // 如果没有任何权限，则赋予一个默认的权限，避免请求死循环\n  if (res.authorizes.length === 0) {\n    commit('SET_AUTHORIZES', ['ROLE_SYSTEM_DEFAULT']);\n  } else {\n    commit('SET_AUTHORIZES', res.authorizes);\n  }\n\n  commit('SET_USER', res);\n};\nexport default user;",null]}