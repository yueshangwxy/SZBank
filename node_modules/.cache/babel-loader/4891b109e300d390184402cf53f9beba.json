{"remainingRequest":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\login\\login.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\src\\views\\indicators\\login\\login.vue","mtime":1647917138773},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\babel-loader\\lib\\index.js","mtime":1647917124178},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1647917124586},{"path":"D:\\code\\DataAssetPlatform\\Pncui-Ind\\node_modules\\vue-loader\\lib\\index.js","mtime":1647917137429}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/code/DataAssetPlatform/Pncui-Ind/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _defineProperty2 = _interopRequireDefault(require(\"D:/code/DataAssetPlatform/Pncui-Ind/node_modules/@babel/runtime/helpers/defineProperty\"));\n\nvar _rsaEncrypt = require(\"@eladmin/utils/rsaEncrypt\");\n\nvar _settings = _interopRequireDefault(require(\"@public/config/settings\"));\n\nvar _login = require(\"@eladmin/api/login\");\n\nvar _jsCookie = _interopRequireDefault(require(\"js-cookie\"));\n\nvar _vuex = require(\"vuex\");\n\nvar _ThemeSelect = _interopRequireDefault(require(\"@portal/components/ThemeSelect\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n\nvar _default = {\n  name: 'Login',\n  data: function data() {\n    return {\n      title: _settings.default.title,\n      codeEnabled: false,\n      codeUrl: '',\n      cookiePass: '',\n      theme: 'default',\n      loginForm: {\n        username: '',\n        password: '',\n        rememberMe: false,\n        code: '',\n        uuid: '',\n        loginType: ''\n      },\n      loginRules: {\n        username: [{\n          required: true,\n          trigger: 'blur',\n          message: '用户名不能为空'\n        }],\n        password: [{\n          required: true,\n          trigger: 'blur',\n          message: '密码不能为空'\n        }],\n        code: [{\n          required: true,\n          trigger: 'change',\n          message: '验证码不能为空'\n        }]\n      },\n      loading: false,\n      redirect: undefined,\n      currentRole: {\n        id: '',\n        name: ''\n      },\n      selectRole: false,\n      showForm: false\n    };\n  },\n  components: {\n    ThemeSelect: _ThemeSelect.default\n  },\n  computed: {\n    logo: function logo() {\n      //console.log('lllllogo>>>>>', Config.logo, typeof (Config.logo))\n      return _settings.default.logo ? _settings.default.logo : require('@portalParent/public/themes/' + this.getStyle()['style'] + '/images/logo.png');\n    },\n    getBackground: function getBackground() {\n      //return '/themes/' + this.getTheme().layout + '/' + this.getTheme().style + '/images/login_bg_' + (new Date().getDay() + 1) + '.jpg'\n      return _settings.default.loginBackground ? _settings.default.loginBackground : require('@portalParent/public/themes/' + this.getStyle().style + '/images/login_bg_' + (new Date().getDay() + 1) + '.jpg');\n    }\n  },\n  watch: {\n    $route: {\n      handler: function handler(route) {\n        this.redirect = route.query && route.query.redirect;\n      },\n      immediate: true\n    }\n  },\n  created: function created() {\n    var param = getQueryObject();\n    var token = param.token;\n    var type = param.type;\n    console.log(\"login token:: \" + token + \",loginType :: \" + type);\n\n    if (type === 'sso' && token != null) {\n      this.showForm = false;\n      this.autoLogin(token);\n    } else {\n      this.showForm = true;\n    }\n\n    this.getCode();\n    this.getCookie();\n  },\n  mounted: function mounted() {},\n  methods: _objectSpread({\n    getCode: function getCode() {\n      var _this = this;\n\n      (0, _login.getCodeImg)().then(function (res) {\n        _this.codeEnabled = res.enabled;\n\n        if (res.enabled) {\n          _this.codeUrl = res.img;\n          _this.loginForm.uuid = res.uuid;\n        }\n      });\n    },\n    getCookie: function getCookie() {\n      var username = _jsCookie.default.get('username');\n\n      var password = _jsCookie.default.get('password');\n\n      var rememberMe = _jsCookie.default.get('rememberMe'); // 保存cookie里面的加密后的密码\n\n\n      this.cookiePass = password === undefined ? '' : password;\n      password = password === undefined ? this.loginForm.password : password;\n      this.loginForm = {\n        username: username === undefined ? this.loginForm.username : username,\n        password: password,\n        rememberMe: rememberMe === undefined ? false : Boolean(rememberMe),\n        code: ''\n      };\n    },\n    autoLogin: function autoLogin(token) {\n      var _this2 = this;\n\n      console.log(\"autoLogin ==> \" + token);\n      (0, _login.ssoLogin)(token).then(function (res) {\n        if (res.code === '00') {\n          _this2.loginForm.username = res.username;\n          _this2.loginForm.password = res.password;\n          _this2.loginForm.loginType = 'sso';\n\n          _this2.handleLogin();\n        }\n      });\n    },\n    handleLogin: function handleLogin() {\n      var _this3 = this;\n\n      console.log(\"handleLogin ==>\");\n      this.$refs.loginForm.validate(function (valid) {\n        var user = {\n          username: _this3.loginForm.username,\n          password: _this3.loginForm.password,\n          rememberMe: _this3.loginForm.rememberMe,\n          code: _this3.loginForm.code,\n          uuid: _this3.loginForm.uuid,\n          loginType: _this3.loginForm.loginType\n        };\n        console.log(\"handleLogin ==> user \" + user.loginType);\n\n        if (user.password !== _this3.cookiePass) {\n          user.password = (0, _rsaEncrypt.encrypt)(user.password);\n        }\n\n        if (valid) {\n          _this3.loading = true;\n\n          if (user.rememberMe) {\n            _jsCookie.default.set('username', user.username, {\n              expires: _settings.default.passCookieExpires\n            });\n\n            _jsCookie.default.set('password', user.password, {\n              expires: _settings.default.passCookieExpires\n            });\n\n            _jsCookie.default.set('rememberMe', user.rememberMe, {\n              expires: _settings.default.passCookieExpires\n            });\n          } else {\n            _jsCookie.default.remove('username');\n\n            _jsCookie.default.remove('password');\n\n            _jsCookie.default.remove('rememberMe');\n          }\n\n          _this3.$store.dispatch('Login', user).then(function () {\n            //console.log('======dddddd======', this.user())\n            if (_this3.user().roles != null && _this3.user().roles.length > 0) {\n              if (_this3.user().roles.length > 1) {\n                console.log('=======login=====>', _this3.user());\n\n                for (var i = 0; i < _this3.user().roles.length; i++) {\n                  _this3.currentRole.id += _this3.user().roles[i].id + \",\";\n                  _this3.currentRole.name += _this3.user().roles[i].name + \",\";\n                }\n\n                _this3.currentRole.id = _this3.currentRole.id.substr(0, _this3.currentRole.id.length - 1);\n                _this3.currentRole.name = _this3.currentRole.name.substr(0, _this3.currentRole.name.length - 1);\n                _this3.selectRole = false;\n\n                _this3.goin();\n              } else if (_this3.user().roles.length === 1) {\n                _this3.currentRoleid = _this3.user().roles[0].id;\n                _this3.currentRole.name += _this3.user().roles[0].name;\n\n                _this3.goin();\n              }\n            } else {\n              _this3.$message('当前用户没有访问该系统的权限，请联系管理员！', 'error');\n            }\n          }).catch(function (error) {\n            console.log(error);\n            _this3.loading = false;\n\n            _this3.getCode();\n          });\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n    },\n    goin: function goin() {\n      if (!this.currentRole) {\n        this.$message('请选择角色', 'error');\n        return;\n      } //console.log('======goin============', this.currentRole, this.user().roles.find(e => e.id == this.currentRole))\n\n\n      this.$store.dispatch('setCurrentRole', this.currentRole);\n      this.$router.push({\n        path: this.redirect || '/'\n      });\n    },\n    cancel: function cancel() {\n      this.selectRole = false;\n      this.loading = false;\n    }\n  }, (0, _vuex.mapGetters)(['user', 'getStyle']))\n};\nexports.default = _default;\n\nfunction getQueryObject(url) {\n  url = url == null ? window.location.href : url;\n  var search = url.substring(url.lastIndexOf('?') + 1);\n  var obj = {};\n  var reg = /([^?&=]+)=([^?&=]*)/g;\n  search.replace(reg, function (rs, $1, $2) {\n    var name = decodeURIComponent($1);\n    var val = decodeURIComponent($2);\n    val = String(val);\n    obj[name] = val;\n    return rs;\n  });\n  return obj;\n}",{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;AAsGA;;AACA;;AACA;;AACA;;AACA;;AAEA;;;;;;eAEA;AACAA,eADA;AAEAC,MAFA,kBAEA;AACA;AACAC,oCADA;AAEAC,wBAFA;AAGAC,iBAHA;AAIAC,oBAJA;AAKAC,sBALA;AAMAC;AACAC,oBADA;AAEAC,oBAFA;AAGAC,yBAHA;AAIAC,gBAJA;AAKAC,gBALA;AAMAC;AANA,OANA;AAcAC;AACAN;AAAAO;AAAAC;AAAAC;AAAA,UADA;AAEAR;AAAAM;AAAAC;AAAAC;AAAA,UAFA;AAGAN;AAAAI;AAAAC;AAAAC;AAAA;AAHA,OAdA;AAmBAC,oBAnBA;AAoBAC,yBApBA;AAqBAC;AAAAC;AAAArB;AAAA,OArBA;AAsBAsB,uBAtBA;AAuBAC;AAvBA;AAyBA,GA5BA;AA6BAC;AACAC;AADA,GA7BA;AAgCAC;AACAC,QADA,kBACA;AACA;AACA;AACA,KAJA;AAKAC,iBALA,2BAKA;AACA;AACA;AACA;AARA,GAhCA;AA0CAC;AACAC;AACAC;AACA;AACA,OAHA;AAIAC;AAJA;AADA,GA1CA;AAkDAC,SAlDA,qBAkDA;AACA;AACA;AACA;AACAC;;AACA;AACA;AACA;AACA,KAHA,MAGA;AACA;AACA;;AACA;AACA;AACA,GA/DA;AAgEAC,SAhEA,qBAgEA,CACA,CAjEA;AAkEAC;AAEAC,WAFA,qBAEA;AAAA;;AACA;AACA;;AACA;AACA;AACA;AACA;AACA,OANA;AAOA,KAVA;AAWAC,aAXA,uBAWA;AACA;;AACA;;AACA,2DAHA,CAIA;;;AACA;AACA7B;AACA;AACAD,6EADA;AAEAC,0BAFA;AAGAC,0EAHA;AAIAC;AAJA;AAMA,KAxBA;AAyBA4B,aAzBA,qBAyBAC,KAzBA,EAyBA;AAAA;;AACAN;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA,OAPA;AAQA,KAnCA;AAoCAO,eApCA,yBAoCA;AAAA;;AACAP;AACA;AACA;AACA1B,6CADA;AAEAC,6CAFA;AAGAC,iDAHA;AAIAC,qCAJA;AAKAC,qCALA;AAMAC;AANA;AAQAqB;;AACA;AACAQ;AACA;;AACA;AACA;;AACA;AACAC;AAAAC;AAAA;;AACAD;AAAAC;AAAA;;AACAD;AAAAC;AAAA;AACA,WAJA,MAIA;AACAD;;AACAA;;AACAA;AACA;;AACA;AACA;AACA;AACA;AACAT;;AAEA;AACA;AACA;AACA;;AACA;AACA;AACA;;AACA;AACA,eAXA,MAWA;AACA;AACA;;AACA;AACA;AACA,aAjBA,MAiBA;AACA;AACA;AACA,WAtBA,EAsBAW,KAtBA,CAsBA;AACAX;AACA;;AACA;AACA,WA1BA;AA2BA,SAtCA,MAsCA;AACAA;AACA;AACA;AACA,OAvDA;AAwDA,KA9FA;AA+FAY,QA/FA,kBA+FA;AACA;AACA;AACA;AACA,OAJA,CAKA;;;AACA;AACA;AAAAC;AAAA;AACA,KAvGA;AAwGAC,UAxGA,oBAwGA;AACA;AACA;AACA;AA3GA,KA4GA,2CA5GA;AAlEA,C;;;AAiLA;AACAC;AACA;AACA;AACA;AACAC;AACA;AACA;AACAC;AACAC;AACA;AACA,GANA;AAOA;AACA","names":["name","data","title","codeEnabled","codeUrl","cookiePass","theme","loginForm","username","password","rememberMe","code","uuid","loginType","loginRules","required","trigger","message","loading","redirect","currentRole","id","selectRole","showForm","components","ThemeSelect","computed","logo","getBackground","watch","$route","handler","immediate","created","console","mounted","methods","getCode","getCookie","autoLogin","token","handleLogin","user","Cookies","expires","catch","goin","path","cancel","url","search","val","obj"],"sourceRoot":"src/views/indicators/login","sources":["login.vue"],"sourcesContent":["<template>\r\n  <div  class=\"login\" :style=\"{backgroundImage: 'url('+getBackground+')'}\">\r\n    <div v-show=\"!showForm\"\r\n         style=\"color: darkorange;font-size: 50px;position: absolute;width: 100%;background-color: white;top:0;bottom: 0;text-align: center;padding-top: 14%\">\r\n            <img src=\"/images/505a6a9db11844a9f0f948cb4f0c3014.gif\" >\r\n<!--      您正在进入指标管理系统，请稍后......-->\r\n    </div>\r\n    <el-form\r\n        ref=\"loginForm\"\r\n        :model=\"loginForm\"\r\n        :rules=\"loginRules\"\r\n        label-position=\"left\"\r\n        label-width=\"0px\"\r\n        class=\"login-form\"\r\n        :style=\"codeEnabled==true?'height: 445px;':''\"\r\n        v-show=\"showForm\"\r\n    >\r\n      <div class=\"theme\">\r\n        <theme-select></theme-select>\r\n      </div>\r\n      <div class=\"title\">\r\n        <img v-if=\"logo\" :src=\"logo\" class=\"logo\" alt=\"logo\"><span class=\"text\">{{ title }}</span>\r\n      </div>\r\n      <el-form-item prop=\"username\">\r\n            <el-input v-model=\"loginForm.username\"\r\n                      type=\"text\"\r\n                      auto-complete=\"off\"\r\n                      placeholder=\"请输入账号\"\r\n                      prefix-icon=\"el-icon-user\"\r\n                      size=\"medium\">\r\n        </el-input>\r\n      </el-form-item>\r\n      <el-form-item prop=\"password\">\r\n        <el-input\r\n            v-model=\"loginForm.password\"\r\n            type=\"password\"\r\n            auto-complete=\"off\"\r\n                placeholder=\"请输入密码\"\r\n                @keyup.enter.native=\"handleLogin\"\r\n                prefix-icon=\"el-icon-lock\"\r\n                size=\"medium\"\r\n            >\r\n        </el-input>\r\n      </el-form-item>\r\n      <el-form-item v-if=\"codeEnabled\" prop=\"code\">\r\n        <el-input\r\n            v-model=\"loginForm.code\"\r\n            auto-complete=\"off\"\r\n            placeholder=\"验证码\"\r\n            style=\"width: 63%\"\r\n            @keyup.enter.native=\"handleLogin\"\r\n                size=\"medium\"\r\n        >\r\n          <svg-icon slot=\"prefix\" icon-class=\"validCode\" class=\"el-input__icon input-icon\"/>\r\n        </el-input>\r\n        <div class=\"login-code\">\r\n          <img :src=\"codeUrl\" @click=\"getCode\" alt=\"验证码\">\r\n        </div>\r\n      </el-form-item>\r\n      <el-checkbox v-model=\"loginForm.rememberMe\" class=\"rememberMe\">\r\n        记住我\r\n      </el-checkbox>\r\n      <el-form-item style=\"width:100%;\">\r\n        <el-button\r\n            :loading=\"loading\"\r\n            size=\"medium\"\r\n            type=\"primary\"\r\n            class=\"loginButton\"\r\n            @click.native.prevent=\"handleLogin\"\r\n        >\r\n          <span v-if=\"!loading\">登 录</span>\r\n          <span v-else>登 录 中...</span>\r\n        </el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    <!--  底部  -->\r\n    <div v-if=\"$store.state.settings.showFooter\" id=\"el-login-footer\" class=\"footer\">\r\n      <span v-html=\"$store.state.settings.footerTxt\"/>\r\n      <span> ⋅ </span>\r\n      <a href=\"#\" target=\"_blank\">{{ $store.state.settings.caseNumber }}</a>\r\n    </div>\r\n    <el-dialog\r\n        append-to-body\r\n        :close-on-click-modal=\"false\"\r\n        :visible.sync=\"selectRole\"\r\n        title=\"选择角色\"\r\n        width=\"300px\"\r\n        height=\"200px\"\r\n    >\r\n      <el-select v-model=\"currentRole\" style=\"width: 100%;\">\r\n        <el-option v-for=\"item in user().roles\" :value=\"item.id\" :label=\"item.name\"/>\r\n      </el-select>\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button type=\"text\" @click=\"cancel\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"goin\">确认</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nimport {encrypt} from '@eladmin/utils/rsaEncrypt'\r\nimport Config from '@public/config/settings'\r\nimport {getCodeImg,ssoLogin} from '@eladmin/api/login'\r\nimport Cookies from 'js-cookie'\r\nimport {mapGetters, mapActions} from 'vuex'\r\n\r\nimport ThemeSelect from '@portal/components/ThemeSelect'\r\n\r\nexport default {\r\n  name: 'Login',\r\n  data() {\r\n    return {\r\n      title: Config.title,\r\n      codeEnabled: false,\r\n      codeUrl: '',\r\n      cookiePass: '',\r\n      theme: 'default',\r\n      loginForm: {\r\n        username: '',\r\n        password: '',\r\n        rememberMe: false,\r\n        code: '',\r\n        uuid: '',\r\n        loginType: ''\r\n      },\r\n      loginRules: {\r\n        username: [{required: true, trigger: 'blur', message: '用户名不能为空'}],\r\n        password: [{required: true, trigger: 'blur', message: '密码不能为空'}],\r\n        code: [{required: true, trigger: 'change', message: '验证码不能为空'}]\r\n      },\r\n      loading: false,\r\n      redirect: undefined,\r\n      currentRole: {id:'',name:''},\r\n      selectRole: false,\r\n      showForm: false\r\n    }\r\n  },\r\n  components: {\r\n    ThemeSelect\r\n  },\r\n  computed: {\r\n    logo() {\r\n      //console.log('lllllogo>>>>>', Config.logo, typeof (Config.logo))\r\n      return Config.logo ? Config.logo : require('@portalParent/public/themes/' + this.getStyle()['style'] + '/images/logo.png')\r\n    },\r\n    getBackground() {\r\n      //return '/themes/' + this.getTheme().layout + '/' + this.getTheme().style + '/images/login_bg_' + (new Date().getDay() + 1) + '.jpg'\r\n      return Config.loginBackground ? Config.loginBackground : require('@portalParent/public/themes/' + this.getStyle().style + '/images/login_bg_' + (new Date().getDay() + 1) + '.jpg')\r\n    }\r\n  },\r\n  watch: {\r\n    $route: {\r\n      handler: function (route) {\r\n        this.redirect = route.query && route.query.redirect\r\n      },\r\n      immediate: true\r\n    }\r\n  },\r\n  created() {\r\n    let param = getQueryObject();\r\n    let token = param.token;\r\n    let type = param.type;\r\n    console.log(\"login token:: \" + token +\",loginType :: \" + type)\r\n    if(type==='sso' && token != null) {\r\n      this.showForm = false;\r\n      this.autoLogin(token);\r\n    }else {\r\n      this.showForm = true;\r\n    }\r\n    this.getCode()\r\n    this.getCookie()\r\n  },\r\n  mounted() {\r\n  },\r\n  methods: {\r\n\r\n    getCode() {\r\n      getCodeImg().then(res => {\r\n        this.codeEnabled = res.enabled\r\n        if (res.enabled) {\r\n          this.codeUrl = res.img\r\n          this.loginForm.uuid = res.uuid\r\n        }\r\n      })\r\n    },\r\n    getCookie() {\r\n      const username = Cookies.get('username')\r\n      let password = Cookies.get('password')\r\n      const rememberMe = Cookies.get('rememberMe')\r\n      // 保存cookie里面的加密后的密码\r\n      this.cookiePass = password === undefined ? '' : password\r\n      password = password === undefined ? this.loginForm.password : password\r\n      this.loginForm = {\r\n        username: username === undefined ? this.loginForm.username : username,\r\n        password: password,\r\n        rememberMe: rememberMe === undefined ? false : Boolean(rememberMe),\r\n        code: ''\r\n      }\r\n    },\r\n    autoLogin(token) {\r\n      console.log(\"autoLogin ==> \" + token)\r\n      ssoLogin(token).then(res => {\r\n         if(res.code === '00') {\r\n           this.loginForm.username = res.username;\r\n           this.loginForm.password = res.password;\r\n           this.loginForm.loginType = 'sso';\r\n           this.handleLogin();\r\n         }\r\n      });\r\n    },\r\n    handleLogin() {\r\n      console.log(\"handleLogin ==>\")\r\n      this.$refs.loginForm.validate(valid => {\r\n        const user = {\r\n          username: this.loginForm.username,\r\n          password: this.loginForm.password,\r\n          rememberMe: this.loginForm.rememberMe,\r\n          code: this.loginForm.code,\r\n          uuid: this.loginForm.uuid,\r\n          loginType: this.loginForm.loginType\r\n        }\r\n        console.log(\"handleLogin ==> user \" + user.loginType)\r\n        if (user.password !== this.cookiePass) {\r\n          user.password = encrypt(user.password)\r\n        }\r\n        if (valid) {\r\n          this.loading = true\r\n          if (user.rememberMe) {\r\n            Cookies.set('username', user.username, {expires: Config.passCookieExpires})\r\n            Cookies.set('password', user.password, {expires: Config.passCookieExpires})\r\n            Cookies.set('rememberMe', user.rememberMe, {expires: Config.passCookieExpires})\r\n          } else {\r\n            Cookies.remove('username')\r\n            Cookies.remove('password')\r\n            Cookies.remove('rememberMe')\r\n          }\r\n          this.$store.dispatch('Login', user).then(() => {\r\n            //console.log('======dddddd======', this.user())\r\n            if (this.user().roles != null && this.user().roles.length > 0) {\r\n              if (this.user().roles.length > 1) {\r\n                 console.log('=======login=====>', this.user())\r\n\r\n                for(var i=0;i<this.user().roles.length;i++){\r\n                  this.currentRole.id += this.user().roles[i].id+\",\";\r\n                  this.currentRole.name += this.user().roles[i].name+\",\";\r\n                }\r\n                this.currentRole.id = this.currentRole.id.substr(0,this.currentRole.id.length -1);\r\n                this.currentRole.name = this.currentRole.name.substr(0,this.currentRole.name.length -1);\r\n                this.selectRole = false\r\n                this.goin()\r\n              } else if (this.user().roles.length === 1) {\r\n                this.currentRoleid = this.user().roles[0].id\r\n                this.currentRole.name += this.user().roles[0].name;\r\n                this.goin()\r\n              }\r\n            } else {\r\n              this.$message('当前用户没有访问该系统的权限，请联系管理员！', 'error')\r\n            }\r\n          }).catch((error) => {\r\n            console.log(error)\r\n            this.loading = false\r\n            this.getCode()\r\n          })\r\n        } else {\r\n          console.log('error submit!!')\r\n          return false\r\n        }\r\n      })\r\n    },\r\n    goin() {\r\n      if (!this.currentRole) {\r\n        this.$message('请选择角色', 'error')\r\n        return\r\n      }\r\n      //console.log('======goin============', this.currentRole, this.user().roles.find(e => e.id == this.currentRole))\r\n      this.$store.dispatch('setCurrentRole', this.currentRole)\r\n      this.$router.push({path: this.redirect || '/'})\r\n    },\r\n    cancel() {\r\n      this.selectRole = false\r\n      this.loading = false\r\n    },\r\n    ...mapGetters(['user', 'getStyle']),\r\n  }\r\n}\r\nfunction getQueryObject(url) {\r\n  url = url == null ? window.location.href : url\r\n  const search = url.substring(url.lastIndexOf('?') + 1)\r\n  const obj = {}\r\n  const reg = /([^?&=]+)=([^?&=]*)/g\r\n  search.replace(reg, (rs, $1, $2) => {\r\n    const name = decodeURIComponent($1)\r\n    let val = decodeURIComponent($2)\r\n    val = String(val)\r\n    obj[name] = val\r\n    return rs\r\n  })\r\n  return obj\r\n}\r\n</script>\r\n"]}]}