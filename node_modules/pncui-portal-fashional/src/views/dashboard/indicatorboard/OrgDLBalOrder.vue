<template>
  <el-card :class="className" :style="{height:height,width:width}">
    <div slot="header" class="clearfix">
      <span class="card-title-text">机构贷款余额排名<span style="padding-left:10px">(万元)</span> </span>
      <span class="card-title-unit">
        <el-select v-model="orderType" @change="initChart">
          <el-option key="1" label="按存款余额排序" value="deposit" />
          <el-option key="2" label="按贷款余额排序" value="loan" />
        </el-select>
      </span>
    </div>
    <div id="card-main-org-dl-order" class="card-main card-main-chart card-org-d-l-bal-order" />
  </el-card>
</template>

<script>
  import echarts from 'echarts'
  import { mapGetters } from 'vuex'
  import { orgDlbalOrder } from '../../../api/dashboard/dashboard'
  import { getYesterday } from '@eladmin/utils/data_format'

  export default {
    name: 'LoanBalOrder',
    props: {
      className: {
        type: String,
        default: 'box-card'
      },
      width: {
        type: String,
        default: '100%'
      },
      height: {
        type: String,
        default: '100%'
      },
      autoResize: {
        type: Boolean,
        default: true
      },
      date: {
        type: String,
        default: getYesterday()
      }
    },
    data() {
      return {
        chart: null,
        sidebarElm: null,
        orderType: 'deposit',
        chartData: []
      }
    },
    mounted() {
      orgDlbalOrder(this.date).then(res => {
          this.chartData = res.data
          this.initChart()
        }
      )
      window.addEventListener('resize', this.onResize)
    },
    computed: {
      ...
        mapGetters([
          'sidebar'
        ])
    },
    watch: {
      sidebar: {
        deep: true,
        immediate: true,
        handler:
          function(newValue, oldValue) {
            // console.log('=====watch>>', oldValue, newValue)
            this.onResize()
            // result为true，则表示是全部选中
          }
      }
    },
    beforeDestroy() {
      if (!this.chart) {
        return
      }
      this.chart.dispose()
      this.chart = null
    },
    methods: {
      setOptions(data) {
        // console.log('=========orgOrder>', data)
        this.chart.setOption({
          xAxis: {
            data: data.map(e => e.org),
            boundaryGap: true,
            axisTick: {
              show: false
            },
            color: '#6E6E6E',
            axisLabel: {
              formatter: '{value}',
              textStyle: { // 改变刻度字体样式
                color: '#6E6E6E'
              },
              rotate: 60
            },
            axisLine: {
              lineStyle: {
                color: '#6E6E6E',
                width: 2// 这里是为了突出显示加上的
              }
            }
          },
          grid: {
            left: 20,
            right: 20,
            bottom: 20,
            top: 30,
            containLabel: true
          },
          tooltip: {
            trigger: 'axis',
            axisPointer: {
              type: 'cross'
            },
            padding: [5, 10]
          },
          yAxis: {
            type: 'value',
            axisTick: {
              show: false
            },
            axisLabel: {
              formatter: '{value}',
              textStyle: { // 改变刻度字体样式
                color: '#6E6E6E'
              }
            },
            axisLine: {
              show: false
            }
          },
          legend: {
            data: ['存款余额', '贷款余额']
          },
          series: [{
            name: '存款余额',
            type: 'bar',
            // barWidth: '30%',
            // barGap: '10%',
            itemStyle:
        {
          normal: {
            color: '#F09937',
              lineStyle:
            {
              color: '#F09937',
                width:
              2
            }
          }
        },
        data: data.map(e => e.deposit),
          animationDuration:
        2000,
          animationEasing:
        'cubicInOut'
      },
        {
          name: '贷款余额',
            smooth:
          false,
            type:
          'bar',
            // barWidth: '30%',
            barGap:
          0,
            itemStyle:
          {
            normal: {
              color: '#489FF8',
                lineStyle:
              {
                color: '#489FF8',
                  width:
                2
              }
            }
          },
          data: data.map(e => e.loan),
            animationDuration:
          2000,
            animationEasing:
          'quadraticOut'
        }
      ]
      })
      },
      onResize() {
        if (this.chart) {
          this.chart.resize()
        }
      },
      initChart(type) {
        console.log('开始绘制机构存贷款排名图表...', type)
        if (this.chart) {
          this.chart.dispose()
        }
        this.chart = echarts.init(document.querySelector('#card-main-org-dl-order'))
        if (type == 'loan') {
          this.setOptions(this.chartData.sort(function(a, b) {
            return b.loan - a.loan
          }))
        } else {
          this.setOptions(this.chartData)
        }
      }
    }
  }
</script>

<style scoped>
</style>
